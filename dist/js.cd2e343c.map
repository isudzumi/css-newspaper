{"version":3,"sources":["../node_modules/css-regions-polyfill/bin/css-regions-polyfill.js","js/index.js","../node_modules/parcel-bundler/src/builtins/bundle-url.js","../node_modules/parcel-bundler/src/builtins/css-loader.js"],"names":["module","exports","require","modules","m","define","window","document","console","backlog","log","x","debug","alert","dir","elm","e","innerHTML","tagName","className","id","substr","nodeName","nodeValue","jsonify","o","seen","jso","JSON","stringify","k","v","indexOf","Node","push","ex","warn","error","onerror","slice","call","arguments","join","cssConsole","enabled","warnEnabled","domEvents","cloneMouseEvent","evt","createEvent","initMouseEvent","type","canBubble","bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","cloneKeyboardEvent","cloneCustomEvent","ne","initCustomEvent","prop","target","Object","defineProperty","get","cloneEvent","MouseEvent","KeyboardEvent","EventTarget","implementsIn","eventClass","static_class","prototype","dispatchEvent","addEventListener","removeEventListener","eventType","f","eventListeners","ls","i","splice","event_or_type","length","event","setUpPropertyForwarding","ee","key","bind","set","setUpTarget","create","getPrototypeOf","Error","setImmediate","isDefaultPrevented","cssSyntax","tokenize","string","parse","tokens","TokenList","array","toCSSString","TokenListToCSSString","sep","map","asCSSString","replace","between","num","first","last","digit","code","hexdigit","uppercaseletter","lowercaseletter","letter","nonascii","namestartchar","namechar","nonprintable","newline","whitespace","badescape","isNaN","maximumallowedcodepoint","InvalidCharacterError","message","name","preprocess","str","codepoints","charCodeAt","lead","trail","Math","pow","stringFromCode","String","fromCharCode","floor","line","column","lastLineLength","incrLineno","locStart","codepoint","next","undefined","consume","reconsume","eof","donothing","tokenizeerror","toString","consumeAToken","consumeComments","WhitespaceToken","consumeAStringToken","areAValidEscape","token","HashToken","wouldStartAnIdentifier","value","consumeAName","DelimToken","SuffixMatchToken","OpenParenToken","CloseParenToken","SubstringMatchToken","startsWithANumber","consumeANumericToken","CommaToken","CDCToken","startsWithAnIdentifier","consumeAnIdentlikeToken","ColonToken","SemicolonToken","CDOToken","AtKeywordToken","OpenSquareToken","startsWithAValidEscape","CloseSquareToken","PrefixMatchToken","OpenCurlyToken","DashMatchToken","ColumnToken","CloseCurlyToken","IncludeMatchToken","EOFToken","consumeANumber","DimensionToken","repr","unit","PercentageToken","NumberToken","toLowerCase","FunctionToken","consumeAURLToken","IdentifierToken","endingCodePoint","StringToken","BadStringToken","consumeEscape","URLToken","consumeTheRemnantsOfABadURL","BadURLToken","digits","total","parseInt","c1","c2","c3","wouldStartANumber","result","convertAStringToANumber","iterationCount","CSSParserToken","toJSON","tokenType","GroupingToken","mirror","StringValuedToken","ASCIIMatch","val","escapeIdent","escapeValue","escapeHash","escapeString","json","constructor","source","firstcode","IdentToken","TokenStream","tokenAt","parseerror","s","msg","consumeAListOfRules","topLevel","rules","rule","consumeAStyleRule","consumeAnAtRule","AtRule","consumeASimpleBlock","SimpleBlock","prelude","consumeAComponentValue","StyleRule","consumeAListOfDeclarations","decls","temp","decl","consumeADeclaration","Declaration","foundImportant","important","consumeAFunction","block","func","Func","normalizeInput","input","SyntaxError","parseAStylesheet","sheet","Stylesheet","parseAListOfRules","parseARule","parseADeclaration","parseAListOfDeclarations","parseAComponentValue","parseAListOfComponentValues","vals","parseACommaSeparatedListOfComponentValues","listOfCVLs","CSSParserRule","indent","toStylesheet","asStylesheet","selector","getSelector","getDeclarations","getArguments","args","arg","FuncArg","parseCSSValue","vendors","requestAnimationFrame","vp","cancelAnimationFrame","listener_index","listeners","tmp","tick","now","Date","callbacks","setTimeout","callback","index","cancelImmediate","clearTimeout","EventStream","connect","disconnect","reconnect","self","isConnected","isDisconnected","shouldDisconnect","yieldEvent","dispose","schedule","newCallback","AnimationFrameEventStream","options","rid","TimeoutEventStream","timeout","MouseEventStream","pointermove","scheduled","interval","yieldEventDelayed","newYieldEvent","MouseButtonEventStream","pointerup","pointerdown","DOMUpdateEventStream","documentElement","config","subtree","attributes","childList","characterData","observer","MutationObserver","observe","takeRecords","FocusEventStream","previousActiveElement","previousHasFocus","activeElement","hasFocus","CompositeEventStream","stream1","stream2","s1","s2","yieldEventWrapper","eventStreams","querySelectorLive","handler","root","currentElms","loop","eventStream","newElms","oldElms","temps","querySelectorAll","filter","isStillInDocument","contains","onremoved","el1","pop","el2","compareDocumentPosition","onadded","simpleSelector","reg","test","cssCascade","computeSelectorPriorityOf","trim","numberOfIDs","numberOfClasses","numberOfTags","nestedPriority","findAllMatchingRules","element","findAllMatchingRulesWithPseudo","pseudo","results","visit","r","disabled","subrules","subRules","splitRule","sr","selectorLow","newLength","lastIndexOf","isMatching","matches","matchesSelector","oMatchesSelector","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","stylesheets","allCSSProperties","getAllCSSProperties","getComputedStyle","ps","Array","computationUnsafeProperties","__proto__","inheritingProperties","defaultStylesForTag","getDefaultStyleForTag","createElement","style","display","head","insertBefore","firstChild","getSpecifiedStyle","cssPropertyName","matchedRules","fragmentSource","getAttribute","querySelector","currentStyle","opera","bestValue","myStyle","getPropertyValue","isBestImportant","bestPriority","monitoredProperties","myMatchedRules","j","currentPriority","loadStyleSheet","cssText","startMonitoringStylesheet","loadStyleSheetTag","stylesheet","hasAttribute","xhr","XMLHttpRequest","href","open","ruleIndex","onreadystatechange","readyState","status","responseText","send","textContent","setAttribute","selectorForStylesheets","loadAllStyleSheets","intialLength","monitoredPropertiesHandler","onupdate","mps","hs","hi","startMonitoringProperties","properties","property","handlers","currentStylesheet","isMonitored","startMonitoringRule","matchMedia","startMonitoringMedia","atrule","media","updateMedia","addListener","newMedia","update","els","currentRule","unshift","toCamelCase","variable","toUpperCase","polyfillStyleInterface","parentElement","clip","styleProtos","CSSStyleDeclaration","styleProto","Element","cssBreak","isReplacedElement","replacedElementTags","isScrollable","elementOverflow","overflow","isSingleLineOfTextComponent","elementStyle","elementDisplay","elementPosition","isReplaced","position","hasAnyInlineFlow","countAsInline","isOutOfFlowElement","current","nextSibling","isLineBreakingElement","isLinePreBreakingElement","breakBefore","isLinePostBreakingElement","breakAfter","elementFloat","float","styleFloat","cssFloat","areInSameSingleLine","element1","element2","t","element1box","getBoundingClientRect","element2box","shift","box","shiftX","shiftY","top","bottom","left","right","element1Style","parseFloat","marginLeft","marginTop","element2Style","firstElement","parentNode","direction","secondElement","isHiddenOverflowing","offsetHeight","scrollHeight","hasBigRadius","tlRadius","borderTopLeftRadius","trRadius","borderTopRightRadius","blRadius","borderBottomLeftRadius","brRadius","borderBottomRightRadius","tWidth","borderTopWidth","bWidth","borderBottomWidth","lWidth","borderLeftWidth","rWidth","borderRightWidth","isBreakInsideAvoid","breakInside","isMonolithic","isSingleLineOfText","isPossibleBreakPoint","region","Range","collapsed","ancestor","startContainer","lastAncestor","childNodes","startOffset","previousSibling","firstChildBox","parentBox","caretRangeFromPoint","caretPositionFromPoint","y","createRange","p","offsetNode","setStart","offset","setEnd","body","createTextRange","TextRangeUtils","convertToDOMRange","textRange","adoptBoundary","domRange","textRangeInner","bStart","cursorNode","cursor","duplicate","collapse","parent","moveToElementText","compareEndPoints","setEndPoint","text","removeChild","convertFromDOMRange","adoptEndPoint","domRangeInner","container","textOffset","anchorNode","DOMUtils","isDataNode","anchorParent","nodeType","_document","IYDepth","iy","ix","moveToPoint","elem","elementFromPoint","setStartAfter","myMoveOneCharLeft","endOffset","endContainer","lastChild","setEndAfter","TEXT_NODE","setEndBefore","myMoveOneCharRight","max","setStartBefore","myMoveTowardRight","isTextNode","currentText","currentOffset","currentLetter","myMoveEndOneCharLeft","myMoveEndOneCharRight","myGetSelectionRect","rect","width","height","clone","cloneRange","collapseToLeft","HTMLElement","range","selectNode","getClientRects","node","myGetExtensionRect","prevSibRect","adjustedBottom","onlyWhiteSpaceBefore","auxiliaryRange","cssRegionsHelpers","getAllLevelPreviousSibling","markNodesAsRegion","nodes","fast","forEach","regionOverset","cssRegionsLastFlowFromName","hideTextNodesFromFragmentSource","cssRegionsWrapper","appendChild","unmarkNodesAsRegion","unhideTextNodesFromFragmentSource","removeAttribute","fragmentSourceIndex","markNodesAsFragmentSource","ignoreRoot","child","getAttributeNode","expandListValues","OL","currentValue","childElementCount","increment","LI","firstElementChild","LIV","nextElementSibling","unexpandListValues","removeAttributeNode","listOfTextNodesForIE","cssRegionsSavedNodeValue","navigator","userAgent","unmarkNodesAsFragmentSource","transformFragmentSourceToFragments","embedTrailingWhiteSpaceNodes","fragment","onlyWhiteSpace","whiteSpace","substring","unembedTrailingWhiteSpaceNodes","txt","createTextNode","insertAfter","copyStyle","root1","root2","node1","node2","isRoot","child1","next1","child2","next2","defaultStyle","setProperty","cssValue","importPseudo","mayExist","pseudoStyle","content","node2style","retargetEvents","cssRegionsLastFlowIntoName","cssRegionsLastFlowIntoType","retargetEvent","retargeEvent","cssRegionsFragmentSource","stopImmediatePropagation","stopPropagation","defaultPrevented","preventDefault","cssRegions","ES","Flow","NamedFlow","overset","firstEmptyRegionIndex","lastContent","regions","lastRegions","This","stream","relayout","lastStylesheetAdded","failedLayoutCount","lastEventRAF","restartLayout","removeFromContent","removeEventListenersOf","removeFromRegions","addToContent","currentNodeIndex","treeWalker","createTreeWalker","NodeFilter","SHOW_ELEMENT","FILTER_ACCEPT","FILTER_SKIP","currentNode","nextNode","addToRegions","FILTER_REJECT","generateContentFragment","createDocumentFragment","el","elClone","cloneNode","elToInsert","margin","padding","relayoutScheduled","relayoutInProgress","_relayout","data","lastRelayout","docElmScrollTop","scrollTop","docBdyScrollTop","regionStack","reverse","contentFragment","layoutContent","onprogress","continueLayout","ondone","onLayoutDone","isEmpty","addEventListenersTo","isBuggy","some","relayoutIfSizeChanged","rs","cssRegionsLastOffsetHeight","offsetWidth","cssRegionsLastOffsetWidth","cssRegionsEventStream","getContent","getRegions","getRegionsByContent","fragments","NamedFlowCollection","namedItem","flows","enablePolyfillObjectModel","getNamedFlows","c","flowName","hasOwnProperty","getNamedFlow","defineProperties","_regionOverset","getRegionFlowRanges","getComputedRegionStyle","enablePolyfill","enableObjectModel","CSS_STYLE","remainingContent","startTime","hasChildNodes","regionDisplay","cssRegionHost","dummyCallback","layoutContentInNextRegionsWhenReady","layoutContentInLastRegionWhenReady","imgs","getElementsByTagName","imgs_index","complete","regionDidOverflow","shouldSegmentContent","lastElementChild","extractOverflowingContent","didOverflow","dontOptimize","sizingH","sizingW","pos","lostHeight","paddingBottom","fixNullRect","scrollLeft","heigth","nextSiblingRect","optimizationFailled","lines","previousLineBottom","allAncestors","ELEMENT_NODE","excessHeight","endContainerStyle","availBorderHeight","availPaddingHeight","borderCut","paddingCut","hasBottomRadius","availHeight","paddingTop","topPaddingCut","topBorderCut","overflowingContent","extractContents","newFragments","specialNewFragment","flowInto","flowIntoName","flowIntoType","flowFrom","flowFromName","cssRegionsLastFlowInto","cssRegionsLastFlowFrom","lastFlowFrom","lastFlowInto","lastWindowResize","relayoutModifiedFlows","hasOngoingLayouts","restartOngoingLayouts","cssPolyfills","bundleURL","getBundleURLCached","getBundleURL","err","stack","match","getBaseURL","url","bundle","updateLink","link","newLink","onload","remove","split","cssTimeout","reloadCSS","links"],"mappings":"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","file":"js.cd2e343c.map","sourceRoot":"../src","sourcesContent":["/*! CSS-REGIONS-POLYFILL - v3.0.0 - 2018-03-23 - https://github.com/FremyCompany/css-regions-polyfill - Copyright (c) 2018 François REMY; MIT-Licensed !*/\n\n!(function() { 'use strict';\n    var module = { exports:{} };\n    var require = (function() { var modules = {}; var require = function(m) { return modules[m]; }; require.define = function(m) { modules[m]=module.exports; module.exports={}; }; return require; })();\n\n////////////////////////////////////////\n\n!(function(window, document) { \"use strict\";\n\n\t//\n\t// some code for console polyfilling\n\t//\n\tif(!window.console) {\n\t\t\t\n\t\twindow.console = {\n\t\t\tbacklog: '',\n\t\t\t\n\t\t\tlog: function(x) { this.backlog+=x+'\\n'; if(window.debug) alert(x); },\n\t\t\t\n\t\t\tdir: function(x) { try { \n\t\t\t\t\n\t\t\t\tvar elm = function(e) {\n\t\t\t\t\tif(e.innerHTML) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttagName: e.tagName,\n\t\t\t\t\t\t\tclassName: e.className,\n\t\t\t\t\t\t\tid: e.id,\n\t\t\t\t\t\t\tinnerHTML: e.innerHTML.substr(0,100)\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tnodeName: e.nodeName,\n\t\t\t\t\t\t\tnodeValue: e.nodeValue\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tvar jsonify = function(o) {\n\t\t\t\t\tvar seen=[];\n\t\t\t\t\tvar jso=JSON.stringify(o, function(k,v){\n\t\t\t\t\t\tif (typeof v =='object') {\n\t\t\t\t\t\t\tif ( !seen.indexOf(v) ) { return '__cycle__'; }\n\t\t\t\t\t\t\tif ( v instanceof window.Node) { return elm(v); }\n\t\t\t\t\t\t\tseen.push(v);\n\t\t\t\t\t\t} return v;\n\t\t\t\t\t});\n\t\t\t\t\treturn jso;\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tthis.log(jsonify(x)); \n\t\t\t\t\n\t\t\t} catch(ex) { this.log(x) } },\n\t\t\t\n\t\t\twarn: function(x) { this.log(x) },\n\t\t\t\n\t\t\terror: function(x) { this.log(\"ERROR:\"); this.log(x); }\n\t\t\t\n\t\t};\n\t\t\n\t\tif(!window.onerror) {\n\t\t\twindow.onerror = function() {\n\t\t\t\tconsole.log([].slice.call(arguments,0).join(\"\\n\"))\n\t\t\t};\n\t\t}\n\t\t\n\t}\n\n\t//\n\t// this special console is used as a proxy emulating the CSS console of browsers\n\t//\n\twindow.cssConsole = {\n\t\tenabled: (!!window.debug), warnEnabled: (true),\n\t\tlog: function(x) { if(this.enabled) console.log(x) },\n\t\tdir: function(x) { if(this.enabled) console.dir(x) },\n\t\twarn: function(x) { if(this.warnEnabled) console.warn(x) },\n\t\terror: function(x) { console.error(x); }\n\t}\n\n})(window, document);\nrequire.define('src/core/polyfill-dom-console.js');\n\n////////////////////////////////////////\n\nmodule.exports = (function(window, document) { \"use strict\";\n\n\trequire('src/core/polyfill-dom-console.js');\n\n\t//\n\t// some other basic om code\n\t//\n\tvar domEvents = {\n\t\t\n\t\t//\n\t\t// the following functions are about event cloning\n\t\t//\n\t\tcloneMouseEvent: function cloneMouseEvent(e) {\n\t\t\tvar evt = document.createEvent(\"MouseEvent\");\n\t\t\tevt.initMouseEvent( \n\t\t\t\te.type, \n\t\t\t\te.canBubble||e.bubbles, \n\t\t\t\te.cancelable, \n\t\t\t\te.view, \n\t\t\t\te.detail, \n\t\t\t\te.screenX, \n\t\t\t\te.screenY, \n\t\t\t\te.clientX, \n\t\t\t\te.clientY, \n\t\t\t\te.ctrlKey, \n\t\t\t\te.altKey, \n\t\t\t\te.shiftKey, \n\t\t\t\te.metaKey, \n\t\t\t\te.button, \n\t\t\t\te.relatedTarget\n\t\t\t);\n\t\t\treturn evt;\n\t\t},\n\t\t\n\t\tcloneKeyboardEvent: function cloneKeyboardEvent(e) {\n\t\t\t// TODO: this doesn't work cross-browser...\n\t\t\t// see https://gist.github.com/termi/4654819/ for the huge code\n\t\t\treturn domEvents.cloneCustomEvent(e);\n\t\t},\n\t\t\n\t\tcloneCustomEvent: function cloneCustomEvent(e) {\n\t\t\tvar ne = document.createEvent(\"CustomEvent\");\n\t\t\tne.initCustomEvent(e.type, e.canBubble||e.bubbles, e.cancelable, \"detail\" in e ? e.detail : e);\n\t\t\tfor(var prop in e) {\n\t\t\t\ttry {\n\t\t\t\t\tif(e[prop] != ne[prop] && e[prop] != e.target) {\n\t\t\t\t\t\ttry { ne[prop] = e[prop]; }\n\t\t\t\t\t\tcatch (ex) { Object.defineProperty(ne,prop,{get:function() { return e[prop]} }) }\n\t\t\t\t\t}\n\t\t\t\t} catch(ex) {}\n\t\t\t}\n\t\t\treturn ne;\n\t\t},\n\t\t\n\t\tcloneEvent: function cloneEvent(e) {\n\t\t\t\n\t\t\tif(e instanceof MouseEvent) {\n\t\t\t\treturn domEvents.cloneMouseEvent(e);\n\t\t\t} else if(e instanceof KeyboardEvent) {\n\t\t\t\treturn domEvents.cloneKeyboardEvent(e);\n\t\t\t} else {\n\t\t\t\treturn domEvents.cloneCustomEvent(e);\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// allows you to drop event support to any class easily\n\t\t//\n\t\tEventTarget: {\n\t\t\timplementsIn: function(eventClass, static_class) {\n\t\t\t\t\n\t\t\t\tif(!static_class && typeof(eventClass)==\"function\") eventClass=eventClass.prototype;\n\t\t\t\t\n\t\t\t\teventClass.dispatchEvent = domEvents.EventTarget.prototype.dispatchEvent;\n\t\t\t\teventClass.addEventListener = domEvents.EventTarget.prototype.addEventListener;\n\t\t\t\teventClass.removeEventListener = domEvents.EventTarget.prototype.removeEventListener;\n\t\t\t\t\n\t\t\t},\n\t\t\tprototype: {}\n\t\t}\n\t\t\n\t};\n\n\tdomEvents.EventTarget.prototype.addEventListener = function(eventType,f) {\n\t\tif(!this.eventListeners) this.eventListeners=[];\n\t\t\n\t\tvar ls = (this.eventListeners[eventType] || (this.eventListeners[eventType]=[]));\n\t\tif(ls.indexOf(f)==-1) {\n\t\t\tls.push(f);\n\t\t}\n\t\t\n\t}\n\n\tdomEvents.EventTarget.prototype.removeEventListener = function(eventType,f) {\n\t\tif(!this.eventListeners) this.eventListeners=[];\n\n\t\tvar ls = (this.eventListeners[eventType] || (this.eventListeners[eventType]=[])), i;\n\t\tif((i=ls.indexOf(f))!==-1) {\n\t\t\tls.splice(i,1);\n\t\t}\n\t\t\n\t}\n\n\tdomEvents.EventTarget.prototype.dispatchEvent = function(event_or_type) {\n\t\tif(!this.eventListeners) this.eventListeners=[];\n\t\t\n\t\t// abort quickly when no listener has been set up\n\t\tif(typeof(event_or_type) == \"string\") {\n\t\t\tif(!this.eventListeners[event_or_type] || this.eventListeners[event_or_type].length==0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\t\t\tif(!this.eventListeners[event_or_type.type] || this.eventListeners[event_or_type.type].length==0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t\n\t\t// convert the event\n\t\tvar event = event_or_type;\n\t\tfunction setUpPropertyForwarding(e,ee,key) {\n\t\t\tObject.defineProperty(ee,key,{\n\t\t\t\tget:function() {\n\t\t\t\t\tvar v = e[key]; \n\t\t\t\t\tif(typeof(v)==\"function\") {\n\t\t\t\t\t\treturn v.bind(e);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn v;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tset:function(v) {\n\t\t\t\t\te[key] = v;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tfunction setUpTarget(e,v) {\n\t\t\ttry { Object.defineProperty(e,\"target\",{get:function() {return v}}); }\n\t\t\tcatch(ex) {}\n\t\t\tfinally {\n\t\t\t\t\n\t\t\t\tif(e.target !== v) {\n\t\t\t\t\t\n\t\t\t\t\tvar ee = Object.create(Object.getPrototypeOf(e));\n\t\t\t\t\tee = setUpTarget(ee,v);\n\t\t\t\t\tfor(var key in e) {\n\t\t\t\t\t\tif(key != \"target\") setUpPropertyForwarding(e,ee,key);\n\t\t\t\t\t}\n\t\t\t\t\treturn ee;\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\t\n\t\t\t\t\treturn e;\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t\t\n\t\t// try to set the target\n\t\tif(typeof(event)==\"object\") {\n\t\t\ttry { event=setUpTarget(event,this); } catch(ex) {}\n\t\t\t\n\t\t} else if(typeof(event)==\"string\") {\n\t\t\tevent = document.createEvent(\"CustomEvent\");\n\t\t\tevent.initCustomEvent(event_or_type, /*canBubble:*/ true, /*cancelable:*/ false, /*detail:*/this);\n\t\t\ttry { event=setUpTarget(event,this); } catch(ex) {}\n\t\t\t\n\t\t} else {\n\t\t\tthrow new Error(\"dispatchEvent expect an Event object or a string containing the event type\");\n\t\t}\n\t\t\n\t\t// call all listeners\n\t\tvar ls = (this.eventListeners[event.type] || (this.eventListeners[event.type]=[]));\n\t\tfor(var i=ls.length; i--;) {\n\t\t\ttry { \n\t\t\t\tls[i](event);\n\t\t\t} catch(ex) {\n\t\t\t\tsetImmediate(function() { throw ex; });\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn event.isDefaultPrevented;\n\t}\n\t\n\treturn domEvents;\n\t\n})(window, document);\n\nrequire.define('src/core/dom-events.js');\n\n////////////////////////////////////////\n\n//\n// note: this file is based on Tab Atkins's CSS Parser\n// please include him (@tabatkins) if you open any issue for this file\n// \nmodule.exports = (function(window, document) { \"use strict\";\n\n// \n// exports\n//\nvar cssSyntax = { \n\ttokenize: function(string) {/*filled later*/}, \n\tparse: function(tokens) {/*filled later*/}\n};\n\n//\n// css tokenizer\n//\n\n// Add support for token lists (superclass of array)\nfunction TokenList() {\n\tvar array = []; \n\tarray.toCSSString=TokenListToCSSString;\n\treturn array;\n}\nfunction TokenListToCSSString(sep) {\n\tif(sep) {\n\t\treturn this.map(function(o) { return o.toCSSString(); }).join(sep);\n\t} else {\n\t\treturn this.asCSSString || (this.asCSSString = (\n\t\t\tthis.map(function(o) { return o.toCSSString(); }).join(\"/**/\")\n\t\t\t\t.replace(/( +\\/\\*\\*\\/ *| * | *\\/\\*\\*\\/ +)/g,\" \")\n\t\t\t\t.replace(/( +\\/\\*\\*\\/ *| * | *\\/\\*\\*\\/ +)/g,\" \")\n\t\t\t\t.replace(/(\\!|\\:|\\;|\\@|\\.|\\,|\\*|\\=|\\&|\\\\|\\/|\\<|\\>|\\[|\\{|\\(|\\]|\\}|\\)|\\|)\\/\\*\\*\\//g,\"$1\")\n\t\t\t\t.replace(/\\/\\*\\*\\/(\\!|\\:|\\;|\\@|\\.|\\,|\\*|\\=|\\&|\\\\|\\/|\\<|\\>|\\[|\\{|\\(|\\]|\\}|\\)|\\|)/g,\"$1\")\n\t\t));\n\t}\n}\ncssSyntax.TokenList = TokenList;\ncssSyntax.TokenListToCSSString = TokenListToCSSString;\n\nfunction between(num, first, last) { return num >= first && num <= last; }\nfunction digit(code) { return between(code, 0x30,0x39); }\nfunction hexdigit(code) { return digit(code) || between(code, 0x41,0x46) || between(code, 0x61,0x66); }\nfunction uppercaseletter(code) { return between(code, 0x41,0x5a); }\nfunction lowercaseletter(code) { return between(code, 0x61,0x7a); }\nfunction letter(code) { return uppercaseletter(code) || lowercaseletter(code); }\nfunction nonascii(code) { return code >= 0x80; }\nfunction namestartchar(code) { return letter(code) || nonascii(code) || code == 0x5f; }\nfunction namechar(code) { return namestartchar(code) || digit(code) || code == 0x2d; }\nfunction nonprintable(code) { return between(code, 0,8) || code == 0xb || between(code, 0xe,0x1f) || code == 0x7f; }\nfunction newline(code) { return code == 0xa; }\nfunction whitespace(code) { return newline(code) || code == 9 || code == 0x20; }\nfunction badescape(code) { return newline(code) || isNaN(code); }\n\nvar maximumallowedcodepoint = 0x10ffff;\n\nfunction InvalidCharacterError(message) {\n\tthis.message = message;\n};\nInvalidCharacterError.prototype = new Error;\nInvalidCharacterError.prototype.name = 'InvalidCharacterError';\n\nfunction preprocess(str) {\n\t// Turn a string into an array of code points,\n\t// following the preprocessing cleanup rules.\n\tvar codepoints = [];\n\tfor(var i = 0; i < str.length; i++) {\n\t\tvar code = str.charCodeAt(i);\n\t\tif(code == 0xd && str.charCodeAt(i+1) == 0xa) {\n\t\t\tcode = 0xa; i++;\n\t\t}\n\t\tif(code == 0xd || code == 0xc) code = 0xa;\n\t\tif(code == 0x0) code = 0xfffd;\n\t\tif(between(code, 0xd800, 0xdbff) && between(str.charCodeAt(i+1), 0xdc00, 0xdfff)) {\n\t\t\t// Decode a surrogate pair into an astral codepoint.\n\t\t\tvar lead = code - 0xd800;\n\t\t\tvar trail = str.charCodeAt(i+1) - 0xdc00;\n\t\t\tcode = Math.pow(2, 21) + lead * Math.pow(2, 10) + trail;\n\t\t}\n\t\tcodepoints.push(code);\n\t}\n\treturn codepoints;\n}\n\nfunction stringFromCode(code) {\n\tif(code <= 0xffff) return String.fromCharCode(code);\n\t// Otherwise, encode astral char as surrogate pair.\n\tcode -= Math.pow(2, 21);\n\tvar lead = Math.floor(code/Math.pow(2, 10)) + 0xd800;\n\tvar trail = code % Math.pow(2, 10); + 0xdc00;\n\treturn String.fromCharCode(lead) + String.fromCharCode(trail);\n}\n\nfunction tokenize(str) {\n\tstr = preprocess(str);\n\tvar i = -1;\n\tvar tokens = new TokenList();\n\tvar code;\n\n\t// Line number information.\n\tvar line = 0;\n\tvar column = 0;\n\t// The only use of lastLineLength is in reconsume().\n\tvar lastLineLength = 0;\n\tvar incrLineno = function() {\n\t\tline += 1;\n\t\tlastLineLength = column;\n\t\tcolumn = 0;\n\t};\n\tvar locStart = {line:line, column:column};\n\n\tvar codepoint = function(i) {\n\t\tif(i >= str.length) {\n\t\t\treturn -1;\n\t\t}\n\t\treturn str[i];\n\t}\n\tvar next = function(num) {\n\t\tif(num === undefined) { num = 1; }\n\t\tif(num > 3) { throw \"Spec Error: no more than three codepoints of lookahead.\"; }\n\t\treturn codepoint(i+num);\n\t};\n\tvar consume = function(num) {\n\t\tif(num === undefined)\n\t\t\tnum = 1;\n\t\ti += num;\n\t\tcode = codepoint(i);\n\t\tif(newline(code)) incrLineno();\n\t\telse column += num;\n\t\t//console.log('Consume '+i+' '+String.fromCharCode(code) + ' 0x' + code.toString(16));\n\t\treturn true;\n\t};\n\tvar reconsume = function() {\n\t\ti -= 1;\n\t\tif (newline(code)) {\n\t\t\tline -= 1;\n\t\t\tcolumn = lastLineLength;\n\t\t} else {\n\t\t\tcolumn -= 1;\n\t\t}\n\t\tlocStart.line = line;\n\t\tlocStart.column = column;\n\t\treturn true;\n\t};\n\tvar eof = function(codepoint) {\n\t\tif(codepoint === undefined) codepoint = code;\n\t\treturn codepoint == -1;\n\t};\n\tvar donothing = function() {};\n\tvar tokenizeerror = function() { console.log(\"Parse error at index \" + i + \", processing codepoint 0x\" + code.toString(16) + \".\");return true; };\n\n\tvar consumeAToken = function() {\n\t\tconsumeComments();\n\t\tconsume();\n\t\tif(whitespace(code)) {\n\t\t\twhile(whitespace(next())) consume();\n\t\t\treturn new WhitespaceToken;\n\t\t}\n\t\telse if(code == 0x22) return consumeAStringToken();\n\t\telse if(code == 0x23) {\n\t\t\tif(namechar(next()) || areAValidEscape(next(1), next(2))) {\n\t\t\t\tvar token = new HashToken();\n\t\t\t\tif(wouldStartAnIdentifier(next(1), next(2), next(3))) token.type = \"id\";\n\t\t\t\ttoken.value = consumeAName();\n\t\t\t\treturn token;\n\t\t\t} else {\n\t\t\t\treturn new DelimToken(code);\n\t\t\t}\n\t\t}\n\t\telse if(code == 0x24) {\n\t\t\tif(next() == 0x3d) {\n\t\t\t\tconsume();\n\t\t\t\treturn new SuffixMatchToken();\n\t\t\t} else {\n\t\t\t\treturn new DelimToken(code);\n\t\t\t}\n\t\t}\n\t\telse if(code == 0x27) return consumeAStringToken();\n\t\telse if(code == 0x28) return new OpenParenToken();\n\t\telse if(code == 0x29) return new CloseParenToken();\n\t\telse if(code == 0x2a) {\n\t\t\tif(next() == 0x3d) {\n\t\t\t\tconsume();\n\t\t\t\treturn new SubstringMatchToken();\n\t\t\t} else {\n\t\t\t\treturn new DelimToken(code);\n\t\t\t}\n\t\t}\n\t\telse if(code == 0x2b) {\n\t\t\tif(startsWithANumber()) {\n\t\t\t\treconsume();\n\t\t\t\treturn consumeANumericToken();\n\t\t\t} else {\n\t\t\t\treturn new DelimToken(code);\n\t\t\t}\n\t\t}\n\t\telse if(code == 0x2c) return new CommaToken();\n\t\telse if(code == 0x2d) {\n\t\t\tif(startsWithANumber()) {\n\t\t\t\treconsume();\n\t\t\t\treturn consumeANumericToken();\n\t\t\t} else if(next(1) == 0x2d && next(2) == 0x3e) {\n\t\t\t\tconsume(2);\n\t\t\t\treturn new CDCToken();\n\t\t\t} else if(startsWithAnIdentifier()) {\n\t\t\t\treconsume();\n\t\t\t\treturn consumeAnIdentlikeToken();\n\t\t\t} else {\n\t\t\t\treturn new DelimToken(code);\n\t\t\t}\n\t\t}\n\t\telse if(code == 0x2e) {\n\t\t\tif(startsWithANumber()) {\n\t\t\t\treconsume();\n\t\t\t\treturn consumeANumericToken();\n\t\t\t} else {\n\t\t\t\treturn new DelimToken(code);\n\t\t\t}\n\t\t}\n\t\telse if(code == 0x3a) return new ColonToken;\n\t\telse if(code == 0x3b) return new SemicolonToken;\n\t\telse if(code == 0x3c) {\n\t\t\tif(next(1) == 0x21 && next(2) == 0x2d && next(3) == 0x2d) {\n\t\t\t\tconsume(3);\n\t\t\t\treturn new CDOToken();\n\t\t\t} else {\n\t\t\t\treturn new DelimToken(code);\n\t\t\t}\n\t\t}\n\t\telse if(code == 0x40) {\n\t\t\tif(wouldStartAnIdentifier(next(1), next(2), next(3))) {\n\t\t\t\treturn new AtKeywordToken(consumeAName());\n\t\t\t} else {\n\t\t\t\treturn new DelimToken(code);\n\t\t\t}\n\t\t}\n\t\telse if(code == 0x5b) return new OpenSquareToken();\n\t\telse if(code == 0x5c) {\n\t\t\tif(startsWithAValidEscape()) {\n\t\t\t\treconsume();\n\t\t\t\treturn consumeAnIdentlikeToken();\n\t\t\t} else {\n\t\t\t\ttokenizeerror();\n\t\t\t\treturn new DelimToken(code);\n\t\t\t}\n\t\t}\n\t\telse if(code == 0x5d) return new CloseSquareToken();\n\t\telse if(code == 0x5e) {\n\t\t\tif(next() == 0x3d) {\n\t\t\t\tconsume();\n\t\t\t\treturn new PrefixMatchToken();\n\t\t\t} else {\n\t\t\t\treturn new DelimToken(code);\n\t\t\t}\n\t\t}\n\t\telse if(code == 0x7b) return new OpenCurlyToken();\n\t\telse if(code == 0x7c) {\n\t\t\tif(next() == 0x3d) {\n\t\t\t\tconsume();\n\t\t\t\treturn new DashMatchToken();\n\t\t\t} else if(next() == 0x7c) {\n\t\t\t\tconsume();\n\t\t\t\treturn new ColumnToken();\n\t\t\t} else {\n\t\t\t\treturn new DelimToken(code);\n\t\t\t}\n\t\t}\n\t\telse if(code == 0x7d) return new CloseCurlyToken();\n\t\telse if(code == 0x7e) {\n\t\t\tif(next() == 0x3d) {\n\t\t\t\tconsume();\n\t\t\t\treturn new IncludeMatchToken();\n\t\t\t} else {\n\t\t\t\treturn new DelimToken(code);\n\t\t\t}\n\t\t}\n\t\telse if(digit(code)) {\n\t\t\treconsume();\n\t\t\treturn consumeANumericToken();\n\t\t}\n\t\telse if(namestartchar(code)) {\n\t\t\treconsume();\n\t\t\treturn consumeAnIdentlikeToken();\n\t\t}\n\t\telse if(eof()) return new EOFToken();\n\t\telse return new DelimToken(code);\n\t};\n\n\tvar consumeComments = function() {\n\t\twhile(next(1) == 0x2f && next(2) == 0x2a) {\n\t\t\tconsume(2);\n\t\t\twhile(true) {\n\t\t\t\tconsume();\n\t\t\t\tif(code == 0x2a && next() == 0x2f) {\n\t\t\t\t\tconsume();\n\t\t\t\t\tbreak;\n\t\t\t\t} else if(eof()) {\n\t\t\t\t\ttokenizeerror();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tvar consumeANumericToken = function() {\n\t\tvar num = consumeANumber();\n\t\tif(wouldStartAnIdentifier(next(1), next(2), next(3))) {\n\t\t\tvar token = new DimensionToken();\n\t\t\ttoken.value = num.value;\n\t\t\ttoken.repr = num.repr;\n\t\t\ttoken.type = num.type;\n\t\t\ttoken.unit = consumeAName();\n\t\t\treturn token;\n\t\t} else if(next() == 0x25) {\n\t\t\tconsume();\n\t\t\tvar token = new PercentageToken();\n\t\t\ttoken.value = num.value;\n\t\t\ttoken.repr = num.repr;\n\t\t\treturn token;\n\t\t} else {\n\t\t\tvar token = new NumberToken();\n\t\t\ttoken.value = num.value;\n\t\t\ttoken.repr = num.repr;\n\t\t\ttoken.type = num.type;\n\t\t\treturn token;\n\t\t}\n\t};\n\n\tvar consumeAnIdentlikeToken = function() {\n\t\tvar str = consumeAName();\n\t\tif(str.toLowerCase() == \"url\" && next() == 0x28) {\n\t\t\tconsume();\n\t\t\twhile(whitespace(next(1)) && whitespace(next(2))) consume();\n\t\t\tif(next() == 0x22 || next() == 0x27) {\n\t\t\t\treturn new FunctionToken(str);\n\t\t\t} else if(whitespace(next()) && (next(2) == 0x22 || next(2) == 0x27)) {\n\t\t\t\treturn new FunctionToken(str);\n\t\t\t} else {\n\t\t\t\treturn consumeAURLToken();\n\t\t\t}\n\t\t} else if(next() == 0x28) {\n\t\t\tconsume();\n\t\t\treturn new FunctionToken(str);\n\t\t} else {\n\t\t\treturn new IdentifierToken(str);\n\t\t}\n\t};\n\n\tvar consumeAStringToken = function(endingCodePoint) {\n\t\tif(endingCodePoint === undefined) endingCodePoint = code;\n\t\tvar string = \"\";\n\t\twhile(consume()) {\n\t\t\tif(code == endingCodePoint || eof()) {\n\t\t\t\treturn new StringToken(string);\n\t\t\t} else if(newline(code)) {\n\t\t\t\ttokenizeerror();\n\t\t\t\treconsume();\n\t\t\t\treturn new BadStringToken();\n\t\t\t} else if(code == 0x5c) {\n\t\t\t\tif(eof(next())) {\n\t\t\t\t\tdonothing();\n\t\t\t\t} else if(newline(next())) {\n\t\t\t\t\tconsume();\n\t\t\t\t} else {\n\t\t\t\t\tstring += stringFromCode(consumeEscape())\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tstring += stringFromCode(code);\n\t\t\t}\n\t\t}\n\t};\n\n\tvar consumeAURLToken = function() {\n\t\tvar token = new URLToken(\"\");\n\t\twhile(whitespace(next())) consume();\n\t\tif(eof(next())) return token;\n\t\twhile(consume()) {\n\t\t\tif(code == 0x29 || eof()) {\n\t\t\t\treturn token;\n\t\t\t} else if(whitespace(code)) {\n\t\t\t\twhile(whitespace(next())) consume();\n\t\t\t\tif(next() == 0x29 || eof(next())) {\n\t\t\t\t\tconsume();\n\t\t\t\t\treturn token;\n\t\t\t\t} else {\n\t\t\t\t\tconsumeTheRemnantsOfABadURL();\n\t\t\t\t\treturn new BadURLToken();\n\t\t\t\t}\n\t\t\t} else if(code == 0x22 || code == 0x27 || code == 0x28 || nonprintable(code)) {\n\t\t\t\ttokenizeerror();\n\t\t\t\tconsumeTheRemnantsOfABadURL();\n\t\t\t\treturn new BadURLToken();\n\t\t\t} else if(code == 0x5c) {\n\t\t\t\tif(startsWithAValidEscape()) {\n\t\t\t\t\ttoken.value += stringFromCode(consumeEscape());\n\t\t\t\t} else {\n\t\t\t\t\ttokenizeerror();\n\t\t\t\t\tconsumeTheRemnantsOfABadURL();\n\t\t\t\t\treturn new BadURLToken();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttoken.value += stringFromCode(code);\n\t\t\t}\n\t\t}\n\t};\n\n\tvar consumeEscape = function() {\n\t\t// Assume the the current character is the \\\n\t\t// and the next code point is not a newline.\n\t\tconsume();\n\t\tif(hexdigit(code)) {\n\t\t\t// Consume 1-6 hex digits\n\t\t\tvar digits = [code];\n\t\t\tfor(var total = 0; total < 5; total++) {\n\t\t\t\tif(hexdigit(next())) {\n\t\t\t\t\tconsume();\n\t\t\t\t\tdigits.push(code);\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(whitespace(next())) consume();\n\t\t\tvar value = parseInt(digits.map(function(x){return String.fromCharCode(x);}).join(''), 16);\n\t\t\tif( value > maximumallowedcodepoint ) value = 0xfffd;\n\t\t\treturn value;\n\t\t} else if(eof()) {\n\t\t\treturn 0xfffd;\n\t\t} else {\n\t\t\treturn code;\n\t\t}\n\t};\n\n\tvar areAValidEscape = function(c1, c2) {\n\t\tif(c1 != 0x5c) return false;\n\t\tif(newline(c2)) return false;\n\t\treturn true;\n\t};\n\tvar startsWithAValidEscape = function() {\n\t\treturn areAValidEscape(code, next());\n\t};\n\n\tvar wouldStartAnIdentifier = function(c1, c2, c3) {\n\t\tif(c1 == 0x2d) {\n\t\t\treturn namestartchar(c2) || c2 == 0x2d || areAValidEscape(c2, c3);\n\t\t} else if(namestartchar(c1)) {\n\t\t\treturn true;\n\t\t} else if(c1 == 0x5c) {\n\t\t\treturn areAValidEscape(c1, c2);\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t};\n\tvar startsWithAnIdentifier = function() {\n\t\treturn wouldStartAnIdentifier(code, next(1), next(2));\n\t};\n\n\tvar wouldStartANumber = function(c1, c2, c3) {\n\t\tif(c1 == 0x2b || c1 == 0x2d) {\n\t\t\tif(digit(c2)) return true;\n\t\t\tif(c2 == 0x2e && digit(c3)) return true;\n\t\t\treturn false;\n\t\t} else if(c1 == 0x2e) {\n\t\t\tif(digit(c2)) return true;\n\t\t\treturn false;\n\t\t} else if(digit(c1)) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t};\n\tvar startsWithANumber = function() {\n\t\treturn wouldStartANumber(code, next(1), next(2));\n\t};\n\n\tvar consumeAName = function() {\n\t\tvar result = \"\";\n\t\twhile(consume()) {\n\t\t\tif(namechar(code)) {\n\t\t\t\tresult += stringFromCode(code);\n\t\t\t} else if(startsWithAValidEscape()) {\n\t\t\t\tresult += stringFromCode(consumeEscape());\n\t\t\t} else {\n\t\t\t\treconsume();\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\t};\n\n\tvar consumeANumber = function() {\n\t\tvar repr = '';\n\t\tvar type = \"integer\";\n\t\tif(next() == 0x2b || next() == 0x2d) {\n\t\t\tconsume();\n\t\t\trepr += stringFromCode(code);\n\t\t}\n\t\twhile(digit(next())) {\n\t\t\tconsume();\n\t\t\trepr += stringFromCode(code);\n\t\t}\n\t\tif(next(1) == 0x2e && digit(next(2))) {\n\t\t\tconsume();\n\t\t\trepr += stringFromCode(code);\n\t\t\tconsume();\n\t\t\trepr += stringFromCode(code);\n\t\t\ttype = \"number\";\n\t\t\twhile(digit(next())) {\n\t\t\t\tconsume();\n\t\t\t\trepr += stringFromCode(code);\n\t\t\t}\n\t\t}\n\t\tvar c1 = next(1), c2 = next(2), c3 = next(3);\n\t\tif((c1 == 0x45 || c1 == 0x65) && digit(c2)) {\n\t\t\tconsume();\n\t\t\trepr += stringFromCode(code);\n\t\t\tconsume();\n\t\t\trepr += stringFromCode(code);\n\t\t\ttype = \"number\";\n\t\t\twhile(digit(next())) {\n\t\t\t\tconsume();\n\t\t\t\trepr += stringFromCode(code);\n\t\t\t}\n\t\t} else if((c1 == 0x45 || c1 == 0x65) && (c2 == 0x2b || c2 == 0x2d) && digit(c3)) {\n\t\t\tconsume();\n\t\t\trepr += stringFromCode(code);\n\t\t\tconsume();\n\t\t\trepr += stringFromCode(code);\n\t\t\tconsume();\n\t\t\trepr += stringFromCode(code);\n\t\t\ttype = \"number\";\n\t\t\twhile(digit(next())) {\n\t\t\t\tconsume();\n\t\t\t\trepr += stringFromCode(code);\n\t\t\t}\n\t\t}\n\t\tvar value = convertAStringToANumber(repr);\n\t\treturn {type:type, value:value, repr:repr};\n\t};\n\n\tvar convertAStringToANumber = function(string) {\n\t\t// CSS's number rules are identical to JS, afaik.\n\t\treturn +string;\n\t};\n\n\tvar consumeTheRemnantsOfABadURL = function() {\n\t\twhile(consume()) {\n\t\t\tif(code == 0x2d || eof()) {\n\t\t\t\treturn;\n\t\t\t} else if(startsWithAValidEscape()) {\n\t\t\t\tconsumeEscape();\n\t\t\t\tdonothing();\n\t\t\t} else {\n\t\t\t\tdonothing();\n\t\t\t}\n\t\t}\n\t};\n\n\n\n\tvar iterationCount = 0;\n\twhile(!eof(next())) {\n\t\ttokens.push(consumeAToken());\n\t\tif(iterationCount++ > str.length*2) throw new Error(\"The CSS Tokenizer is infinite-looping\");\n\t}\n\treturn tokens;\n}\n\nfunction CSSParserToken() { return this; }\nCSSParserToken.prototype.toJSON = function() {\n\treturn {token: this.tokenType};\n}\nCSSParserToken.prototype.toString = function() { return this.tokenType; }\nCSSParserToken.prototype.toCSSString = function() { return ''+this; }\n\nfunction BadStringToken() { return this; }\nBadStringToken.prototype = new CSSParserToken;\nBadStringToken.prototype.tokenType = \"BADSTRING\";\nBadStringToken.prototype.toCSSString = function() { return \"'\"; }\n\nfunction BadURLToken() { return this; }\nBadURLToken.prototype = new CSSParserToken;\nBadURLToken.prototype.tokenType = \"BADURL\";\nBadURLToken.prototype.toCSSString = function() { return \"url(\"; }\n\nfunction WhitespaceToken() { return this; }\nWhitespaceToken.prototype = new CSSParserToken;\nWhitespaceToken.prototype.tokenType = \"WHITESPACE\";\nWhitespaceToken.prototype.toString = function() { return \"WS\"; }\nWhitespaceToken.prototype.toCSSString = function() { return \" \"; }\n\nfunction CDOToken() { return this; }\nCDOToken.prototype = new CSSParserToken;\nCDOToken.prototype.tokenType = \"CDO\";\nCDOToken.prototype.toCSSString = function() { return \"<!--\"; }\n\nfunction CDCToken() { return this; }\nCDCToken.prototype = new CSSParserToken;\nCDCToken.prototype.tokenType = \"CDC\";\nCDCToken.prototype.toCSSString = function() { return \"-->\"; }\n\nfunction ColonToken() { return this; }\nColonToken.prototype = new CSSParserToken;\nColonToken.prototype.tokenType = \":\";\n\nfunction SemicolonToken() { return this; }\nSemicolonToken.prototype = new CSSParserToken;\nSemicolonToken.prototype.tokenType = \";\";\n\nfunction CommaToken() { return this; }\nCommaToken.prototype = new CSSParserToken;\nCommaToken.prototype.tokenType = \",\";\nCommaToken.prototype.value = \";\"; // backwards-compat with DELIM token\n\nfunction GroupingToken() { return this; }\nGroupingToken.prototype = new CSSParserToken;\n\nfunction OpenCurlyToken() { this.value = \"{\"; this.mirror = \"}\"; return this; }\nOpenCurlyToken.prototype = new GroupingToken;\nOpenCurlyToken.prototype.tokenType = \"{\";\n\nfunction CloseCurlyToken() { this.value = \"}\"; this.mirror = \"{\"; return this; }\nCloseCurlyToken.prototype = new GroupingToken;\nCloseCurlyToken.prototype.tokenType = \"}\";\n\nfunction OpenSquareToken() { this.value = \"[\"; this.mirror = \"]\"; return this; }\nOpenSquareToken.prototype = new GroupingToken;\nOpenSquareToken.prototype.tokenType = \"[\";\n\nfunction CloseSquareToken() { this.value = \"]\"; this.mirror = \"[\"; return this; }\nCloseSquareToken.prototype = new GroupingToken;\nCloseSquareToken.prototype.tokenType = \"]\";\n\nfunction OpenParenToken() { this.value = \"(\"; this.mirror = \")\"; return this; }\nOpenParenToken.prototype = new GroupingToken;\nOpenParenToken.prototype.tokenType = \"(\";\n\nfunction CloseParenToken() { this.value = \")\"; this.mirror = \"(\"; return this; }\nCloseParenToken.prototype = new GroupingToken;\nCloseParenToken.prototype.tokenType = \")\";\n\nfunction IncludeMatchToken() { return this; }\nIncludeMatchToken.prototype = new CSSParserToken;\nIncludeMatchToken.prototype.tokenType = \"~=\";\n\nfunction DashMatchToken() { return this; }\nDashMatchToken.prototype = new CSSParserToken;\nDashMatchToken.prototype.tokenType = \"|=\";\n\nfunction PrefixMatchToken() { return this; }\nPrefixMatchToken.prototype = new CSSParserToken;\nPrefixMatchToken.prototype.tokenType = \"^=\";\n\nfunction SuffixMatchToken() { return this; }\nSuffixMatchToken.prototype = new CSSParserToken;\nSuffixMatchToken.prototype.tokenType = \"$=\";\n\nfunction SubstringMatchToken() { return this; }\nSubstringMatchToken.prototype = new CSSParserToken;\nSubstringMatchToken.prototype.tokenType = \"*=\";\n\nfunction ColumnToken() { return this; }\nColumnToken.prototype = new CSSParserToken;\nColumnToken.prototype.tokenType = \"||\";\n\nfunction EOFToken() { return this; }\nEOFToken.prototype = new CSSParserToken;\nEOFToken.prototype.tokenType = \"EOF\";\nEOFToken.prototype.toCSSString = function() { return \"\"; }\n\nfunction DelimToken(code) {\n\tthis.value = stringFromCode(code);\n\treturn this;\n}\nDelimToken.prototype = new CSSParserToken;\nDelimToken.prototype.tokenType = \"DELIM\";\nDelimToken.prototype.toString = function() { return \"DELIM(\"+this.value+\")\"; }\nDelimToken.prototype.toCSSString = function() {\n\treturn (this.value == \"\\\\\") ? \"\\\\\\n\" : this.value;\n}\n\nfunction StringValuedToken() { return this; }\nStringValuedToken.prototype = new CSSParserToken;\nStringValuedToken.prototype.ASCIIMatch = function(str) {\n\treturn this.value.toLowerCase() == str.toLowerCase();\n}\n\nfunction IdentifierToken(val) {\n\tthis.value = val;\n}\nIdentifierToken.prototype = new StringValuedToken;\nIdentifierToken.prototype.tokenType = \"IDENT\";\nIdentifierToken.prototype.toString = function() { return \"IDENT(\"+this.value+\")\"; }\nIdentifierToken.prototype.toCSSString = function() {\n\treturn escapeIdent(this.value);\n}\n\nfunction FunctionToken(val) {\n\tthis.value = val;\n\tthis.mirror = \")\";\n}\nFunctionToken.prototype = new StringValuedToken;\nFunctionToken.prototype.tokenType = \"FUNCTION\";\nFunctionToken.prototype.toString = function() { return \"FUNCTION(\"+this.value+\")\"; }\nFunctionToken.prototype.toCSSString = function() {\n\treturn escapeIdent(this.value) + \"(\";\n}\n\t\nfunction AtKeywordToken(val) {\n\tthis.value = val;\n}\nAtKeywordToken.prototype = new StringValuedToken;\nAtKeywordToken.prototype.tokenType = \"AT-KEYWORD\";\nAtKeywordToken.prototype.toString = function() { return \"AT(\"+this.value+\")\"; }\nAtKeywordToken.prototype.toCSSString = function() {\n\treturn \"@\" + escapeIdent(this.value);\n}\n\nfunction HashToken(val) {\n\tthis.value = val;\n\tthis.type = \"unrestricted\";\n}\nHashToken.prototype = new StringValuedToken;\nHashToken.prototype.tokenType = \"HASH\";\nHashToken.prototype.toString = function() { return \"HASH(\"+this.value+\")\"; }\nHashToken.prototype.toCSSString = function() {\n\tvar escapeValue = (this.type == \"id\") ? escapeIdent : escapeHash;\n\treturn \"#\" + escapeValue(this.value);\n}\n\nfunction StringToken(val) {\nthis.value = val;\n}\nStringToken.prototype = new StringValuedToken;\nStringToken.prototype.tokenType = \"STRING\";\nStringToken.prototype.toString = function() {\n\treturn '\"' + escapeString(this.value) + '\"';\n}\n\nfunction URLToken(val) {\n\tthis.value = val;\n}\nURLToken.prototype = new StringValuedToken;\nURLToken.prototype.tokenType = \"URL\";\nURLToken.prototype.toString = function() { return \"URL(\"+this.value+\")\"; }\nURLToken.prototype.toCSSString = function() {\n\treturn 'url(\"' + escapeString(this.value) + '\")';\n}\n\nfunction NumberToken() {\n\tthis.value = null;\n\tthis.type = \"integer\";\n\tthis.repr = \"\";\n}\nNumberToken.prototype = new CSSParserToken;\nNumberToken.prototype.tokenType = \"NUMBER\";\nNumberToken.prototype.toString = function() {\n\tif(this.type == \"integer\")\n\t\treturn \"INT(\"+this.value+\")\";\n\treturn \"NUMBER(\"+this.value+\")\";\n}\nNumberToken.prototype.toJSON = function() {\n\tvar json = this.constructor.prototype.constructor.prototype.toJSON.call(this);\n\tjson.value = this.value;\n\tjson.type = this.type;\n\tjson.repr = this.repr;\n\treturn json;\n}\nNumberToken.prototype.toCSSString = function() { return this.repr; };\n\nfunction PercentageToken() {\n\tthis.value = null;\n\tthis.repr = \"\";\n}\nPercentageToken.prototype = new CSSParserToken;\nPercentageToken.prototype.tokenType = \"PERCENTAGE\";\nPercentageToken.prototype.toString = function() { return \"PERCENTAGE(\"+this.value+\")\"; }\nPercentageToken.prototype.toCSSString = function() { return this.repr + \"%\"; }\n\nfunction DimensionToken() {\n\tthis.value = null;\n\tthis.type = \"integer\";\n\tthis.repr = \"\";\n\tthis.unit = \"\";\n}\nDimensionToken.prototype = new CSSParserToken;\nDimensionToken.prototype.tokenType = \"DIMENSION\";\nDimensionToken.prototype.toString = function() { return \"DIM(\"+this.value+\",\"+this.unit+\")\"; }\nDimensionToken.prototype.toCSSString = function() {\n\tvar source = this.repr;\n\tvar unit = escapeIdent(this.unit);\n\tif(unit[0].toLowerCase() == \"e\" && (unit[1] == \"-\" || between(unit.charCodeAt(1), 0x30, 0x39))) {\n\t\t// Unit is ambiguous with scinot\n\t\t// Remove the leading \"e\", replace with escape.\n\t\tunit = \"\\\\65 \" + unit.slice(1, unit.length);\n\t}\n\treturn source+unit;\n}\n\nfunction escapeIdent(string) {\n\tstring = ''+string;\n\tvar result = '';\n\tvar firstcode = string.charCodeAt(0);\n\tfor(var i = 0; i < string.length; i++) {\n\t\tvar code = string.charCodeAt(i);\n\t\tif(code == 0x0) {\n\t\t\tthrow new InvalidCharacterError('Invalid character: the input contains U+0000.');\n\t\t}\n\n\t\tif(\n\t\t\tbetween(code, 0x1, 0x1f) || code == 0x7f ||\n\t\t\t(i == 0 && between(code, 0x30, 0x39)) ||\n\t\t\t(i == 1 && between(code, 0x30, 0x39) && firstcode == 0x2d)\n\t\t) {\n\t\t\tresult += '\\\\' + code.toString(16) + ' ';\n\t\t} else if(\n\t\t\tcode >= 0x80 ||\n\t\t\tcode == 0x2d ||\n\t\t\tcode == 0x5f ||\n\t\t\tbetween(code, 0x30, 0x39) ||\n\t\t\tbetween(code, 0x41, 0x5a) ||\n\t\t\tbetween(code, 0x61, 0x7a)\n\t\t) {\n\t\t\tresult += string[i];\n\t\t} else {\n\t\t\tresult += '\\\\' + string[i];\n\t\t}\n\t}\n\treturn result;\n}\n\nfunction escapeHash(string) {\n\t// Escapes the contents of \"unrestricted\"-type hash tokens.\n\t// Won't preserve the ID-ness of \"id\"-type hash tokens;\n\t// use escapeIdent() for that.\n\tstring = ''+string;\n\tvar result = '';\n\tvar firstcode = string.charCodeAt(0);\n\tfor(var i = 0; i < string.length; i++) {\n\t\tvar code = string.charCodeAt(i);\n\t\tif(code == 0x0) {\n\t\t\tthrow new InvalidCharacterError('Invalid character: the input contains U+0000.');\n\t\t}\n\n\t\tif(\n\t\t\tcode >= 0x80 ||\n\t\t\tcode == 0x2d ||\n\t\t\tcode == 0x5f ||\n\t\t\tbetween(code, 0x30, 0x39) ||\n\t\t\tbetween(code, 0x41, 0x5a) ||\n\t\t\tbetween(code, 0x61, 0x7a)\n\t\t) {\n\t\t\tresult += string[i];\n\t\t} else {\n\t\t\tresult += '\\\\' + code.toString(16) + ' ';\n\t\t}\n\t}\n\treturn result;\n}\n\nfunction escapeString(string) {\n\tstring = ''+string;\n\tvar result = '';\n\tfor(var i = 0; i < string.length; i++) {\n\t\tvar code = string.charCodeAt(i);\n\n\t\tif(code == 0x0) {\n\t\t\tthrow new InvalidCharacterError('Invalid character: the input contains U+0000.');\n\t\t}\n\n\t\tif(between(code, 0x1, 0x1f) || code == 0x7f) {\n\t\t\tresult += '\\\\' + code.toString(16) + ' ';\n\t\t} else if(code == 0x22 || code == 0x5c) {\n\t\t\tresult += '\\\\' + string[i];\n\t\t} else {\n\t\t\tresult += string[i];\n\t\t}\n\t}\n\treturn result;\n}\n\n// Exportation.\ncssSyntax.tokenize = tokenize;\ncssSyntax.IdentToken = IdentifierToken;\ncssSyntax.IdentifierToken = IdentifierToken;\ncssSyntax.FunctionToken = FunctionToken;\ncssSyntax.AtKeywordToken = AtKeywordToken;\ncssSyntax.HashToken = HashToken;\ncssSyntax.StringToken = StringToken;\ncssSyntax.BadStringToken = BadStringToken;\ncssSyntax.URLToken = URLToken;\ncssSyntax.BadURLToken = BadURLToken;\ncssSyntax.DelimToken = DelimToken;\ncssSyntax.NumberToken = NumberToken;\ncssSyntax.PercentageToken = PercentageToken;\ncssSyntax.DimensionToken = DimensionToken;\ncssSyntax.IncludeMatchToken = IncludeMatchToken;\ncssSyntax.DashMatchToken = DashMatchToken;\ncssSyntax.PrefixMatchToken = PrefixMatchToken;\ncssSyntax.SuffixMatchToken = SuffixMatchToken;\ncssSyntax.SubstringMatchToken = SubstringMatchToken;\ncssSyntax.ColumnToken = ColumnToken;\ncssSyntax.WhitespaceToken = WhitespaceToken;\ncssSyntax.CDOToken = CDOToken;\ncssSyntax.CDCToken = CDCToken;\ncssSyntax.ColonToken = ColonToken;\ncssSyntax.SemicolonToken = SemicolonToken;\ncssSyntax.CommaToken = CommaToken;\ncssSyntax.OpenParenToken = OpenParenToken;\ncssSyntax.CloseParenToken = CloseParenToken;\ncssSyntax.OpenSquareToken = OpenSquareToken;\ncssSyntax.CloseSquareToken = CloseSquareToken;\ncssSyntax.OpenCurlyToken = OpenCurlyToken;\ncssSyntax.CloseCurlyToken = CloseCurlyToken;\ncssSyntax.EOFToken = EOFToken;\ncssSyntax.CSSParserToken = CSSParserToken;\ncssSyntax.GroupingToken = GroupingToken;\n\n//\n// css parser\n//\n\nfunction TokenStream(tokens) {\n\t// Assume that tokens is an array.\n\tthis.tokens = tokens;\n\tthis.i = -1;\n}\nTokenStream.prototype.tokenAt = function(i) {\n\tif(i < this.tokens.length)\n\t\treturn this.tokens[i];\n\treturn new EOFToken();\n}\nTokenStream.prototype.consume = function(num) {\n\tif(num === undefined) num = 1;\n\tthis.i += num;\n\tthis.token = this.tokenAt(this.i);\n\t//console.log(this.i, this.token);\n\treturn true;\n}\nTokenStream.prototype.next = function() {\n\treturn this.tokenAt(this.i+1);\n}\nTokenStream.prototype.reconsume = function() {\n\tthis.i--;\n}\n\nfunction parseerror(s, msg) {\n\tconsole.log(\"Parse error at token \" + s.i + \": \" + s.token + \".\\n\" + msg);\n\treturn true;\n}\nfunction donothing(){ return true; };\n\nfunction consumeAListOfRules(s, topLevel) {\n\tvar rules = new TokenList();\n\tvar rule;\n\twhile(s.consume()) {\n\t\tif(s.token instanceof WhitespaceToken) {\n\t\t\tcontinue;\n\t\t} else if(s.token instanceof EOFToken) {\n\t\t\treturn rules;\n\t\t} else if(s.token instanceof CDOToken || s.token instanceof CDCToken) {\n\t\t\tif(topLevel == \"top-level\") continue;\n\t\t\ts.reconsume();\n\t\t\tif(rule = consumeAStyleRule(s)) rules.push(rule);\n\t\t} else if(s.token instanceof AtKeywordToken) {\n\t\t\ts.reconsume();\n\t\t\tif(rule = consumeAnAtRule(s)) rules.push(rule);\n\t\t} else {\n\t\t\ts.reconsume();\n\t\t\tif(rule = consumeAStyleRule(s)) rules.push(rule);\n\t\t}\n\t}\n}\n\nfunction consumeAnAtRule(s) {\n\ts.consume();\n\tvar rule = new AtRule(s.token.value);\n\twhile(s.consume()) {\n\t\tif(s.token instanceof SemicolonToken || s.token instanceof EOFToken) {\n\t\t\treturn rule;\n\t\t} else if(s.token instanceof OpenCurlyToken) {\n\t\t\trule.value = consumeASimpleBlock(s);\n\t\t\treturn rule;\n\t\t} else if(s.token instanceof SimpleBlock && s.token.name == \"{\") {\n\t\t\trule.value = s.token;\n\t\t\treturn rule;\n\t\t} else {\n\t\t\ts.reconsume();\n\t\t\trule.prelude.push(consumeAComponentValue(s));\n\t\t}\n\t}\n}\n\nfunction consumeAStyleRule(s) {\n\tvar rule = new StyleRule();\n\twhile(s.consume()) {\n\t\tif(s.token instanceof EOFToken) {\n\t\t\tparseerror(s, \"Hit EOF when trying to parse the prelude of a qualified rule.\");\n\t\t\treturn;\n\t\t} else if(s.token instanceof OpenCurlyToken) {\n\t\t\trule.value = consumeASimpleBlock(s);\n\t\t\treturn rule;\n\t\t} else if(s.token instanceof SimpleBlock && s.token.name == \"{\") {\n\t\t\trule.value = s.token;\n\t\t\treturn rule;\n\t\t} else {\n\t\t\ts.reconsume();\n\t\t\trule.prelude.push(consumeAComponentValue(s));\n\t\t}\n\t}\n}\n\nfunction consumeAListOfDeclarations(s) {\n\tvar decls = new TokenList();\n\twhile(s.consume()) {\n\t\tif(s.token instanceof WhitespaceToken || s.token instanceof SemicolonToken) {\n\t\t\tdonothing();\n\t\t} else if(s.token instanceof EOFToken) {\n\t\t\treturn decls;\n\t\t} else if(s.token instanceof AtKeywordToken) {\n\t\t\ts.reconsume();\n\t\t\tdecls.push(consumeAnAtRule(s));\n\t\t} else if(s.token instanceof IdentifierToken) {\n\t\t\tvar temp = [s.token];\n\t\t\twhile(!(s.next() instanceof SemicolonToken || s.next() instanceof EOFToken))\n\t\t\t\ttemp.push(consumeAComponentValue(s));\n\t\t\tvar decl;\n\t\t\tif(decl = consumeADeclaration(new TokenStream(temp))) decls.push(decl);\n\t\t} else {\n\t\t\tparseerror(s);\n\t\t\ts.reconsume();\n\t\t\twhile(!(s.next() instanceof SemicolonToken || s.next() instanceof EOFToken))\n\t\t\t\tconsumeAComponentValue(s);\n\t\t}\n\t}\n}\n\nfunction consumeADeclaration(s) {\n\t// Assumes that the next input token will be an ident token.\n\ts.consume();\n\tvar decl = new Declaration(s.token.value);\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\n\tif(!(s.next() instanceof ColonToken)) {\n\t\tparseerror(s);\n\t\treturn;\n\t} else {\n\t\ts.consume();\n\t}\n\twhile(!(s.next() instanceof EOFToken)) {\n\t\tdecl.value.push(consumeAComponentValue(s));\n\t}\n\tvar foundImportant = false;\n\tfor(var i = decl.value.length - 1; i >= 0; i--) {\n\t\tif(decl.value[i] instanceof WhitespaceToken) {\n\t\t\tcontinue;\n\t\t} else if(decl.value[i] instanceof IdentifierToken && decl.value[i].ASCIIMatch(\"important\")) {\n\t\t\tfoundImportant = true;\n\t\t} else if(foundImportant && decl.value[i] instanceof DelimToken && decl.value[i].value == \"!\") {\n\t\t\tdecl.value.splice(i, decl.value.length);\n\t\t\tdecl.important = true;\n\t\t\tbreak;\n\t\t} else {\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn decl;\n}\n\nfunction consumeAComponentValue(s) {\n\ts.consume();\n\tif(s.token instanceof OpenCurlyToken || s.token instanceof OpenSquareToken || s.token instanceof OpenParenToken)\n\t\treturn consumeASimpleBlock(s);\n\tif(s.token instanceof FunctionToken)\n\t\treturn consumeAFunction(s);\n\treturn s.token;\n}\n\nfunction consumeASimpleBlock(s) {\n\tvar mirror = s.token.mirror;\n\tvar block = new SimpleBlock(s.token.value);\n\twhile(s.consume()) {\n\t\tif(s.token instanceof EOFToken || (s.token instanceof GroupingToken && s.token.value == mirror))\n\t\t\treturn block;\n\t\telse {\n\t\t\ts.reconsume();\n\t\t\tblock.value.push(consumeAComponentValue(s));\n\t\t}\n\t}\n}\n\nfunction consumeAFunction(s) {\n\tvar func = new Func(s.token.value);\n\twhile(s.consume()) {\n\t\tif(s.token instanceof EOFToken || s.token instanceof CloseParenToken)\n\t\t\treturn func;\n\t\telse {\n\t\t\ts.reconsume();\n\t\t\tfunc.value.push(consumeAComponentValue(s));\n\t\t}\n\t}\n}\n\nfunction normalizeInput(input) {\n\tif(typeof input == \"string\")\n\t\treturn new TokenStream(tokenize(input));\n\tif(input instanceof TokenStream)\n\t\treturn input;\n\tif(input.length !== undefined)\n\t\treturn new TokenStream(input);\n\telse throw SyntaxError(input);\n}\n\nfunction parseAStylesheet(s) {\n\ts = normalizeInput(s);\n\tvar sheet = new Stylesheet();\n\tsheet.value = consumeAListOfRules(s, \"top-level\");\n\treturn sheet;\n}\n\nfunction parseAListOfRules(s) {\n\ts = normalizeInput(s);\n\treturn consumeAListOfRules(s);\n}\n\nfunction parseARule(s) {\n\ts = normalizeInput(s);\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\n\tif(s.next() instanceof EOFToken) throw SyntaxError();\n\tif(s.next() instanceof AtKeywordToken) {\n\t\tvar rule = consumeAnAtRule(s);\n\t} else {\n\t\tvar rule = consumeAStyleRule(s);\n\t\tif(!rule) throw SyntaxError();\n\t}\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\n\tif(s.next() instanceof EOFToken)\n\t\treturn rule;\n\tthrow SyntaxError();\n}\n\nfunction parseADeclaration(s) {\n\ts = normalizeInput(s);\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\n\tif(!(s.next() instanceof IdentifierToken)) throw SyntaxError();\n\tvar decl = consumeADeclaration(s);\n\tif(!decl) { throw new SyntaxError() }\n\treturn decl;\n}\n\nfunction parseAListOfDeclarations(s) {\n\ts = normalizeInput(s);\n\treturn consumeAListOfDeclarations(s);\n}\n\nfunction parseAComponentValue(s) {\n\ts = normalizeInput(s);\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\n\tif(s.next() instanceof EOFToken) throw SyntaxError();\n\tvar val = consumeAComponentValue(s);\n\tif(!val) throw SyntaxError();\n\twhile(s.next() instanceof WhitespaceToken) s.consume();\n\tif(!(s.next() instanceof EOFToken)) throw new SyntaxError();\n\treturn val;\n}\n\nfunction parseAListOfComponentValues(s) {\n\ts = normalizeInput(s);\n\tvar vals = new TokenList();\n\twhile(true) {\n\t\tvar val = consumeAComponentValue(s);\n\t\tif(val instanceof EOFToken)\n\t\t\treturn vals\n\t\telse\n\t\t\tvals.push(val);\n\t}\n}\n\nfunction parseACommaSeparatedListOfComponentValues(s) {\n\ts = normalizeInput(s);\n\tvar listOfCVLs = new TokenList();\n\twhile(true) {\n\t\tvar vals = new TokenList();\n\t\twhile(true) {\n\t\t\tvar val = consumeAComponentValue(s);\n\t\t\tif(val instanceof EOFToken) {\n\t\t\t\tlistOfCVLs.push(vals);\n\t\t\t\treturn listOfCVLs;\n\t\t\t} else if(val instanceof CommaToken) {\n\t\t\t\tlistOfCVLs.push(vals);\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tvals.push(val);\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction CSSParserRule() { return this; }\nCSSParserRule.prototype.toString = function(indent) {\n\treturn JSON.stringify(this,null,indent);\n}\n\nfunction Stylesheet() {\n\tthis.value = new TokenList();\n\treturn this;\n}\nStylesheet.prototype = new CSSParserRule;\nStylesheet.prototype.type = \"STYLESHEET\";\nStylesheet.prototype.toCSSString = function() { return this.value.toCSSString(\"\\n\"); }\n\nfunction AtRule(name) {\n\tthis.name = name;\n\tthis.prelude = new TokenList();\n\tthis.value = null;\n\treturn this;\n}\nAtRule.prototype = new CSSParserRule;\nAtRule.prototype.toCSSString = function() { \n\tif(this.value) {\n\t\treturn \"@\" + escapeIdent(this.name) + \" \" + this.prelude.toCSSString() + this.value.toCSSString(); \n\t} else {\n\t\treturn \"@\" + escapeIdent(this.name) + \" \" + this.prelude.toCSSString() + '; '; \n\t}\n}\nAtRule.prototype.toStylesheet = function() {\n\treturn this.asStylesheet || (this.asStylesheet = this.value ? parseAStylesheet(this.value.value) : new Stylesheet());\n}\n\nfunction StyleRule() {\n\tthis.prelude = new TokenList(); this.selector = this.prelude;\n\tthis.value = null;\n\treturn this;\n}\nStyleRule.prototype = new CSSParserRule;\nStyleRule.prototype.type = \"STYLE-RULE\";\nStyleRule.prototype.toCSSString = function() {\n\treturn this.prelude.toCSSString() + this.value.toCSSString();\n}\nStyleRule.prototype.getSelector = function() {\n\treturn this.prelude;\n}\nStyleRule.prototype.getDeclarations = function() {\n\tif(!(this.value instanceof SimpleBlock)) { return new TokenList(); }\n\tvar value = this.value.value; return parseAListOfDeclarations(value);\n}\n\n\nfunction Declaration(name) {\n\tthis.name = name;\n\tthis.value = new TokenList();\n\tthis.important = false;\n\treturn this;\n}\nDeclaration.prototype = new CSSParserRule;\nDeclaration.prototype.type = \"DECLARATION\";\nDeclaration.prototype.toCSSString = function() {\n\treturn this.name + ':' + this.value.toCSSString() + '; ';\n}\n\nfunction SimpleBlock(type) {\n\tthis.name = type;\n\tthis.value = new TokenList();\n\treturn this;\n}\nSimpleBlock.prototype = new CSSParserRule;\nSimpleBlock.prototype.type = \"BLOCK\";\nSimpleBlock.prototype.toCSSString = function() {\n\tswitch(this.name) {\n\t\tcase \"(\":\n\t\t\treturn \"(\" + this.value.toCSSString() + \")\";\n\t\t\t\n\t\tcase \"[\":\n\t\t\treturn \"[\" + this.value.toCSSString() + \"]\";\n\t\t\t\n\t\tcase \"{\":\n\t\t\treturn \"{\" + this.value.toCSSString() + \"}\";\n\t\t\n\t\tdefault: //best guess\n\t\t\treturn this.name + this.value.toCSSString() + this.name;\n\t}\n}\n\nfunction Func(name) {\n\tthis.name = name;\n\tthis.value = new TokenList();\n\treturn this;\n}\nFunc.prototype = new CSSParserRule;\nFunc.prototype.type = \"FUNCTION\";\nFunc.prototype.toCSSString = function() {\n\treturn this.name+'('+this.value.toCSSString()+')';\n}\nFunc.prototype.getArguments = function() {\n\tvar args = new TokenList(); var arg = new TokenList(); var value = this.value;\n\tfor(var i = 0; i<value.length; i++) {\n\t\tif(value[i].tokenType == ',') {\n\t\t\targs.push(arg); arg = new TokenList();\n\t\t} else {\n\t\t\targ.push(value[i])\n\t\t}\n\t}\n\tif(args.length > 0 || arg.length > 0) { args.push(arg); }\n\treturn args;\n}\n\nfunction FuncArg() {\n\tthis.value = new TokenList();\n\treturn this;\n}\nFuncArg.prototype = new CSSParserRule;\nFuncArg.prototype.type = \"FUNCTION-ARG\";\nFuncArg.prototype.toCSSString = function() {\n\treturn this.value.toCSSString()+', ';\n}\n\n// Exportation.\ncssSyntax.CSSParserRule = CSSParserRule;\ncssSyntax.Stylesheet = Stylesheet;\ncssSyntax.AtRule = AtRule;\ncssSyntax.StyleRule = StyleRule;\ncssSyntax.Declaration = Declaration;\ncssSyntax.SimpleBlock = SimpleBlock;\ncssSyntax.Func = Func;\ncssSyntax.parseAStylesheet = parseAStylesheet;\ncssSyntax.parseAListOfRules = parseAListOfRules;\ncssSyntax.parseARule = parseARule;\ncssSyntax.parseADeclaration = parseADeclaration;\ncssSyntax.parseAListOfDeclarations = parseAListOfDeclarations;\ncssSyntax.parseAComponentValue = parseAComponentValue;\ncssSyntax.parseAListOfComponentValues = parseAListOfComponentValues;\ncssSyntax.parseACommaSeparatedListOfComponentValues = parseACommaSeparatedListOfComponentValues;\ncssSyntax.parse = parseAStylesheet;\ncssSyntax.parseCSSValue = parseAListOfComponentValues;\n\nreturn cssSyntax;\n\n}());\n\nrequire.define('src/core/css-syntax.js');\n\n////////////////////////////////////////\n\nvoid function() {\n\t\n\t// request animation frame\n    var vendors = ['webkit', 'moz', 'ms', 'o'];\n    for (var i = 0; i < vendors.length && !window.requestAnimationFrame; ++i) {\n        var vp = vendors[i];\n        window.requestAnimationFrame = window[vp+'RequestAnimationFrame'];\n        window.cancelAnimationFrame = (window[vp+'CancelAnimationFrame'] || window[vp+'CancelRequestAnimationFrame']);\n    }\n    if (!window.requestAnimationFrame || !window.cancelAnimationFrame) {\n\t\t\n\t\t// tick every 16ms\n        var listener_index = 0; var listeners = []; var tmp = []; var tick = function() {\n\t\t\tvar now = +(new Date()); var callbacks = listeners; listeners = tmp;\n\t\t\tfor(var i = 0; i<callbacks.length; i++) { callbacks[i](now); }\n\t\t\tlistener_index += callbacks.length; callbacks.length = 0; tmp = callbacks;\n\t\t\tsetTimeout(tick, 16);\n\t\t}; tick();\n\t\t\n\t\t// add a listener\n        window.requestAnimationFrame = function(callback) {\n            return listener_index + listeners.push(callback);\n        };\n\t\t\n\t\t// remove a listener\n        window.cancelAnimationFrame = function(index) {\n\t\t\tindex -= listener_index; if(index >= 0 && index < listeners.length) {\n\t\t\t\tlisteners[index] = function() {};\n\t\t\t}\n\t\t};\n\t\t\n    }\n\t\n\t// setImmediate\n\tif(!window.setImmediate) {\n\t\twindow.setImmediate = function(f) { return setTimeout(f, 0) };\n\t\twindow.cancelImmediate = clearTimeout;\n\t}\n\t\n}();\n\nrequire.define('src/core/polyfill-dom-requestAnimationFrame.js');\n\n////////////////////////////////////////\n\n/////////////////////////////////////////////////////////////////\n////                                                         ////\n////                 prerequirements of qSL                  ////\n////                                                         ////\n/////////////////////////////////////////////////////////////////\n////                                                         ////\n////   Please note that I require querySelectorAll to work   ////\n////                                                         ////\n////   See http://github.com/termi/CSS_selector_engine/      ////\n////   for a polyfill for older browsers                     ////\n////                                                         ////\n/////////////////////////////////////////////////////////////////\n\n// TODO: improve event streams\n// - look for a few optimizations ideas in gecko/webkit\n// - use arrays in CompositeEventStream to avoid nested debouncings\nmodule.exports = (function(window, document) { \"use strict\";\n\n\t///\n\t/// event stream implementation\n\t/// please note this is required to 'live update' the qSA requests\n\t///\n\tfunction EventStream(connect, disconnect, reconnect) {\n\t\tvar self=this;\n\t\t\n\t\t// validate arguments\n\t\tif(!disconnect) disconnect=function(){};\n\t\tif(!reconnect) reconnect=connect;\n\t\t\n\t\t// high-level states\n\t\tvar isConnected=false;\n\t\tvar isDisconnected=false;\n\t\tvar shouldDisconnect=false;\n\t\t\n\t\t// global variables\n\t\tvar callback=null;\n\t\tvar yieldEvent = function() {\n\t\t\t\n\t\t\t// call the callback function, and pend disposal\n\t\t\tshouldDisconnect=true;\n\t\t\ttry { callback && callback(self); } catch(ex) { setImmediate(function() { throw ex; }); }\n\t\t\t\n\t\t\t// if no action was taken, dispose\n\t\t\tif(shouldDisconnect) { dispose(); }\n\t\t\t\n\t\t}\n\t\t\n\t\t// export the interface\n\t\tvar schedule = this.schedule = function(newCallback) {\n\t\t\n\t\t\t// do not allow to schedule on disconnected event streams\n\t\t\tif(isDisconnected) { throw new Error(\"Cannot schedule on a disconnected event stream\"); }\n\t\t\t\n\t\t\t// do not allow to schedule on already scheduled event streams\n\t\t\tif(isConnected && !shouldDisconnect) { throw new Error(\"Cannot schedule on an already-scheduled event stream\"); }\n\t\t\t\n\t\t\t// schedule the new callback\n\t\t\tcallback=newCallback; shouldDisconnect=false;\n\t\t\t\n\t\t\t// reconnect to the stream\n\t\t\tif(isConnected) {\n\t\t\t\treconnect(yieldEvent);\n\t\t\t} else {\n\t\t\t\tconnect(yieldEvent);\n\t\t\t\tisConnected=true;\n\t\t\t}\n\t\t}\n\t\t\n\t\tvar dispose = this.dispose = function() {\n\t\t\n\t\t\t// do not allow to dispose non-connected streams\n\t\t\tif(isConnected) {\n\t\t\t\n\t\t\t\t// disconnect & save resources\n\t\t\t\tdisconnect(); \n\t\t\t\tself=null; yieldEvent=null; callback=null; \n\t\t\t\tisConnected=false; isDisconnected=true; shouldDisconnect=false;\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t}\n\n\t///\n\t/// call a function every frame\n\t///\n\tfunction AnimationFrameEventStream(options) {\n\t\t\n\t\t// flag that says whether the observer is still needed or not\n\t\tvar rid = 0;\n\t\t\t\n\t\t// start the event stream\n\t\tEventStream.call(\n\t\t\tthis, \n\t\t\tfunction connect(yieldEvent) { rid = requestAnimationFrame(yieldEvent); },\n\t\t\tfunction disconnect() { cancelAnimationFrame(rid); }\n\t\t);\n\t\t\n\t}\n\n\t///\n\t/// call a function every timeout\n\t///\n\tfunction TimeoutEventStream(options) {\n\t\t\n\t\t// flag that says whether the observer is still needed or not\n\t\tvar rid = 0; var timeout=(typeof(options)==\"number\") ? (+options) : (\"timeout\" in options ? +options.timeout : 333);\n\t\t\t\n\t\t// start the event stream\n\t\tEventStream.call(\n\t\t\tthis, \n\t\t\tfunction connect(yieldEvent) { rid = setTimeout(yieldEvent, timeout); },\n\t\t\tfunction disconnect() { clearTimeout(rid); }\n\t\t);\n\t\t\n\t}\n\n\t///\n\t/// call a function every time the mouse moves\n\t///\n\tfunction MouseEventStream() {\n\t\tvar self=this; var pointermove = ((\"PointerEvent\" in window) ? \"pointermove\" : ((\"MSPointerEvent\" in window) ? \"MSPointerMove\" : \"mousemove\"));\n\n\t\t// flag that says whether the event is still observed or not\n\t\tvar scheduled = false; var interval=0;\n\t\t\n\t\t// handle the synchronous nature of mutation events\n\t\tvar yieldEvent=null;\n\t\tvar yieldEventDelayed = function() {\n\t\t\tif(scheduled) return;\n\t\t\twindow.removeEventListener(pointermove, yieldEventDelayed, true);\n\t\t\tscheduled = requestAnimationFrame(yieldEvent);\n\t\t}\n\t\t\n\t\t// start the event stream\n\t\tEventStream.call(\n\t\t\tthis, \n\t\t\tfunction connect(newYieldEvent) {\n\t\t\t\tyieldEvent=newYieldEvent;\n\t\t\t\twindow.addEventListener(pointermove, yieldEventDelayed, true);\n\t\t\t},\n\t\t\tfunction disconnect() { \n\t\t\t\twindow.removeEventListener(pointermove, yieldEventDelayed, true);\n\t\t\t\tcancelAnimationFrame(scheduled); yieldEventDelayed=null; yieldEvent=null; scheduled=false;\n\t\t\t},\n\t\t\tfunction reconnect(newYieldEvent) { \n\t\t\t\tyieldEvent=newYieldEvent; scheduled=false;\n\t\t\t\twindow.addEventListener(pointermove, yieldEventDelayed, true);\n\t\t\t}\n\t\t);\n\t\t\n\t}\n\n\t///\n\t/// call a function every time the mouse is clicked/unclicked\n\t///\n\tfunction MouseButtonEventStream() {\n\t\tvar self=this; \n\t\tvar pointerup = ((\"PointerEvent\" in window) ? \"pointerup\" : ((\"MSPointerEvent\" in window) ? \"MSPointerUp\" : \"mouseup\"));\n\t\tvar pointerdown = ((\"PointerEvent\" in window) ? \"pointerdown\" : ((\"MSPointerEvent\" in window) ? \"MSPointerDown\" : \"mousedown\"));\n\n\t\t// flag that says whether the event is still observed or not\n\t\tvar scheduled = false; var interval=0;\n\t\t\n\t\t// handle the synchronous nature of mutation events\n\t\tvar yieldEvent=null;\n\t\tvar yieldEventDelayed = function() {\n\t\t\tif(scheduled) return;\n\t\t\twindow.removeEventListener(pointerup, yieldEventDelayed, true);\n\t\t\twindow.removeEventListener(pointerdown, yieldEventDelayed, true);\n\t\t\tscheduled = requestAnimationFrame(yieldEvent);\n\t\t}\n\t\t\n\t\t// start the event stream\n\t\tEventStream.call(\n\t\t\tthis, \n\t\t\tfunction connect(newYieldEvent) {\n\t\t\t\tyieldEvent=newYieldEvent;\n\t\t\t\twindow.addEventListener(pointerup, yieldEventDelayed, true);\n\t\t\t\twindow.addEventListener(pointerdown, yieldEventDelayed, true);\n\t\t\t},\n\t\t\tfunction disconnect() { \n\t\t\t\twindow.removeEventListener(pointerup, yieldEventDelayed, true);\n\t\t\t\twindow.removeEventListener(pointerdown, yieldEventDelayed, true);\n\t\t\t\tcancelAnimationFrame(scheduled); yieldEventDelayed=null; yieldEvent=null; scheduled=false;\n\t\t\t},\n\t\t\tfunction reconnect(newYieldEvent) { \n\t\t\t\tyieldEvent=newYieldEvent; scheduled=false;\n\t\t\t\twindow.addEventListener(pointerup, yieldEventDelayed, true);\n\t\t\t\twindow.addEventListener(pointerdown, yieldEventDelayed, true);\n\t\t\t}\n\t\t);\n\t\t\n\t}\n\n\t///\n\t/// call a function whenever the DOM is modified\n\t///\n\tvar DOMUpdateEventStream;\n\tif(\"MutationObserver\" in window) {\n\t\tDOMUpdateEventStream = function DOMUpdateEventStream(options) {\n\t\t\t \n\t\t\t// configuration of the observer\n\t\t\tif(options) {\n\t\t\t\tvar target = \"target\" in options ? options.target : document.documentElement;\n\t\t\t\tvar config = { \n\t\t\t\t\tsubtree: \"subtree\" in options ? !!options.subtree : true, \n\t\t\t\t\tattributes: \"attributes\" in options ? !!options.attributes : true, \n\t\t\t\t\tchildList: \"childList\" in options ? !!options.childList : true, \n\t\t\t\t\tcharacterData: \"characterData\" in options ? !!options.characterData : false\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tvar target = document.documentElement;\n\t\t\t\tvar config = { \n\t\t\t\t\tsubtree: true, \n\t\t\t\t\tattributes: true, \n\t\t\t\t\tchildList: true, \n\t\t\t\t\tcharacterData: false\n\t\t\t\t};\n\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t// start the event stream\n\t\t\tvar observer = null;\n\t\t\tEventStream.call(\n\t\t\t\tthis, \n\t\t\t\tfunction connect(yieldEvent) { if(config) { observer=new MutationObserver(yieldEvent); observer.observe(target,config); target=null; config=null; } },\n\t\t\t\tfunction disconnect() { observer && observer.disconnect(); observer=null; },\n\t\t\t\tfunction reconnect() { observer.takeRecords(); }\n\t\t\t);\n\n\t\t}\n\t} else if(\"MutationEvent\" in window) {\n\t\tDOMUpdateEventStream = function DOMUpdateEventStream(options) {\n\t\t\tvar self=this;\n\n\t\t\t// flag that says whether the event is still observed or not\n\t\t\tvar scheduled = false;\n\t\t\t\n\t\t\t// configuration of the observer\n\t\t\tif(options) {\n\t\t\t\tvar target = \"target\" in options ? options.target : document.documentElement;\n\t\t\t} else {\n\t\t\t\tvar target = document.documentElement;\n\t\t\t}\n\t\t\t\n\t\t\t// handle the synchronous nature of mutation events\n\t\t\tvar yieldEvent=null;\n\t\t\tvar yieldEventDelayed = function() {\n\t\t\t\tif(scheduled || !yieldEventDelayed) return;\n\t\t\t\tdocument.removeEventListener(\"DOMContentLoaded\", yieldEventDelayed, false);\n\t\t\t\tdocument.removeEventListener(\"DOMContentLoaded\", yieldEventDelayed, false);\n\t\t\t\ttarget.removeEventListener(\"DOMSubtreeModified\", yieldEventDelayed, false);\n\t\t\t\tscheduled = requestAnimationFrame(yieldEvent);\n\t\t\t}\n\t\t\t\n\t\t\t// start the event stream\n\t\t\tEventStream.call(\n\t\t\t\tthis, \n\t\t\t\tfunction connect(newYieldEvent) {\n\t\t\t\t\tyieldEvent=newYieldEvent;\n\t\t\t\t\tdocument.addEventListener(\"DOMContentLoaded\", yieldEventDelayed, false);\n\t\t\t\t\ttarget.addEventListener(\"DOMSubtreeModified\", yieldEventDelayed, false);\n\t\t\t\t},\n\t\t\t\tfunction disconnect() { \n\t\t\t\t\tdocument.removeEventListener(\"DOMContentLoaded\", yieldEventDelayed, false);\n\t\t\t\t\ttarget.removeEventListener(\"DOMSubtreeModified\", yieldEventDelayed, false);\n\t\t\t\t\tcancelAnimationFrame(scheduled); yieldEventDelayed=null; yieldEvent=null; scheduled=false;\n\t\t\t\t},\n\t\t\t\tfunction reconnect(newYieldEvent) { \n\t\t\t\t\tyieldEvent=newYieldEvent; scheduled=false;\n\t\t\t\t\ttarget.addEventListener(\"DOMSubtreeModified\", yieldEventDelayed, false);\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t}\n\t} else {\n\t\tDOMUpdateEventStream = AnimationFrameEventStream;\n\t}\n\n\t///\n\t/// call a function every time the focus shifts\n\t///\n\tfunction FocusEventStream() {\n\t\tvar self=this;\n\t\t\n\t\t// handle the filtering nature of focus events\n\t\tvar yieldEvent=null; var previousActiveElement=null; var previousHasFocus=false; var rid=0;\n\t\tvar yieldEventDelayed = function() {\n\t\t\t\n\t\t\t// if the focus didn't change\n\t\t\tif(previousActiveElement==document.activeElement && previousHasFocus==document.hasFocus()) {\n\t\t\t\t\n\t\t\t\t// then do not generate an event\n\t\t\t\tsetTimeout(yieldEventDelayed, 333); // focus that didn't move is expected to stay\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\t// else, generate one & save config\n\t\t\t\tpreviousActiveElement=document.activeElement;\n\t\t\t\tpreviousHasFocus=document.hasFocus();\n\t\t\t\tyieldEvent();\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t\t\n\t\t// start the event stream\n\t\tEventStream.call(\n\t\t\tthis, \n\t\t\tfunction connect(newYieldEvent) {\n\t\t\t\tyieldEvent=newYieldEvent;\n\t\t\t\trid=setTimeout(yieldEventDelayed, 500); // let the document load\n\t\t\t},\n\t\t\tfunction disconnect() { \n\t\t\t\tclearTimeout(rid); yieldEventDelayed=null; yieldEvent=null; rid=0;\n\t\t\t},\n\t\t\tfunction reconnect(newYieldEvent) { \n\t\t\t\tyieldEvent=newYieldEvent;\n\t\t\t\trid=setTimeout(yieldEventDelayed, 100); // focus by tab navigation moves fast\n\t\t\t}\n\t\t);\n\t\t\n\t}\n\n\t///\n\t/// composite event stream\n\t/// because sometimes you need more than one event source\n\t///\n\tfunction CompositeEventStream(stream1, stream2) {\n\t\tvar self=this;\n\t\t\n\t\t// fields\n\t\tvar yieldEvent=null; var s1=false, s2=false;\n\t\tvar yieldEventWrapper=function(s) { \n\t\t\tif(s==stream1) s1=true;\n\t\t\tif(s==stream2) s2=true;\n\t\t\tif(s1&&s2) return;\n\t\t\tyieldEvent(self);\n\t\t}\n\t\t\n\t\t// start the event stream\n\t\tEventStream.call(\n\t\t\tthis, \n\t\t\tfunction connect(newYieldEvent) {\n\t\t\t\tyieldEvent=newYieldEvent;\n\t\t\t\tstream1.schedule(yieldEventWrapper);\n\t\t\t\tstream2.schedule(yieldEventWrapper);\n\t\t\t},\n\t\t\tfunction disconnect() { \n\t\t\t\tstream1.dispose();\n\t\t\t\tstream2.dispose();\n\t\t\t},\n\t\t\tfunction reconnect(newYieldEvent) { \n\t\t\t\tyieldEvent=newYieldEvent;\n\t\t\t\ts1 && stream1.schedule(yieldEventWrapper);\n\t\t\t\ts2 && stream2.schedule(yieldEventWrapper);\n\t\t\t\ts1 = s2 = false;\n\t\t\t}\n\t\t);\n\t}\n\t\n\treturn {\n\t\tEventStream:                EventStream,\n\t\tAnimationFrameEventStream:  AnimationFrameEventStream,\n\t\tTimeoutEventStream:         TimeoutEventStream,\n\t\tMouseEventStream:           MouseEventStream,\n\t\tMouseButtonEventStream:     MouseButtonEventStream,\n\t\tDOMUpdateEventStream:       DOMUpdateEventStream,\n\t\tFocusEventStream:           FocusEventStream,\n\t\tCompositeEventStream:       CompositeEventStream\n\t};\n\n})(window, document);\nrequire.define('src/core/dom-experimental-event-streams.js');\n\n////////////////////////////////////////\n\n/////////////////////////////////////////////////////////////////\n////                                                         ////\n////                  Implementation of qSL                  ////\n////                                                         ////\n/////////////////////////////////////////////////////////////////\n////                                                         ////\n////   Please note that I require querySelectorAll to work   ////\n////                                                         ////\n////   See http://github.com/termi/CSS_selector_engine/      ////\n////   for a polyfill for older browsers                     ////\n////                                                         ////\n/////////////////////////////////////////////////////////////////\n\nmodule.exports = (function(window, document) { \"use strict\";\n\n\t// import dependencies\n\tvar eventStreams = require('src/core/dom-experimental-event-streams.js'),\n\t    DOMUpdateEventStream = eventStreams.DOMUpdateEventStream,\n\t\tAnimationFrameEventStream = eventStreams.AnimationFrameEventStream,\n\t\tCompositeEventStream = eventStreams.CompositeEventStream,\n\t\tFocusEventStream = eventStreams.FocusEventStream,\n\t\tMouseButtonEventStream = eventStreams.MouseButtonEventStream,\n\t\tTimeoutEventStream = eventStreams.TimeoutEventStream,\n\t\tMouseEventStream = eventStreams.MouseEventStream;\n\n\t///\n\t/// the live querySelectorAll implementation\n\t///\n\tfunction querySelectorLive(selector, handler, root) {\n\t\t\n\t\t// restrict the selector coverage to some part of the DOM only\n\t\tvar root = root || document;\n\t\t\n\t\t// TODO: make use of \"mutatedAncestorElement\" to update only elements inside the mutated zone\n\t\t\n\t\tvar currentElms = [];\n\t\tvar loop = function loop(eventStream) {\n\t\t\t\n\t\t\t// schedule next run\n\t\t\teventStream.schedule(loop);\n\t\t\t\n\t\t\t// update elements matching the selector\n\t\t\tvar newElms = [];\n\t\t\tvar oldElms = currentElms.slice(0);\n\t\t\tvar temps = root.querySelectorAll(selector);\n\t\t\tfor(var i=newElms.length=temps.length; i;) { newElms.push(temps[--i]); }\n\t\t\tcurrentElms = newElms.slice(0); temps=null;\n\t\t\t\n\t\t\t// first let's clear all elements that have been removed from the document\n\t\t\toldElms = oldElms.filter(function(e) {\n\t\t\t\t\n\t\t\t\t// check whether the current element is still there\n\t\t\t\tvar isStillInDocument = (\n\t\t\t\t\te===document.documentElement \n\t\t\t\t\t|| document.documentElement.contains(e)\n\t\t\t\t);\n\t\t\t\t\n\t\t\t\tif(isStillInDocument) {\n\t\t\t\t\t\n\t\t\t\t\t// NEED_COMPARE: we will compare this element to the new list\n\t\t\t\t\treturn true;\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\t\n\t\t\t\t\t// DELETE: raise onremoved, pop old elements\n\t\t\t\t\ttry { handler.onremoved && handler.onremoved(e); } catch(ex) { setImmediate(function() {throw ex})}\n\t\t\t\t\treturn false;\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t});\n\t\t\t\n\t\t\t// now pop and match until both lists are exhausted\n\t\t\t// (we use the fact the returned elements are in document order)\n\t\t\tvar el1 = oldElms.pop();\n\t\t\tvar el2 = newElms.pop();\n\t\t\twhile(el1 || el2) {\n\t\t\t\tif(el1===el2) {\n\t\t\t\t\n\t\t\t\t\t// MATCH: pop both elements\n\t\t\t\t\tel1 = oldElms.pop();\n\t\t\t\t\tel2 = newElms.pop();\n\t\t\t\t\t\n\t\t\t\t} else if (el2 && /*el1 is after el2*/(!el1||(el2.compareDocumentPosition(el1) & (1|2|8|32))===0)) {\n\t\t\t\t\t\n\t\t\t\t\t// INSERT: raise onadded, pop new elements\n\t\t\t\t\ttry { handler.onadded && handler.onadded(el2); } catch(ex) { setImmediate(function() {throw ex})}\n\t\t\t\t\tel2 = newElms.pop();\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\n\t\t\t\t\t// DELETE: raise onremoved, pop old elements\n\t\t\t\t\ttry { handler.onremoved && handler.onremoved(el1); } catch(ex) { setImmediate(function() {throw ex})}\n\t\t\t\t\tel1 = oldElms.pop();\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t};\n\t\t\n\t\t// use the event stream that best matches our needs\n\t\tvar simpleSelector = selector.replace(/:(dir|lang|root|empty|blank|nth-child|nth-last-child|first-child|last-child|only-child|nth-of-type|nth-last-of-child|fist-of-type|last-of-type|only-of-type|not|matches|default)\\b/gi,'')\n\t\tvar eventStream; if(simpleSelector.indexOf(':') == -1) {\n\t\t\t\n\t\t\t// static stuff only\n\t\t\teventStream = new DOMUpdateEventStream({target:root}); \n\t\t\t\n\t\t} else {\n\t\t\t\n\t\t\t// dynamic stuff too\n\t\t\teventStream = new DOMUpdateEventStream({target:root}); \n\t\t\tif(DOMUpdateEventStream != AnimationFrameEventStream) {\n\t\t\t\n\t\t\t\t// detect the presence of focus-related pseudo-classes\n\t\t\t\tvar reg = /:(focus|active)\\b/gi;\n\t\t\t\tif(reg.test(simpleSelector)) {\n\t\t\t\t\t\n\t\t\t\t\t// mouse events should be listened\n\t\t\t\t\teventStream = new CompositeEventStream(\n\t\t\t\t\t\tnew FocusEventStream(),\n\t\t\t\t\t\teventStream\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\t// simplify simpleSelector\n\t\t\t\t\tvar reg = /:(focus)\\b/gi;\n\t\t\t\t\tsimpleSelector = simpleSelector.replace(reg, ''); // :active has other hooks\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// detect the presence of mouse-button-related pseudo-classes\n\t\t\t\tvar reg = /:(active)\\b/gi;\n\t\t\t\tif(reg.test(simpleSelector)) {\n\t\t\t\t\t\n\t\t\t\t\t// mouse events should be listened\n\t\t\t\t\teventStream = new CompositeEventStream(\n\t\t\t\t\t\tnew MouseButtonEventStream(),\n\t\t\t\t\t\teventStream\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\t// simplify simpleSelector\n\t\t\t\t\tsimpleSelector = simpleSelector.replace(reg, '');\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t// detect the presence of user input pseudo-classes\n\t\t\t\tvar reg = /:(target|checked|indeterminate|valid|invalid|in-range|out-of-range|user-error)\\b/gi;\n\t\t\t\tif(reg.test(simpleSelector)) {\n\t\t\t\t\t\n\t\t\t\t\t// slowly dynamic stuff do happen\n\t\t\t\t\teventStream = new CompositeEventStream(\n\t\t\t\t\t\tnew TimeoutEventStream(250),\n\t\t\t\t\t\teventStream\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\t// simplify simpleSelector\n\t\t\t\t\tsimpleSelector = simpleSelector.replace(reg, '');\n\n\t\t\t\t\tvar reg = /:(any-link|link|visited|local-link|enabled|disabled|read-only|read-write|required|optional)\\b/gi;\n\t\t\t\t\t// simplify simpleSelector\n\t\t\t\t\tsimpleSelector = simpleSelector.replace(reg, '');\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// detect the presence of nearly-static pseudo-classes\n\t\t\t\tvar reg = /:(any-link|link|visited|local-link|enabled|disabled|read-only|read-write|required|optional)\\b/gi;\n\t\t\t\tif(reg.test(simpleSelector)) {\n\t\t\t\t\t\n\t\t\t\t\t// nearly static stuff do happen\n\t\t\t\t\teventStream = new CompositeEventStream(\n\t\t\t\t\t\tnew TimeoutEventStream(333),\n\t\t\t\t\t\teventStream\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\t// simplify simpleSelector\n\t\t\t\t\tsimpleSelector = simpleSelector.replace(reg, '');\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// detect the presence of mouse-related pseudo-classes\n\t\t\t\tvar reg = /:(hover)\\b/gi;\n\t\t\t\tif(reg.test(simpleSelector)) {\n\t\t\t\t\t\n\t\t\t\t\t// mouse events should be listened\n\t\t\t\t\teventStream = new CompositeEventStream(\n\t\t\t\t\t\tnew MouseEventStream(),\n\t\t\t\t\t\teventStream\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\t// simplify simpleSelector\n\t\t\t\t\tsimpleSelector = simpleSelector.replace(reg, '');\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// detect the presence of unknown pseudo-classes\n\t\t\t\tif(simpleSelector.indexOf(':') !== -1) {\n\t\t\t\t\t\n\t\t\t\t\t// other stuff do happen, too (let's give up on events)\n\t\t\t\t\teventStream = new AnimationFrameEventStream(); \n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\t// start handling changes\n\t\tloop(eventStream);\n\t\t\n\t}\n\t\n\treturn querySelectorLive;\n\t\n})(window, document);\nrequire.define('src/core/dom-query-selector-live.js');\n\n////////////////////////////////////////\n\n// TODO: comment about the 'no_auto_stylesheet_detection' flag?\n\nmodule.exports = (function(window, document) { \"use strict\";\n\t\n\t// import dependencies\n\trequire('src/core/polyfill-dom-console.js');\n\trequire('src/core/polyfill-dom-requestAnimationFrame.js');\n\tvar cssSyntax = require('src/core/css-syntax.js');\n\tvar domEvents = require('src/core/dom-events.js');\n\tvar querySelectorLive = require('src/core/dom-query-selector-live.js');\n\t\n\t// define the module\n\tvar cssCascade = {\n\t\t\n\t\t//\n\t\t// returns the priority of a unique selector (NO COMMA!)\n\t\t// { the return value is an integer, with the same formula as webkit }\n\t\t//\n\t\tcomputeSelectorPriorityOf: function computeSelectorPriorityOf(selector) {\n\t\t\tif(typeof selector == \"string\") selector = cssSyntax.parse(selector.trim()+\"{}\").value[0].selector;\n\t\t\t\n\t\t\tvar numberOfIDs = 0;\n\t\t\tvar numberOfClasses = 0;\n\t\t\tvar numberOfTags = 0;\n\t\t\t\n\t\t\t// TODO: improve this parser, or find one on the web\n\t\t\tfor(var i = 0; i < selector.length; i++) {\n\t\t\t\t\n\t\t\t\tif(selector[i] instanceof cssSyntax.IdentifierToken) {\n\t\t\t\t\tnumberOfTags++;\n\t\t\t\t\t\n\t\t\t\t} else if(selector[i] instanceof cssSyntax.DelimToken) {\n\t\t\t\t\tif(selector[i].value==\".\") {\n\t\t\t\t\t\tnumberOfClasses++; i++;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t} else if(selector[i] instanceof cssSyntax.ColonToken) {\n\t\t\t\t\tif(selector[++i] instanceof cssSyntax.ColonToken) {\n\t\t\t\t\t\tnumberOfTags++; i++;\n\t\t\t\t\t\t\n\t\t\t\t\t} else if((selector[i] instanceof cssSyntax.Func) && (/^(not|matches)$/i).test(selector[i].name)) {\n\t\t\t\t\t\tvar nestedPriority = this.computeSelectorPriorityOf(selector[i].value);\n\t\t\t\t\t\tnumberOfTags += nestedPriority % 256; nestedPriority /= 256;\n\t\t\t\t\t\tnumberOfClasses += nestedPriority % 256; nestedPriority /= 256;\n\t\t\t\t\t\tnumberOfIDs += nestedPriority;\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnumberOfClasses++;\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t} else if(selector[i] instanceof cssSyntax.SimpleBlock) {\n\t\t\t\t\tif(selector[i].name==\"[\") {\n\t\t\t\t\t\tnumberOfClasses++;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t} else if(selector[i] instanceof cssSyntax.HashToken) {\n\t\t\t\t\tnumberOfIDs++;\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\t// TODO: stop ignoring unknown symbols?\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\tif(numberOfIDs>255) numberOfIDs=255;\n\t\t\tif(numberOfClasses>255) numberOfClasses=255;\n\t\t\tif(numberOfTags>255) numberOfTags=255;\n\t\t\t\n\t\t\treturn ((numberOfIDs*256)+numberOfClasses)*256+numberOfTags;\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// returns an array of the css rules matching an element\n\t\t//\n\t\tfindAllMatchingRules: function findAllMatchingRules(element) {\n\t\t\treturn this.findAllMatchingRulesWithPseudo(element);\n\t\t},\n\t\t\n\t\t//\n\t\t// returns an array of the css rules matching a pseudo-element\n\t\t//\n\t\tfindAllMatchingRulesWithPseudo: function findAllMatchingRules(element,pseudo) {\n\t\t\tpseudo = pseudo ? (''+pseudo).toLowerCase() : pseudo;\n\t\t\t\n\t\t\t// let's look for new results if needed...\n\t\t\tvar results = [];\n\t\t\t\n\t\t\t// walk the whole stylesheet...\n\t\t\tvar visit = function(rules) {\n\t\t\t\ttry {\n\t\t\t\t\tfor(var r = rules.length; r--; ) {\n\t\t\t\t\t\tvar rule = rules[r]; \n\t\t\t\t\t\t\n\t\t\t\t\t\t// media queries hook\n\t\t\t\t\t\tif(rule.disabled) continue;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(rule instanceof cssSyntax.StyleRule) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// consider each selector independently\n\t\t\t\t\t\t\tvar subrules = rule.subRules || cssCascade.splitRule(rule);\n\t\t\t\t\t\t\tfor(var sr = subrules.length; sr--; ) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tvar selector = subrules[sr].selector.toCSSString().replace(/ *(\\/\\*\\*\\/|  ) */g,' ').trim();\n\t\t\t\t\t\t\t\tif(pseudo) {\n\t\t\t\t\t\t\t\t\t// WE ONLY ACCEPT SELECTORS ENDING WITH THE PSEUDO\n\t\t\t\t\t\t\t\t\tvar selectorLow = selector.toLowerCase();\n\t\t\t\t\t\t\t\t\tvar newLength = selector.length-pseudo.length-1;\n\t\t\t\t\t\t\t\t\tif(newLength<=0) continue;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif(selectorLow.lastIndexOf('::'+pseudo)==newLength-1) {\n\t\t\t\t\t\t\t\t\t\tselector = selector.substr(0,newLength-1);\n\t\t\t\t\t\t\t\t\t} else if(selectorLow.lastIndexOf(':'+pseudo)==newLength) {\n\t\t\t\t\t\t\t\t\t\tselector = selector.substr(0,newLength);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// fix selectors like \"#element > :first-child ~ ::before\"\n\t\t\t\t\t\t\t\t\tif(selector.trim().length == 0) { selector = '*' }\n\t\t\t\t\t\t\t\t\telse if(selector[selector.length-1] == ' ') { selector += '*' }\n\t\t\t\t\t\t\t\t\telse if(selector[selector.length-1] == '+') { selector += '*' }\n\t\t\t\t\t\t\t\t\telse if(selector[selector.length-1] == '>') { selector += '*' }\n\t\t\t\t\t\t\t\t\telse if(selector[selector.length-1] == '~') { selector += '*' }\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// look if the selector matches\n\t\t\t\t\t\t\t\tvar isMatching = false;\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tif(element.matches) isMatching=element.matches(selector)\n\t\t\t\t\t\t\t\t\telse if(element.matchesSelector) isMatching=element.matchesSelector(selector)\n\t\t\t\t\t\t\t\t\telse if(element.oMatchesSelector) isMatching=element.oMatchesSelector(selector)\n\t\t\t\t\t\t\t\t\telse if(element.msMatchesSelector) isMatching=element.msMatchesSelector(selector)\n\t\t\t\t\t\t\t\t\telse if(element.mozMatchesSelector) isMatching=element.mozMatchesSelector(selector)\n\t\t\t\t\t\t\t\t\telse if(element.webkitMatchesSelector) isMatching=element.webkitMatchesSelector(selector)\n\t\t\t\t\t\t\t\t\telse { throw new Error(\"no element.matches?\") }\n\t\t\t\t\t\t\t\t} catch(ex) { debugger; setImmediate(function() { throw ex; }) }\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// if yes, add it to the list of matched selectors\n\t\t\t\t\t\t\t\tif(isMatching) { results.push(subrules[sr]); }\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} else if(rule instanceof cssSyntax.AtRule && rule.name==\"media\") {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// visit them\n\t\t\t\t\t\t\tvisit(rule.toStylesheet().value);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t} catch (ex) {\n\t\t\t\t\tsetImmediate(function() { throw ex; });\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfor(var s=cssCascade.stylesheets.length; s--; ) {\n\t\t\t\tvar rules = cssCascade.stylesheets[s];\n\t\t\t\tvisit(rules);\n\t\t\t}\n\t\t\t\n\t\t\treturn results;\n\t\t},\n\t\t\n\t\t//\n\t\t// a list of all properties supported by the current browser\n\t\t//\n\t\tallCSSProperties: null,\n\t\tgetAllCSSProperties: function getAllCSSProperties() {\n\t\t\t\n\t\t\tif(this.allCSSProperties) return this.allCSSProperties;\n\t\t\t\n\t\t\t// get all claimed properties\n\t\t\tvar s = getComputedStyle(document.documentElement); var ps = new Array(s.length);\n\t\t\tfor(var i=s.length; i--; ) {\n\t\t\t\tps[i] = s[i];\n\t\t\t}\n\t\t\t\n\t\t\t// FIX A BUG WHERE WEBKIT DOESN'T REPORT ALL PROPERTIES\n\t\t\tif(ps.indexOf('content')==-1) {ps.push('content');}\n\t\t\tif(ps.indexOf('counter-reset')==-1) {\n\t\t\t\t\n\t\t\t\tps.push('counter-reset');\n\t\t\t\tps.push('counter-increment');\n\t\t\t\t\n\t\t\t\t// FIX A BUG WHERE WEBKIT RETURNS SHIT FOR THE COMPUTED VALUE OF COUNTER-RESET\n\t\t\t\tcssCascade.computationUnsafeProperties['counter-reset']=true;\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// save in a cache for faster access the next times\n\t\t\treturn this.allCSSProperties = ps;\n\t\t\t\n\t\t},\n\t\t\n\t\t// \n\t\t// those properties are not safe for computation->specified round-tripping\n\t\t// \n\t\tcomputationUnsafeProperties: {\n\t\t\t\"bottom\"          : true,\n\t\t\t\"direction\"       : true,\n\t\t\t\"display\"         : true,\n\t\t\t\"font-size\"       : true,\n\t\t\t\"height\"          : true,\n\t\t\t\"left\"            : true,\n\t\t\t\"line-height\"     : true,\n\t\t\t\"margin-left\"     : true,\n\t\t\t\"margin-right\"    : true,\n\t\t\t\"margin-bottom\"   : true,\n\t\t\t\"margin-top\"      : true,\n\t\t\t\"max-height\"      : true,\n\t\t\t\"max-width\"       : true,\n\t\t\t\"min-height\"      : true,\n\t\t\t\"min-width\"       : true,\n\t\t\t\"padding-left\"    : true,\n\t\t\t\"padding-right\"   : true,\n\t\t\t\"padding-bottom\"  : true,\n\t\t\t\"padding-top\"     : true,\n\t\t\t\"right\"           : true,\n\t\t\t\"text-align\"      : true,\n\t\t\t\"text-align-last\" : true,\n\t\t\t\"top\"             : true,\n\t\t\t\"width\"           : true,\n\t\t\t__proto__         : null,\n\t\t},\n\t\t\n\t\t//\n\t\t// a list of property we should inherit...\n\t\t//\n\t\tinheritingProperties: {\n\t\t\t\"border-collapse\"       : true,\n\t\t\t\"border-spacing\"        : true,\n\t\t\t\"caption-side\"          : true,\n\t\t\t\"color\"                 : true,\n\t\t\t\"cursor\"                : true,\n\t\t\t\"direction\"             : true,\n\t\t\t\"empty-cells\"           : true,\n\t\t\t\"font-family\"           : true,\n\t\t\t\"font-size\"             : true,\n\t\t\t\"font-style\"            : true,\n\t\t\t\"font-variant\"          : true,\n\t\t\t\"font-weight\"           : true,\n\t\t\t\"font\"                  : true,\n\t\t\t\"letter-spacing\"        : true,\n\t\t\t\"line-height\"           : true,\n\t\t\t\"list-style-image\"      : true,\n\t\t\t\"list-style-position\"   : true,\n\t\t\t\"list-style-type\"       : true,\n\t\t\t\"list-style\"            : true,\n\t\t\t\"orphans\"               : true,\n\t\t\t\"quotes\"                : true,\n\t\t\t\"text-align\"            : true,\n\t\t\t\"text-indent\"           : true,\n\t\t\t\"text-transform\"        : true,\n\t\t\t\"visibility\"            : true,\n\t\t\t\"white-space\"           : true,\n\t\t\t\"widows\"                : true,\n\t\t\t\"word-break\"            : true,\n\t\t\t\"word-spacing\"          : true,\n\t\t\t\"word-wrap\"             : true,\n\t\t\t__proto__               : null,\n\t\t},\n\t\t\n\t\t//\n\t\t// returns the default style for a tag\n\t\t//\n\t\tdefaultStylesForTag: Object.create ? Object.create(null) : {},\n\t\tgetDefaultStyleForTag: function getDefaultStyleForTag(tagName) {\n\t\t\t\n\t\t\t// get result from cache\n\t\t\tvar result = this.defaultStylesForTag[tagName];\n\t\t\tif(result) return result;\n\t\t\t\n\t\t\t// create dummy virtual element\n\t\t\tvar element = document.createElement(tagName);\n\t\t\tvar style = this.defaultStylesForTag[tagName] = getComputedStyle(element);\n\t\t\tif(style.display) return style;\n\t\t\t\n\t\t\t// webkit fix: insert the dummy element anywhere (head -> display:none)\n\t\t\tdocument.head.insertBefore(element, document.head.firstChild);\n\t\t\treturn style;\n\t\t},\n\t\t\n\t\t// \n\t\t// returns the specified style of an element. \n\t\t// REMARK: may or may not unwrap \"inherit\" and \"initial\" depending on implementation\n\t\t// REMARK: giving \"matchedRules\" as a parameter allow you to mutualize the \"findAllMatching\" rules calls\n\t\t// \n\t\tgetSpecifiedStyle: function getSpecifiedStyle(element, cssPropertyName, matchedRules) {\n\t\t\t\n\t\t\t// hook for css regions\n\t\t\tvar fragmentSource;\n\t\t\tif(fragmentSource=element.getAttribute('data-css-regions-fragment-of')) {\n\t\t\t\tfragmentSource = document.querySelector('[data-css-regions-fragment-source=\"'+fragmentSource+'\"]');\n\t\t\t\tif(fragmentSource) return cssCascade.getSpecifiedStyle(fragmentSource, cssPropertyName);\n\t\t\t}\n\t\t\t\n\t\t\t// give IE a thumbs up for this!\n\t\t\tif(element.currentStyle && !window.opera) {\n\t\t\t\t\n\t\t\t\t// ask IE to manage the style himself...\n\t\t\t\tvar bestValue = element.myStyle[cssPropertyName] || element.currentStyle[cssPropertyName] || '';\n\t\t\t\t\n\t\t\t\t// return a parsed representation of the value\n\t\t\t\treturn cssSyntax.parseAListOfComponentValues(bestValue);\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\t// TODO: support the \"initial\" and \"inherit\" things?\n\t\t\t\t\n\t\t\t\t// first, let's try inline style as it's fast and generally accurate\n\t\t\t\t// TODO: what if important rules override that?\n\t\t\t\ttry {\n\t\t\t\t\tif(bestValue = element.style.getPropertyValue(cssPropertyName) || element.myStyle[cssPropertyName]) {\n\t\t\t\t\t\treturn cssSyntax.parseAListOfComponentValues(bestValue);\n\t\t\t\t\t}\n\t\t\t\t} catch(ex) {}\n\t\t\t\t\n\t\t\t\t// find all relevant style rules\n\t\t\t\tvar isBestImportant=false; var bestPriority = 0; var bestValue = new cssSyntax.TokenList();\n\t\t\t\tvar rules = matchedRules || (\n\t\t\t\t\tcssPropertyName in cssCascade.monitoredProperties\n\t\t\t\t\t? element.myMatchedRules || []\n\t\t\t\t\t: cssCascade.findAllMatchingRules(element)\n\t\t\t\t);\n\t\t\t\t\n\t\t\t\tvar visit = function(rules) {\n\t\t\t\t\t\n\t\t\t\t\tfor(var i=rules.length; i--; ) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// media queries hook\n\t\t\t\t\t\tif(rules[i].disabled) continue;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// find a relevant declaration\n\t\t\t\t\t\tif(rules[i] instanceof cssSyntax.StyleRule) {\n\t\t\t\t\t\t\tvar decls = rules[i].getDeclarations();\n\t\t\t\t\t\t\tfor(var j=decls.length-1; j>=0; j--) {\n\t\t\t\t\t\t\t\tif(decls[j].type==\"DECLARATION\") {\n\t\t\t\t\t\t\t\t\tif(decls[j].name==cssPropertyName) {\n\t\t\t\t\t\t\t\t\t\t// only works if selectors containing a \",\" are deduplicated\n\t\t\t\t\t\t\t\t\t\tvar currentPriority = cssCascade.computeSelectorPriorityOf(rules[i].selector);\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif(isBestImportant) {\n\t\t\t\t\t\t\t\t\t\t\t// only an important declaration can beat another important declaration\n\t\t\t\t\t\t\t\t\t\t\tif(decls[j].important) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(currentPriority >= bestPriority) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tbestPriority = currentPriority;\n\t\t\t\t\t\t\t\t\t\t\t\t\tbestValue = decls[j].value;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t// an important declaration beats any non-important declaration\n\t\t\t\t\t\t\t\t\t\t\tif(decls[j].important) {\n\t\t\t\t\t\t\t\t\t\t\t\tisBestImportant = true;\n\t\t\t\t\t\t\t\t\t\t\t\tbestPriority = currentPriority;\n\t\t\t\t\t\t\t\t\t\t\t\tbestValue = decls[j].value;\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t// the selector priority has to be higher otherwise\n\t\t\t\t\t\t\t\t\t\t\t\tif(currentPriority >= bestPriority) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tbestPriority = currentPriority;\n\t\t\t\t\t\t\t\t\t\t\t\t\tbestValue = decls[j].value;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if((rules[i] instanceof cssSyntax.AtRule) && (rules[i].name==\"media\")) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// visit them\n\t\t\t\t\t\t\tvisit(rules[i].toStylesheet())\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\tvisit(rules);\n\t\t\t\t\n\t\t\t\t// return our best guess...\n\t\t\t\treturn bestValue||null;\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t\n\t\t\n\t\t//\n\t\t// start monitoring a new stylesheet\n\t\t// (should usually not be used because stylesheets load automatically)\n\t\t//\n\t\tstylesheets: [],\n\t\tloadStyleSheet: function loadStyleSheet(cssText,i) {\n\t\t\t\n\t\t\t// load in order\n\t\t\t\n\t\t\t// parse the stylesheet content\n\t\t\tvar rules = cssSyntax.parse(cssText).value;\n\t\t\t\n\t\t\t// add the stylesheet into the object model\n\t\t\tif(typeof(i)!==\"undefined\") { cssCascade.stylesheets[i]=rules; } \n\t\t\telse { i=cssCascade.stylesheets.push(rules);}\n\t\t\t\n\t\t\t// make sure to monitor the required rules\n\t\t\tcssCascade.startMonitoringStylesheet(rules)\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// start monitoring a new stylesheet\n\t\t// (should usually not be used because stylesheets load automatically)\n\t\t//\n\t\tloadStyleSheetTag: function loadStyleSheetTag(stylesheet,i) {\n\t\t\t\n\t\t\tif(stylesheet.hasAttribute('data-css-polyfilled')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tif(stylesheet.tagName=='LINK') {\n\t\t\t\t\n\t\t\t\t// oh, no, we have to download it...\n\t\t\t\ttry {\n\t\t\t\t\t\n\t\t\t\t\t// dummy value in-between\n\t\t\t\t\tcssCascade.stylesheets[i] = new cssSyntax.TokenList();\n\t\t\t\t\t\n\t\t\t\t\t//\n\t\t\t\t\tvar xhr = new XMLHttpRequest(); xhr.href = stylesheet.href;\n\t\t\t\t\txhr.open('GET',stylesheet.href,true); xhr.ruleIndex = i; \n\t\t\t\t\txhr.onreadystatechange = function() {\n\t\t\t\t\t\tif(this.readyState==4) { \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// status 0 is a webkit bug for local files\n\t\t\t\t\t\t\tif(this.status==200||this.status==0) {\n\t\t\t\t\t\t\t\tcssCascade.loadStyleSheet(this.responseText,this.ruleIndex)\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcssConsole.log(\"css-cascade polyfill failled to load: \" + this.href);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\txhr.send();\n\t\t\t\t\t\n\t\t\t\t} catch(ex) {\n\t\t\t\t\tcssConsole.log(\"css-cascade polyfill failled to load: \" + stylesheet.href);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\t// oh, cool, we just have to parse the content!\n\t\t\t\tcssCascade.loadStyleSheet(stylesheet.textContent,i);\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// mark the stylesheet as ok\n\t\t\tstylesheet.setAttribute('data-css-polyfilled',true);\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// calling this function will load all currently existing stylesheets in the document\n\t\t// (should usually not be used because stylesheets load automatically)\n\t\t//\n\t\tselectorForStylesheets: \"style:not([data-no-css-polyfill]):not([data-css-polyfilled]), link[rel=stylesheet]:not([data-no-css-polyfill]):not([data-css-polyfilled])\",\n\t\tloadAllStyleSheets: function loadAllStyleSheets() {\n\t\t\t\n\t\t\t// for all stylesheets in the <head> tag...\n\t\t\tvar head = document.head || document.documentElement;\n\t\t\tvar stylesheets = head.querySelectorAll(cssCascade.selectorForStylesheets);\n\t\t\t\n\t\t\tvar intialLength = this.stylesheets.length;\n\t\t\tthis.stylesheets.length += stylesheets.length\n\t\t\t\n\t\t\t// for all of them...\n\t\t\tfor(var i = stylesheets.length; i--;) {\n\t\t\t\t\n\t\t\t\t// \n\t\t\t\t// load the stylesheet\n\t\t\t\t// \n\t\t\t\tvar stylesheet = stylesheets[i]; \n\t\t\t\tcssCascade.loadStyleSheetTag(stylesheet,intialLength+i)\n\t\t\t\t\n\t\t\t}\n\t\t},\n\t\t\n\t\t//\n\t\t// this is where we store event handlers for monitored properties\n\t\t//\n\t\tmonitoredProperties: Object.create ? Object.create(null) : {},\n\t\tmonitoredPropertiesHandler: {\n\t\t\tonupdate: function(element, rule) {\n\t\t\t\t\n\t\t\t\t// we need to find all regexps that matches\n\t\t\t\tvar mps = cssCascade.monitoredProperties;\n\t\t\t\tvar decls = rule.getDeclarations();\n\t\t\t\tfor(var j=decls.length-1; j>=0; j--) {\n\t\t\t\t\tif(decls[j].type==\"DECLARATION\") {\n\t\t\t\t\t\tif(decls[j].name in mps) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// call all handlers waiting for this\n\t\t\t\t\t\t\tvar hs = mps[decls[j].name];\n\t\t\t\t\t\t\tfor(var hi=hs.length; hi--;) {\n\t\t\t\t\t\t\t\ths[hi].onupdate(element,rule);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// don't call twice\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t},\n\t\t\n\t\t//\n\t\t// add an handler to some properties (aka fire when their value *MAY* be affected)\n\t\t// REMARK: because this event does not promise the value changed, you may want to figure it out before relayouting\n\t\t//\n\t\tstartMonitoringProperties: function startMonitoringProperties(properties, handler) {\n\t\t\t\n\t\t\tfor(var i=properties.length; i--; ) {\n\t\t\t\tvar property = properties[i];\n\t\t\t\tvar handlers = (\n\t\t\t\t\tcssCascade.monitoredProperties[property]\n\t\t\t\t\t|| (cssCascade.monitoredProperties[property] = [])\n\t\t\t\t);\n\t\t\t\thandlers.push(handler)\n\t\t\t}\n\t\t\t\n\t\t\tfor(var s=0; s<cssCascade.stylesheets.length; s++) {\n\t\t\t\tvar currentStylesheet = cssCascade.stylesheets[s];\n\t\t\t\tcssCascade.startMonitoringStylesheet(currentStylesheet);\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// calling this function will detect monitored rules in the stylesheet\n\t\t// (should usually not be used because stylesheets load automatically)\n\t\t//\n\t\tstartMonitoringStylesheet: function startMonitoringStylesheet(rules) {\n\t\t\tfor(var i=0; i<rules.length; i++) {\n\t\t\t\t\n\t\t\t\t// only consider style rules\n\t\t\t\tif(rules[i] instanceof cssSyntax.StyleRule) {\n\t\t\t\t\t\n\t\t\t\t\t// try to see if the current rule is worth monitoring\n\t\t\t\t\tif(rules[i].isMonitored) continue;\n\t\t\t\t\t\n\t\t\t\t\t// for that, let's see if we can find a declaration we should watch\n\t\t\t\t\tvar decls = rules[i].getDeclarations();\n\t\t\t\t\tfor(var j=decls.length-1; j>=0; j--) {\n\t\t\t\t\t\tif(decls[j].type==\"DECLARATION\") {\n\t\t\t\t\t\t\tif(decls[j].name in cssCascade.monitoredProperties) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// if we found some, start monitoring\n\t\t\t\t\t\t\t\tcssCascade.startMonitoringRule(rules[i]);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t} else if(rules[i] instanceof cssSyntax.AtRule) {\n\t\t\t\t\t\n\t\t\t\t\t// handle @media\n\t\t\t\t\tif(rules[i].name == \"media\" && window.matchMedia) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tcssCascade.startMonitoringMedia(rules[i]);\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t},\n\t\t\n\t\t//\n\t\t// calling this function will detect media query updates and fire events accordingly\n\t\t// (should usually not be used because stylesheets load automatically)\n\t\t//\n\t\tstartMonitoringMedia: function startMonitoringMedia(atrule) {\n\t\t\ttry {\n\t\t\t\t\n\t\t\t\tvar media = window.matchMedia(atrule.prelude.toCSSString());\n\t\t\t\t\n\t\t\t\t// update all the rules when needed\n\t\t\t\tvar rules = atrule.toStylesheet().value;\n\t\t\t\tcssCascade.updateMedia(rules, !media.matches, false);\n\t\t\t\tmedia.addListener(\n\t\t\t\t\tfunction(newMedia) { cssCascade.updateMedia(rules, !newMedia.matches, true); }\n\t\t\t\t);\n\t\t\t\t\n\t\t\t\t// it seems I like taking risks...\n\t\t\t\tcssCascade.startMonitoringStylesheet(rules);\n\t\t\t\t\n\t\t\t} catch(ex) {\n\t\t\t\tsetImmediate(function() { throw ex; })\n\t\t\t}\n\t\t},\n\t\t\n\t\t//\n\t\t// define what happens when a media query status changes\n\t\t//\n\t\tupdateMedia: function(rules,disabled,update) {\n\t\t\tfor(var i=rules.length; i--; ) {\n\t\t\t\trules[i].disabled = disabled;\n\t\t\t\t// TODO: should probably get handled by a setter on the rule...\n\t\t\t\tvar sr = rules[i].subRules;\n\t\t\t\tif(sr) {\n\t\t\t\t\tfor(var j=sr.length; j--; ) {\n\t\t\t\t\t\tsr[j].disabled = disabled;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// in case of update, all elements matching the selector went potentially updated...\n\t\t\tif(update) {\n\t\t\t\tfor(var i=rules.length; i--; ) {\n\t\t\t\t\tvar els = document.querySelectorAll(rules[i].selector.toCSSString());\n\t\t\t\t\tfor(var j=els.length; j--; ) {\n\t\t\t\t\t\tcssCascade.monitoredPropertiesHandler.onupdate(els[j],rules[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\n\t\t// \n\t\t// splits a rule if it has multiple selectors\n\t\t// \n\t\tsplitRule: function splitRule(rule) {\n\t\t\t\n\t\t\t// create an array for all the subrules\n\t\t\tvar rules = [];\n\t\t\t\n\t\t\t// fill the array\n\t\t\tvar currentRule = new cssSyntax.StyleRule(); currentRule.disabled=rule.disabled;\n\t\t\tfor(var i=0; i<rule.selector.length; i++) {\n\t\t\t\tif(rule.selector[i] instanceof cssSyntax.DelimToken && rule.selector[i].value==\",\") {\n\t\t\t\t\tcurrentRule.value = rule.value; rules.push(currentRule);\n\t\t\t\t\tcurrentRule = new cssSyntax.StyleRule(); currentRule.disabled=rule.disabled;\n\t\t\t\t} else {\n\t\t\t\t\tcurrentRule.selector.push(rule.selector[i])\n\t\t\t\t}\n\t\t\t}\n\t\t\tcurrentRule.value = rule.value; rules.push(currentRule);\n\t\t\t\n\t\t\t// save the result of the split as subrules\n\t\t\treturn rule.subRules = rules;\n\t\t\t\n\t\t},\n\t\t\n\t\t// \n\t\t// ask the css-selector implementation to notify changes for the rules\n\t\t// \n\t\tstartMonitoringRule: function startMonitoringRule(rule) {\n\t\t\t\n\t\t\t// avoid monitoring rules twice\n\t\t\tif(!rule.isMonitored) { rule.isMonitored=true } else { return; }\n\t\t\t\n\t\t\t// split the rule if it has multiple selectors\n\t\t\tvar rules = rule.subRules || cssCascade.splitRule(rule);\n\t\t\t\n\t\t\t// monitor the rules\n\t\t\tfor(var i=0; i<rules.length; i++) {\n\t\t\t\trule = rules[i];\n\t\t\t\tquerySelectorLive(rule.selector.toCSSString(), {\n\t\t\t\t\tonadded: function(e) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// add the rule to the matching list of this element\n\t\t\t\t\t\t(e.myMatchedRules = e.myMatchedRules || []).unshift(rule); // TODO: does not respect priority order\n\t\t\t\t\t\t\n\t\t\t\t\t\t// generate an update event\n\t\t\t\t\t\tcssCascade.monitoredPropertiesHandler.onupdate(e, rule);\n\t\t\t\t\t\t\n\t\t\t\t\t},\n\t\t\t\t\tonremoved: function(e) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// remove the rule from the matching list of this element\n\t\t\t\t\t\tif(e.myMatchedRules) e.myMatchedRules.splice(e.myMatchedRules.indexOf(rule), 1);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// generate an update event\n\t\t\t\t\t\tcssCascade.monitoredPropertiesHandler.onupdate(e, rule);\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// converts a css property name to a javascript name\n\t\t//\n\t\ttoCamelCase: function toCamelCase(variable) { \n\t\t\treturn variable.replace(\n\t\t\t\t/-([a-z])/g, \n\t\t\t\tfunction(str,letter) { \n\t\t\t\t\treturn letter.toUpperCase();\n\t\t\t\t}\n\t\t\t);\n\t\t},\n\t\t\n\t\t//\n\t\t// add some magic code to support properties on the style interface\n\t\t//\n\t\tpolyfillStyleInterface: function(cssPropertyName) {\n\t\t\t\n\t\t\tvar prop = {\n\t\t\t\t\n\t\t\t\tget: function() {\n\t\t\t\t\t\n\t\t\t\t\t// check we know which element we work on\n\t\t\t\t\ttry { if(!this.parentElement) throw new Error(\"Please use the anHTMLElement.myStyle property to get polyfilled properties\") }\n\t\t\t\t\tcatch(ex) { setImmediate(function() { throw ex; }); return ''; }\n\t\t\t\t\t\n\t\t\t\t\ttry { \n\t\t\t\t\t\t// non-computed style: return the local style of the element\n\t\t\t\t\t\tthis.clip = (this.clip===undefined?'':this.clip);\n\t\t\t\t\t\treturn this.parentElement.getAttribute('data-style-'+cssPropertyName);\n\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t// computed style: return the specified style of the element\n\t\t\t\t\t\tvar value = cssCascade.getSpecifiedStyle(this.parentElement, cssPropertyName, undefined, true);\n\t\t\t\t\t\treturn value && value.length>0 ? value.toCSSString() : '';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tset: function(v) {\n\t\t\t\t\t\n\t\t\t\t\t// check that the style is writable\n\t\t\t\t\tthis.clip = (this.clip===undefined?'':this.clip);\n\n\t\t\t\t\t// check we know which element we work on\n\t\t\t\t\ttry { if(!this.parentElement) throw new Error(\"Please use the anHTMLElement.myStyle property to set polyfilled properties\") }\n\t\t\t\t\tcatch(ex) { setImmediate(function() { throw ex; }); return; }\n\t\t\t\t\t\n\t\t\t\t\t// modify the local style of the element\n\t\t\t\t\tif(this.parentElement.getAttribute('data-style-'+cssPropertyName) != v) {\n\t\t\t\t\t\tthis.parentElement.setAttribute('data-style-'+cssPropertyName,v);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t};\n\t\t\t\n\t\t\tvar styleProtos = [];\n\t\t\ttry { styleProtos.push(Object.getPrototypeOf(document.documentElement.style) || CSSStyleDeclaration); } catch (ex) {}\n\t\t\t//try { styleProtos.push(Object.getPrototypeOf(getComputedStyle(document.documentElement))); } catch (ex) {}\n\t\t\t//try { styleProtos.push(Object.getPrototypeOf(document.documentElement.currentStyle)); } catch (ex) {}\n\t\t\t//try { styleProtos.push(Object.getPrototypeOf(document.documentElement.runtimeStyle)); } catch (ex) {}\n\t\t\t//try { styleProtos.push(Object.getPrototypeOf(document.documentElement.specifiedStyle)); } catch (ex) {}\n\t\t\t//try { styleProtos.push(Object.getPrototypeOf(document.documentElement.cascadedStyle)); } catch (ex) {}\n\t\t\t//try { styleProtos.push(Object.getPrototypeOf(document.documentElement.usedStyle)); } catch (ex) {}\n\t\t\t\n\t\t\tfor(var i = styleProtos.length; i--;) {\n\t\t\t\tvar styleProto = styleProtos[i];\n\t\t\t\tObject.defineProperty(styleProto,cssPropertyName,prop);\n\t\t\t\tObject.defineProperty(styleProto,cssCascade.toCamelCase(cssPropertyName),prop);\n\t\t\t}\n\t\t\tcssCascade.startMonitoringRule(cssSyntax.parse('[style*=\"'+cssPropertyName+'\"]{'+cssPropertyName+':attr(style)}').value[0]);\n\t\t\tcssCascade.startMonitoringRule(cssSyntax.parse('[data-style-'+cssPropertyName+']{'+cssPropertyName+':attr(style)}').value[0]);\n\t\t\t\n\t\t\t// add to the list of polyfilled properties...\n\t\t\tcssCascade.getAllCSSProperties().push(cssPropertyName);\n\t\t\tcssCascade.computationUnsafeProperties[cssPropertyName] = true;\n\t\t\t\n\t\t}\n\t\t\n\t};\n\n\t//\n\t// polyfill for browsers not support CSSStyleDeclaration.parentElement (all of them right now)\n\t//\n\tdomEvents.EventTarget.implementsIn(cssCascade);\n\tObject.defineProperty(Element.prototype,'myStyle',{\n\t\tget: function() {\n\t\t\tvar style = this.style; \n\t\t\tif(!style.parentElement) style.parentElement = this;\n\t\t\treturn style;\n\t\t}\n\t});\n\n\t//\n\t// load all stylesheets at the time the script is loaded\n\t// then do it again when all stylesheets are downloaded\n\t// and again if some style tag is added to the DOM\n\t//\n\tif(!(\"no_auto_stylesheet_detection\" in window)) {\n\t\t\n\t\tcssCascade.loadAllStyleSheets();\n\t\tdocument.addEventListener(\"DOMContentLoaded\", function() {\n\t\t\tcssCascade.loadAllStyleSheets();\n\t\t\tquerySelectorLive(\n\t\t\t\tcssCascade.selectorForStylesheets,\n\t\t\t\t{\n\t\t\t\t\tonadded: function(e) {\n\t\t\t\t\t\t// TODO: respect DOM order?\n\t\t\t\t\t\tcssCascade.loadStyleSheetTag(e);\n\t\t\t\t\t\tcssCascade.dispatchEvent('stylesheetadded');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t})\n\t}\n\t\n\treturn cssCascade;\n\n})(window, document);\n\nrequire.define('src/core/css-cascade.js');\n\n////////////////////////////////////////\n\nmodule.exports = (function(window, document) { \"use strict\"; \n\n\tvar cssSyntax = require('src/core/css-syntax.js');\n\tvar cssCascade = require('src/core/css-cascade.js');\n\t\n\tvar cssBreak = {\n\n\t\t//\n\t\t// returns true if an element is replaced \n\t\t// (can't be broken because considered as an image in css layout)\n\t\t// \n\t\tisReplacedElement: function isReplacedElement(element) {\n\t\t\tif(!(element instanceof Element)) return false;\n\t\t\tvar replacedElementTags = /^(SVG|MATH|IMG|VIDEO|PICTURE|OBJECT|EMBED|IFRAME|TEXTAREA|BUTTON|INPUT)$/; // TODO: more\n\t\t\treturn replacedElementTags.test(element.tagName);\n\t\t},\n\t\t\n\t\t// \n\t\t// returns true if an element has a scrollbar or act on overflowing content\n\t\t// \n\t\tisScrollable: function isScrollable(element, elementOverflow) {\n\t\t\tif(!(element instanceof Element)) return false;\n\t\t\tif(typeof(elementOverflow)==\"undefined\") elementOverflow = getComputedStyle(element).overflow;\n\t\t\t\n\t\t\treturn (\n\t\t\t\telementOverflow !== \"visible\"\n\t\t\t\t&& elementOverflow !== \"hidden\"\n\t\t\t);\n\t\t\t\n\t\t},\n\t\t\n\t\t// \n\t\t// returns true if the element is part of an inline flow\n\t\t// TextNodes definitely qualify, but also inline-block elements\n\t\t// \n\t\tisSingleLineOfTextComponent: function(element, elementStyle, elementDisplay, elementPosition, isReplaced) {\n\t\t\tif(!(element instanceof Element)) return true;\n\t\t\tif(typeof(elementStyle)==\"undefined\") elementStyle = getComputedStyle(element);\n\t\t\tif(typeof(elementDisplay)==\"undefined\") elementDisplay = elementStyle.display;\n\t\t\tif(typeof(elementPosition)==\"undefined\") elementPosition = elementStyle.position;\n\t\t\tif(typeof(isReplaced)==\"undefined\") isReplaced = this.isReplacedElement(element);\n\t\t\t\n\t\t\treturn (\n\t\t\t\telementDisplay === \"inline-block\"\n\t\t\t\t|| elementDisplay === \"inline-table\"\n\t\t\t\t|| elementDisplay === \"inline-flex\"\n\t\t\t\t|| elementDisplay === \"inline-grid\"\n\t\t\t\t// TODO: more\n\t\t\t) && (\n\t\t\t\telementPosition === \"static\"\n\t\t\t\t|| elementPosition === \"relative\"\n\t\t\t);\n\t\t\t\n\t\t},\n\t\t\n\t\t// \n\t\t// returns true if the element is part of an inline flow\n\t\t// TextNodes definitely qualify, but also inline-block elements\n\t\t// \n\t\thasAnyInlineFlow: function(element) {\n\t\t\t\n\t\t\tfunction countAsInline(element) {\n\t\t\t\tif(!(element instanceof Element)) return !(/^\\s*$/.test(element.nodeValue));\n\t\t\t\treturn !cssBreak.isOutOfFlowElement(element) && cssBreak.isSingleLineOfTextComponent(element);\n\t\t\t}\n\t\t\t\n\t\t\t// try to find any inline element\n\t\t\tvar current = element.firstChild;\n\t\t\twhile(current) {\n\t\t\t\tif(countAsInline(current)) return true;\n\t\t\t\tcurrent = current.nextSibling;\n\t\t\t}\n\t\t\t\n\t\t\t// no inline element\n\t\t\treturn false;\n\t\t\t\n\t\t},\n\t\t\n\t\t// \n\t\t// returns true if the element breaks the inline flow\n\t\t// (the case of block elements, mostly)\n\t\t// \n\t\tisLineBreakingElement: function(element, elementStyle, elementDisplay, elementPosition) {\n\t\t\t\n\t\t\tif(!(element instanceof Element)) return false;\n\t\t\tif(typeof(elementStyle)==\"undefined\") elementStyle = getComputedStyle(element);\n\t\t\tif(typeof(elementDisplay)==\"undefined\") elementDisplay = elementStyle.display;\n\t\t\tif(typeof(elementPosition)==\"undefined\") elementPosition = elementStyle.position;\n\t\t\t\n\t\t\treturn (\n\t\t\t\t(\n\t\t\t\t\t// in-flow bock elements\n\t\t\t\t\t(elementDisplay === \"block\")\n\t\t\t\t\t&& !this.isOutOfFlowElement(element, elementStyle, elementDisplay, elementPosition)\n\t\t\t\t\t\n\t\t\t\t) || (\n\t\t\t\t\t\n\t\t\t\t\t// displayed <br> elements\n\t\t\t\t\telement.tagName===\"BR\" && elementDisplay!==\"none\"\n\t\t\t\t\t\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\t\n\t\t// \n\t\t// returns true if the element breaks the inline flow before him\n\t\t// (the case of block elements, mostly)\n\t\t// \n\t\tisLinePreBreakingElement: function(element, elementStyle, elementDisplay, elementPosition) {\n\t\t\tif(!(element instanceof Element)) return false;\n\n\t\t\tvar breakBefore = cssCascade.getSpecifiedStyle(element,'break-before').toCSSString();\n\t\t\treturn (\n\t\t\t\t(breakBefore==\"region\"||breakBefore==\"all\") \n\t\t\t\t|| cssBreak.isLineBreakingElement(element, elementStyle, elementDisplay, elementPosition)\n\t\t\t);\n\t\t\t\n\t\t},\n\t\t\n\t\t// \n\t\t// returns true if the element breaks the inline flow after him\n\t\t// (the case of block elements, mostly)\n\t\t// \n\t\tisLinePostBreakingElement: function(element, elementStyle, elementDisplay, elementPosition) {\n\t\t\tif(!(element instanceof Element)) return false;\n\t\t\t\n\t\t\tvar breakAfter = cssCascade.getSpecifiedStyle(element,'break-after').toCSSString();\n\t\t\treturn (\n\t\t\t\t(breakAfter==\"region\"||breakAfter==\"all\") \n\t\t\t\t|| cssBreak.isLineBreakingElement(element, elementStyle, elementDisplay, elementPosition)\n\t\t\t);\n\t\t\t\n\t\t},\n\t\t\n\t\t// \n\t\t// returns true if the element is outside any block/inline flow\n\t\t// (this the case of absolutely positioned elements, and floats)\n\t\t// \n\t\tisOutOfFlowElement: function(element, elementStyle, elementDisplay, elementPosition, elementFloat) {\n\t\t\tif(!(element instanceof Element)) return false;\n\t\t\tif(typeof(elementStyle)==\"undefined\") elementStyle = getComputedStyle(element);\n\t\t\tif(typeof(elementDisplay)==\"undefined\") elementDisplay = elementStyle.display;\n\t\t\tif(typeof(elementPosition)==\"undefined\") elementPosition = elementStyle.position; \n\t\t\tif(typeof(elementFloat)==\"undefined\") elementFloat = elementStyle.float || elementStyle.styleFloat || elementStyle.cssFloat;\n\t\t\t\n\t\t\treturn (\n\t\t\t\t\n\t\t\t\t// positioned elements are out of the flow\n\t\t\t\t(elementPosition===\"absolute\"||elementPosition===\"fixed\")\n\t\t\t\t\n\t\t\t\t// floated elements as well\n\t\t\t\t|| (elementFloat!==\"none\") \n\t\t\t\t\n\t\t\t\t// not sure but let's say hidden elements as well\n\t\t\t\t|| (elementDisplay===\"none\")\n\t\t\t\t\n\t\t\t);\n\t\t\t\n\t\t},\n\t\t\n\t\t// \n\t\t// returns true if two sibling elements are in the same text line\n\t\t// (this function is not perfect, work with it with care)\n\t\t// \n\t\tareInSameSingleLine: function areInSameSingleLine(element1, element2) {\n\t\t\t\n\t\t\t//\n\t\t\t// look for obvious reasons why it wouldn't be the case\n\t\t\t//\n\t\t\t\n\t\t\t// if the element are not direct sibling, we must use their inner siblings as well\n\t\t\tif(element1.nextSibling != element2) { \n\t\t\t\tif(element2.nextSibling != element1) throw \"I gave up!\"; \n\t\t\t\tvar t = element1; element1=element2; element2=t;\n\t\t\t}\n\t\t\t \n\t\t\t// a block element is never on the same line as another element\n\t\t\tif(this.isLinePostBreakingElement(element1)) return false;\n\t\t\tif(this.isLinePreBreakingElement(element2)) return false;\n\t\t\t\n\t\t\t// if the previous element is out of flow, we may consider it as being part of the current line\n\t\t\tif(this.isOutOfFlowElement(element1)) return true;\n\t\t\t\n\t\t\t// if the current object is not a single line component, return false\n\t\t\tif(!this.isSingleLineOfTextComponent(element1)) return false;\n\t\t\t\n\t\t\t// \n\t\t\t// compute the in-flow bounding rect of the two elements\n\t\t\t// \n\t\t\tvar element1box = Node.getBoundingClientRect(element1);\n\t\t\tvar element2box = Node.getBoundingClientRect(element2);\n\t\t\tfunction shift(box,shiftX,shiftY) {\n\t\t\t\treturn {\n\t\t\t\t\ttop: box.top+shiftY,\n\t\t\t\t\tbottom: box.bottom+shiftY,\n\t\t\t\t\tleft: box.left+shiftX,\n\t\t\t\t\tright: box.right+shiftX\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// we only need to shift elements\n\t\t\tif(element1 instanceof Element) {\n\t\t\t\tvar element1Style = getComputedStyle(element1);\n\t\t\t\telement1box = shift(element1box, parseFloat(element1Style.marginLeft), parseFloat(element1Style.marginTop))\n\t\t\t\tif(element1Style.position==\"relative\") {\n\t\t\t\t\telement1box = shift(element1box, parseFloat(element1Style.left), parseFloat(element1Style.top))\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// we only need to shift elements\n\t\t\tif(element2 instanceof Element) {\n\t\t\t\tvar element2Style = getComputedStyle(element2);\n\t\t\t\telement2box = shift(element2box, parseFloat(element2Style.marginLeft), parseFloat(element2Style.marginTop))\n\t\t\t\tif(element2Style.position==\"relative\") {\n\t\t\t\t\telement2box = shift(element2box, parseFloat(element2Style.left), parseFloat(element2Style.top))\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// order the nodes so that they are in left-to-right order\n\t\t\t// (this means invert their order in the case of right-to-left flow)\n\t\t\tvar firstElement = getComputedStyle(element1.parentNode).direction==\"rtl\" ? element2box : element1box;\n\t\t\tvar secondElement = getComputedStyle(element1.parentNode).direction==\"rtl\" ? element1box : element2box;\n\t\t\t\n\t\t\t// return true if both elements are have non-overlapping\n\t\t\t// margin- and position-corrected in-flow bounding rect\n\t\t\t// and if their relative position is the one of the current\n\t\t\t// flow (either rtl or ltr)\n\t\t\treturn firstElement.right <= secondElement.left;\n\t\t\t\n\t\t\t// TODO: what about left-to-right + right-aligned text?\n\t\t\t// I should probably takes care of vertical position in this case to solve ambiguities\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// returns true if the element has \"overflow: hidden\" set on it, and actually overflows\n\t\t//\n\t\tisHiddenOverflowing: function isHiddenOverflowing(element, elementOverflow) {\n\t\t\tif(!(element instanceof Element)) return false;\n\t\t\tif(typeof(elementOverflow)==\"undefined\") elementOverflow = getComputedStyle(element).display;\n\t\t\t\n\t\t\treturn (\n\t\t\t\telementOverflow == \"hidden\" \n\t\t\t\t&& element.offsetHeight != element.scrollHeight // trust me that works\n\t\t\t);\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// returns true if the element has a border-radius that impacts his layout\n\t\t//\n\t\thasBigRadius: function(element, elementStyle) {\n\t\t\tif(!(element instanceof Element)) return false;\n\t\t\tif(typeof(elementStyle)==\"undefined\") elementStyle = getComputedStyle(element);\n\n\t\t\t// if the browser supports radiuses {f### prefixes}\n\t\t\tif(\"borderTopLeftRadius\" in elementStyle) {\n\t\t\t\t\n\t\t\t\tvar tlRadius = parseFloat(elementStyle.borderTopLeftRadius);\n\t\t\t\tvar trRadius = parseFloat(elementStyle.borderTopRightRadius);\n\t\t\t\tvar blRadius = parseFloat(elementStyle.borderBottomLeftRadius);\n\t\t\t\tvar brRadius = parseFloat(elementStyle.borderBottomRightRadius);\n\t\t\t\t\n\t\t\t\t// tiny radiuses (<15px) are tolerated anyway\n\t\t\t\tif(tlRadius < 15 && trRadius < 15 && blRadius < 15 && brRadius < 15) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar tWidth = parseFloat(elementStyle.borderTopWidth);\n\t\t\t\tvar bWidth = parseFloat(elementStyle.borderBottomWidth);\n\t\t\t\tvar lWidth = parseFloat(elementStyle.borderLeftWidth);\n\t\t\t\tvar rWidth = parseFloat(elementStyle.borderRightWidth);\n\t\t\t\t\n\t\t\t\t// make sure the radius itself is contained into the border\n\t\t\t\t\n\t\t\t\tif(tlRadius > tWidth) return true;\n\t\t\t\tif(tlRadius > lWidth) return true;\n\t\t\t\t\n\t\t\t\tif(trRadius > tWidth) return true;\n\t\t\t\tif(trRadius > rWidth) return true;\n\t\t\t\t\n\t\t\t\tif(blRadius > bWidth) return true;\n\t\t\t\tif(blRadius > lWidth) return true;\n\t\t\t\t\n\t\t\t\tif(brRadius > bWidth) return true;\n\t\t\t\tif(brRadius > rWidth) return true;\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// all conditions were met\n\t\t\treturn false;\n\t\t},\n\t\t\n\t\t//\n\t\t// return trus if the break-inside property is 'avoid' or 'avoid-region'\n\t\t//\n\t\tisBreakInsideAvoid: function isBreakInsideAvoid(element, elementStyle) {\n\t\t\tvar breakInside = cssCascade.getSpecifiedStyle(element, 'break-inside', undefined, true).toCSSString().trim().toLowerCase(); \n\t\t\treturn (breakInside == \"avoid\" || breakInside == \"avoid-region\");\n\t\t},\n\t\t\n\t\t//\n\t\t// returns true if the element is unbreakable according to the spec\n\t\t// (and some of the expected limitations of HTML/CSS)\n\t\t//\n\t\tisMonolithic: function isMonolithic(element) {\n\t\t\tif(!(element instanceof Element)) return false;\n\t\t\t\n\t\t\tvar elementStyle = getComputedStyle(element);\n\t\t\tvar elementOverflow = elementStyle.overflow;\n\t\t\tvar elementDisplay = elementStyle.display;\n\t\t\t\n\t\t\t// Some content is not fragmentable, for example:\n\t\t\t// - many types of replaced elements (such as images or video)\n\t\t\t\n\t\t\tvar isReplaced = this.isReplacedElement(element);\n\t\t\t\n\t\t\t// - scrollable elements\n\t\t\t\n\t\t\tvar isScrollable = this.isScrollable(element, elementOverflow);\n\t\t\t\n\t\t\t// - a single line of text content. \n\t\t\t\n\t\t\tvar isSingleLineOfText = this.isSingleLineOfTextComponent(element, elementStyle, elementDisplay, undefined, isReplaced);\n\t\t\t\n\t\t\t// Such content is considered monolithic: it contains no\n\t\t\t// possible break points. \n\t\t\t\n\t\t\t// In addition to any content which is not fragmentable, \n\t\t\t// UAs may consider as monolithic:\n\t\t\t// - any elements with ‘overflow’ set to ‘auto’ or ‘scroll’ \n\t\t\t// - any elements with ‘overflow: hidden’ and a non-‘auto’ logical height (and no specified maximum logical height).\n\t\t\t\n\t\t\tvar isHiddenOverflowing = this.isHiddenOverflowing(element, elementOverflow);\n\t\t\t\n\t\t\t// ADDITION TO THE SPEC:\n\t\t\t// I don't want to handle the case where \n\t\t\t// an element has a border-radius that is bigger\n\t\t\t// than the border-width to which it belongs\n\t\t\tvar hasBigRadius = this.hasBigRadius(element, elementStyle);\n\t\t\t\n\t\t\t// ADDITION TO THE SPEC:\n\t\t\t// Someone proposed to support \"break-inside: avoid\" here\n\t\t\tvar isBreakInsideAvoid = this.isBreakInsideAvoid(element, elementStyle);\n\t\t\t\n\t\t\t// all of them are monolithic\n\t\t\treturn isReplaced || isScrollable || isSingleLineOfText || isHiddenOverflowing || hasBigRadius || isBreakInsideAvoid;\n\t\t\t\n\t\t},\n\t\t\n\t\t// \n\t\t// returns true if \"r\" is a collapsed range located at a possible break point for \"region\"\n\t\t// (this function does all the magic for you, but you may want to avoid using it too much)\n\t\t// \n\t\tisPossibleBreakPoint: function isPossibleBreakPoint(r, region) {\n\t\t\t\n\t\t\t// r has to be a range, and be collapsed\n\t\t\tif(!(r instanceof Range)) return false;\n\t\t\tif(!(r.collapsed)) return false;\n\t\t\t\n\t\t\t// no ancestor up to the region has to be monolithic\n\t\t\tvar ancestor = r.startContainer;\n\t\t\twhile(ancestor && ancestor !== region) {\n\t\t\t\tif(cssBreak.isMonolithic(ancestor)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tancestor = ancestor.parentNode;\n\t\t\t}\n\t\t\t\n\t\t\t// we also have to check that we're not between two single-line-of-text elements\n\t\t\t// that are actually on the same line (in which case you can't break)\n\t\t\tvar ancestor = r.startContainer; \n\t\t\tvar lastAncestor = r.startContainer.childNodes[r.startOffset];\n\t\t\twhile(ancestor && lastAncestor !== region) {\n\t\t\t\tif(lastAncestor && lastAncestor.previousSibling) {\n\t\t\t\t\t\n\t\t\t\t\tif(this.areInSameSingleLine(lastAncestor, lastAncestor.previousSibling)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlastAncestor = ancestor;\n\t\t\t\tancestor = ancestor.parentNode;\n\t\t\t}\n\t\t\t\n\t\t\t// there are some very specific conditions for breaking\n\t\t\t// at the edge of an element:\n\t\t\t\n\t\t\tif(r.startOffset==0) {\n\t\t\t\t\n\t\t\t\t// Class 3 breaking point:\n\t\t\t\t// ========================\n\t\t\t\t// Between the content edge of a block container box \n\t\t\t\t// and the outer edges of its child content (margin \n\t\t\t\t// edges of block-level children or line box edges \n\t\t\t\t// for inline-level children) if there is a (non-zero)\n\t\t\t\t// gap between them.\n\t\t\t\t\n\t\t\t\tvar firstChild = r.startContainer.childNodes[0];\n\t\t\t\tif(firstChild) {\n\t\t\t\t\t\n\t\t\t\t\tvar firstChildBox = (\n\t\t\t\t\t\tNode.getBoundingClientRect(firstChild)\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\tvar parentBox = (\n\t\t\t\t\t\tr.startContainer.getBoundingClientRect()\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\tif(firstChildBox.top == parentBox.top) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// all conditions are met!\n\t\t\treturn true;\n\t\t\t\n\t\t}\n\t\t\n\t};\n\t\n\treturn cssBreak;\n\t\n})(window, document);\nrequire.define('src/core/css-break.js');\n\n////////////////////////////////////////\n\n\"use strict\";\n\n//\n// start by polyfilling caretRangeFromPoint\n//\n\nif(!document.caretRangeFromPoint) {\n    if (document.caretPositionFromPoint) {\n        document.caretRangeFromPoint = function caretRangeFromPoint(x,y) {\n            var r = document.createRange();\n            var p = document.caretPositionFromPoint(x,y); \n            if(p.offsetNode) {\n                r.setStart(p.offsetNode, p.offset);\n                r.setEnd(p.offsetNode, p.offset);\n            }\n            return r;\n        }\n    } else if((document.body||document.createElement('body')).createTextRange) {\n        \n        //\n        // we may want to convert TextRange to Range\n        //\n        \n        var TextRangeUtils = {\n            convertToDOMRange: function (textRange, document) {\n                var adoptBoundary = function(domRange, textRangeInner, bStart) {\n                    // iterate backwards through parent element to find anchor location\n                    var cursorNode = document.createElement('a'), cursor = textRangeInner.duplicate();\n                    cursor.collapse(bStart);\n                    var parent = cursor.parentElement();\n                    do {\n                            parent.insertBefore(cursorNode, cursorNode.previousSibling);\n                            cursor.moveToElementText(cursorNode);\n                    } while (cursor.compareEndPoints(bStart ? 'StartToStart' : 'StartToEnd', textRangeInner) > 0 && cursorNode.previousSibling);\n                    \n                    // when we exceed or meet the cursor, we've found the node\n                    if (cursor.compareEndPoints(bStart ? 'StartToStart' : 'StartToEnd', textRangeInner) == -1 && cursorNode.nextSibling) {\n                            // data node\n                            cursor.setEndPoint(bStart ? 'EndToStart' : 'EndToEnd', textRangeInner);\n                            domRange[bStart ? 'setStart' : 'setEnd'](cursorNode.nextSibling, cursor.text.length);\n                    } else {\n                            // element\n                            domRange[bStart ? 'setStartBefore' : 'setEndBefore'](cursorNode);\n                    }\n                    cursorNode.parentNode.removeChild(cursorNode);\n                }\n                \n                // validate arguments\n                if(!document) { document=window.document; }\n                \n                // return a DOM range\n                var domRange = document.createRange();\n                adoptBoundary(domRange, textRange, true);\n                adoptBoundary(domRange, textRange, false);\n                return domRange;\n            },\n\n            convertFromDOMRange: function (domRange) {\n                var adoptEndPoint = function(textRange, domRangeInner, bStart) {\n                    // find anchor node and offset\n                    var container = domRangeInner[bStart ? 'startContainer' : 'endContainer'];\n                    var offset = domRangeInner[bStart ? 'startOffset' : 'endOffset'], textOffset = 0;\n                    var anchorNode = DOMUtils.isDataNode(container) ? container : container.childNodes[offset];\n                    var anchorParent = DOMUtils.isDataNode(container) ? container.parentNode : container;\n                    // visible data nodes need a text offset\n                    if (container.nodeType == 3 || container.nodeType == 4)\n                        textOffset = offset;\n                    \n                    // create a cursor element node to position range (since we can't select text nodes)\n                    var cursorNode = domRangeInner._document.createElement('a');\n                    anchorParent.insertBefore(cursorNode, anchorNode);\n                    var cursor = domRangeInner._document.body.createTextRange();\n                    cursor.moveToElementText(cursorNode);\n                    cursorNode.parentNode.removeChild(cursorNode);\n                    // move range\n                    textRange.setEndPoint(bStart ? 'StartToStart' : 'EndToStart', cursor);\n                    textRange[bStart ? 'moveStart' : 'moveEnd']('character', textOffset);\n                }\n               \n                // return an IE text range\n                var textRange = domRange._document.body.createTextRange();\n                adoptEndPoint(textRange, domRange, true);\n                adoptEndPoint(textRange, domRange, false);\n                return textRange;\n            }\n        };\n\n        \n        document.caretRangeFromPoint = function caretRangeFromPoint(x,y) {\n            \n            // the accepted number of vertical backtracking, in CSS pixels\n            var IYDepth = 40;\n            \n            // try to create a text range at the specified location\n            var r = document.body.createTextRange();\n            for(var iy=IYDepth; iy; iy=iy-4) {\n                var ix = x; if(true) {\n                    try {\n                        r.moveToPoint(ix,iy+y-IYDepth); \n                        return TextRangeUtils.convertToDOMRange(r);\n                    } catch(ex) {}\n                }\n            }\n            \n            // if that fails, return the location just after the element located there\n            try {\n                \n                var elem = document.elementFromPoint(x-1,y-1);\n                var r = document.createRange();\n                r.setStartAfter(elem);\n                return r;\n                \n            } catch(ex) {\n                \n                return null;\n                \n            }\n        }\n    }\n}\n\n\n///\n/// helper function for moving ranges char by char\n///\n\nRange.prototype.myMoveOneCharLeft = function() {\n    var r = this;\n    \n    // move to the previous cursor location\n    if(r.endOffset > 0) {\n        \n        // if we can enter into the previous sibling\n        var previousSibling = r.endContainer.childNodes[r.endOffset-1];\n        if(previousSibling && previousSibling.lastChild) {\n            \n            // enter the previous sibling from its end\n            r.setEndAfter(previousSibling.lastChild);\n            \n        } else if(previousSibling && previousSibling.nodeType==previousSibling.TEXT_NODE) { // todo: lookup value\n            \n            // enter the previous text node from its end\n            r.setEnd(previousSibling, previousSibling.nodeValue.length);\n            \n        } else {\n            \n            // else move before that element\n            r.setEnd(r.endContainer, r.endOffset-1);\n            \n        }\n        \n    } else {\n        r.setEndBefore(r.endContainer);\n    }\n    \n}\n\nRange.prototype.myMoveOneCharRight = function() {\n    var r = this;\n    \n    // move to the previous cursor location\n    var max = (r.startContainer.nodeType==r.startContainer.TEXT_NODE ? r.startContainer.nodeValue.length : r.startContainer.childNodes.length)\n    if(r.startOffset < max) {\n        \n        // if we can enter into the next sibling\n        var nextSibling = r.endContainer.childNodes[r.endOffset];\n        if(nextSibling && nextSibling.firstChild) {\n            \n            // enter the next sibling from its start\n            r.setStartBefore(nextSibling.firstChild);\n            \n        } else if(nextSibling && nextSibling.nodeType==nextSibling.TEXT_NODE && nextSibling.nodeValue!='') { // todo: lookup value\n            \n            // enter the next text node from its start\n            r.setStart(nextSibling, 0);\n            \n        } else {\n            \n            // else move before that element\n            r.setStart(r.startContainer, r.startOffset+1);\n            \n        }\n        \n    } else {\n        r.setStartAfter(r.endContainer);\n    }\n    \n    // shouldn't be needed but who knows...\n    r.setEnd(r.startContainer, r.startOffset);\n    \n}\n\n\n///\n/// This functions is optimized to not yield inside a word in a text node\n///\nRange.prototype.myMoveTowardRight = function() {\n    var r = this;\n    \n    // move to the previous cursor location\n    var isTextNode = r.startContainer.nodeType==r.startContainer.TEXT_NODE;\n    var max = (isTextNode ? r.startContainer.nodeValue.length : r.startContainer.childNodes.length)\n    if(r.startOffset < max) {\n        \n        // if we can enter into the next sibling\n        var nextSibling = r.endContainer.childNodes[r.endOffset];\n        if(nextSibling && nextSibling.firstChild) {\n            \n            // enter the next sibling from its start\n            r.setStartBefore(nextSibling.firstChild);\n            \n        } else if(nextSibling && nextSibling.nodeType==nextSibling.TEXT_NODE && nextSibling.nodeValue!='') { // todo: lookup value\n            \n            // enter the next text node from its start\n            r.setStart(nextSibling, 0);\n            \n        } else if(isTextNode) {\n            \n            // move to the next non a-zA-Z symbol\n            var currentText = r.startContainer.nodeValue;\n            var currentOffset = r.startOffset;\n            var currentLetter = currentText[currentOffset++];\n            while(currentOffset < max && /^\\w$/.test(currentLetter)) {\n                currentLetter = currentText[currentOffset++];\n            }\n            r.setStart(r.startContainer, currentOffset);\n            \n        } else {\n            \n            // else move after that element\n            r.setStart(r.startContainer, r.startOffset+1);\n            \n        }\n        \n    } else {\n        r.setStartAfter(r.endContainer);\n    }\n    \n    // shouldn't be needed but who knows...\n    r.setEnd(r.startContainer, r.startOffset);\n    \n}\n\n\nRange.prototype.myMoveEndOneCharLeft = function() {\n    var r = this;\n    \n    // move to the previous cursor location\n    if(r.endOffset > 0) {\n        \n        // if we can enter into the previous sibling\n        var previousSibling = r.endContainer.childNodes[r.endOffset-1];\n        if(previousSibling && previousSibling.lastChild) {\n            \n            // enter the previous sibling from its end\n            r.setEndAfter(previousSibling.lastChild);\n            \n        } else if(previousSibling && previousSibling.nodeType==previousSibling.TEXT_NODE) { // todo: lookup value\n            \n            // enter the previous text node from its end\n            r.setEnd(previousSibling, previousSibling.nodeValue.length);\n            \n        } else {\n            \n            // else move before that element\n            r.setEnd(r.endContainer, r.endOffset-1);\n            \n        }\n        \n    } else {\n        r.setEndBefore(r.endContainer);\n    }\n    \n}\n\nRange.prototype.myMoveEndOneCharRight = function() {\n    var r = this;\n    \n    // move to the previous cursor location\n    var max = (r.endContainer.nodeType==r.endContainer.TEXT_NODE ? r.endContainer.nodeValue.length : r.endContainer.childNodes.length)\n    if(r.endOffset < max) {\n        \n        // if we can enter into the next sibling\n        var nextSibling = r.endContainer.childNodes[r.endOffset];\n        if(nextSibling && nextSibling.firstChild) {\n            \n            // enter the next sibling from its start\n            r.setEndBefore(nextSibling.firstChild);\n            \n        } else if(nextSibling && nextSibling.nodeType==nextSibling.TEXT_NODE) { // todo: lookup value\n            \n            // enter the next text node from its start\n            r.setEnd(nextSibling, 0);\n            \n        } else {\n            \n            // else move before that element\n            r.setEnd(r.endContainer, r.endOffset+1);\n            \n        }\n        \n    } else {\n        r.setEndAfter(r.endContainer);\n    }\n    \n}\n\n//\n// Get the *real* bounding client rect of the range\n// { therefore we need to fix some browser bugs... }\n//\nRange.prototype.myGetSelectionRect = function() {\n    \n    // get the browser's claimed rect\n    var rect = this.getBoundingClientRect();\n\t\n\t// HACK FOR ANDROID BROWSER AND OLD WEBKIT\n\tif(!rect) { \n\t\trect={top:0,right:0,bottom:0,left:0,width:0,height:0}; \n\t}\n    \n    // if the value seems wrong... (some browsers don't like collapsed selections)\n    if(this.collapsed && rect.top===0 && rect.bottom===0) {\n        \n        // select one char and infer location\n        var clone = this.cloneRange(); var collapseToLeft=false; clone.collapse(false); \n        \n        // the case where no char before is tricky...\n        if(clone.startOffset==0) {\n            \n            // let's move on char to the right\n            clone.myMoveTowardRight();\n            collapseToLeft=true;\n\n            // note: some browsers don't like selections\n            // that spans multiple containers, so we will\n            // iterate this process until we have one true\n            // char selected\n            clone.setStart(clone.endContainer, 0); \n            \n        } else {\n            \n            // else, just select the char before\n            clone.setStart(this.startContainer, this.startOffset-1);\n            collapseToLeft=false;\n            \n        }\n        \n        // get some real rect\n        var rect = clone.myGetSelectionRect();\n        \n        // compute final value\n        if(collapseToLeft) {\n            return {\n                \n                left: rect.left,\n                right: rect.left,\n                width: 0,\n                \n                top: rect.top,\n                bottom: rect.bottom,\n                height: rect.height\n                \n            }\n        } else {\n            return {\n                \n                left: rect.right,\n                right: rect.right,\n                width: 0,\n                \n                top: rect.top,\n                bottom: rect.bottom,\n                height: rect.height\n                \n            }\n        }\n        \n    } else {\n        return rect;\n    }\n    \n}\n\n// not sure it's needed but still\nif(!window.Element) window.Element=window.HTMLElement;\nif(!window.Node) window.Node = {};\n\n// make getBCR working on text nodes & stuff\nNode.getBoundingClientRect = function getBoundingClientRect(element) {\n    if (element.getBoundingClientRect) {\n        \n        var rect = element.getBoundingClientRect();\n        \n    } else {\n        \n        var range = document.createRange();\n        range.selectNode(element);\n        \n        var rect = range.getBoundingClientRect();\n        \n    }\n\t\n\t// HACK FOR ANDROID BROWSER AND OLD WEBKIT\n\tif(!rect) { \n\t\trect={top:0,right:0,bottom:0,left:0,width:0,height:0}; \n\t}\n\t\n\treturn rect;\n};\n\n\n// make getCR working on text nodes & stuff\nNode.getClientRects = function getClientRects(firstChild) {\n    if (firstChild.getBoundingClientRect) {\n        \n        return firstChild.getClientRects();\n        \n    } else {\n        \n        var range = document.createRange();\n        range.selectNode(firstChild);\n        \n        return range.getClientRects();\n        \n    }\n};\n\n// fix for IE (contains fails for text nodes...)\nNode.contains = function contains(parentNode,node) {\n    if(node.nodeType != 1) {\n        if(!node.parentNode) return false;\n        return node.parentNode==parentNode || parentNode.contains(node.parentNode);\n    } else {\n        return parentNode.contains(node);\n    }\n}\n\n//\n// get the bounding rect of the selection, including the bottom padding/marging of the previous element if required\n// { this is a special version for breaking algorithms that do not want to miss the previous element real size }\n//\nRange.prototype.myGetExtensionRect = function() {\n    \n    // this function returns the selection rect\n    // but does take care of taking in account \n    // the bottom-{padding/border} of the previous\n    // sibling element, to detect overflow points\n    // more accurately\n    \n    var rect = this.myGetSelectionRect();\n    var previousSibling = this.endContainer.childNodes[this.endOffset-1];\n    if(previousSibling) {\n        \n        // correct with the new take\n        var prevSibRect = Node.getBoundingClientRect(previousSibling);\n        var adjustedBottom = Math.max(rect.bottom,prevSibRect.bottom);\n        if(adjustedBottom == rect.bottom) return rect;\n        return {\n            \n            left: rect.left,\n            right: rect.right,\n            width: rect.width,\n            \n            top: rect.top,\n            bottom: adjustedBottom,\n            height: adjustedBottom - rect.top\n            \n        };\n        \n    } else if(rect.bottom==0 && this.endContainer.nodeType === 3) {\n        \n        // note that if we are in a text node, \n        // we may want to cover all the previous\n        // text in the node to avoid whitespace\n        // related bugs\n        \n        var onlyWhiteSpaceBefore = /^(\\s|\\n)*$/.test(this.endContainer.nodeValue.substr(0,this.endOffset));\n        if(onlyWhiteSpaceBefore) {\n            \n            // if we are in the fucking whitespace land, return first line\n            var prevSibRect = Node.getClientRects(this.endContainer)[0];\n            return prevSibRect;\n            \n        } else {\n            \n            // otherwhise, let's rely on previous chars\n            var auxiliaryRange = this.cloneRange();\n            auxiliaryRange.setStart(this.endContainer,0);\n            \n            // correct with the new take\n            var prevSibRect = auxiliaryRange.getBoundingClientRect();\n            var adjustedBottom = Math.max(rect.bottom,prevSibRect.bottom);\n            return {\n                \n                left: rect.left,\n                right: rect.right,\n                width: rect.width,\n                \n                top: rect.top,\n                bottom: adjustedBottom,\n                height: adjustedBottom - rect.top\n                \n            };\n            \n        }\n        \n    } else {\n        \n        return rect;\n        \n    }\n}\nrequire.define('src/css-regions/lib/range-extensions.js');\n\n////////////////////////////////////////\n\n//\n// this module holds the big-picture actions of the polyfill\n//\nmodule.exports = (function(window, document) { \"use strict\";\n\t\n\tvar domEvents = require('src/core/dom-events.js');\n\tvar cssSyntax = require('src/core/css-syntax.js');\n\tvar cssCascade = require('src/core/css-cascade.js');\n\tvar cssBreak = require('src/core/css-break.js');\n\n\tvar cssRegionsHelpers = window.cssRegionsHelpers = {\n\t\t\n\t\t//\n\t\t// returns the previous sibling of the element\n\t\t// or the previous sibling of its nearest ancestor that has one\n\t\t//\n\t\tgetAllLevelPreviousSibling: function(e, region) {\n\t\t\tif(!e || e==region) return null;\n\t\t\t\n\t\t\t// find the nearest ancestor that has a previous sibling\n\t\t\twhile(!e.previousSibling) {\n\t\t\t\t\n\t\t\t\t// but bubble to the next avail ancestor\n\t\t\t\te = e.parentNode;\n\t\t\t\t\n\t\t\t\t// dont get over the bar\n\t\t\t\tif(!e || e==region) return null;\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// return that sibling\n\t\t\treturn e.previousSibling;\n\t\t},\n\t\t\n\t\t//\n\t\t// prepares the element to become a css region\n\t\t//\n\t\tmarkNodesAsRegion: function(nodes,fast) {\n\t\t\tnodes.forEach(function(node) {\n\t\t\t\tnode.regionOverset = 'empty';\n\t\t\t\tnode.setAttribute('data-css-region',node.cssRegionsLastFlowFromName);\n\t\t\t\tcssRegionsHelpers.hideTextNodesFromFragmentSource([node]);\n\t\t\t\tnode.cssRegionsWrapper = node.cssRegionsWrapper || node.appendChild(document.createElement(\"cssregion\"));\n\t\t\t});\n\t\t},\n\t\t\n\t\t//\n\t\t// prepares the element to return to its normal css life\n\t\t//\n\t\tunmarkNodesAsRegion: function(nodes,fast) {\n\t\t\tnodes.forEach(function(node) {\n\t\t\t\t\n\t\t\t\t// restore regionOverset to its natural value\n\t\t\t\tnode.regionOverset = 'fit';\n\t\t\t\t\n\t\t\t\t// remove the current <cssregion> tag\n\t\t\t\ttry { node.cssRegionsWrapper && node.removeChild(node.cssRegionsWrapper); } \n\t\t\t\tcatch(ex) { setImmediate(function() { throw ex })}; \n\t\t\t\tnode.cssRegionsWrapper = undefined;\n\t\t\t\tdelete node.cssRegionsWrapper;\n\t\t\t\t\n\t\t\t\t// restore top-level texts that may have been hidden\n\t\t\t\tcssRegionsHelpers.unhideTextNodesFromFragmentSource([node]);\n\t\t\t\t\n\t\t\t\t// unmark as a region\n\t\t\t\tnode.removeAttribute('data-css-region');\n\t\t\t});\n\t\t},\n\t\t\n\t\t//\n\t\t// prepares the element for cloning (mainly give them an ID)\n\t\t//\n\t\tfragmentSourceIndex: 0,\n\t\tmarkNodesAsFragmentSource: function(nodes,ignoreRoot) {\n\t\t\t\n\t\t\tfunction visit(node,k) {\n\t\t\t\tvar child, next;\n\t\t\t\tswitch (node.nodeType) {\n\t\t\t\t\tcase 1: // Element node\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(typeof(k)==\"undefined\" || !ignoreRoot) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// mark as fragment source\n\t\t\t\t\t\t\tvar id = node.getAttributeNode('data-css-regions-fragment-source');\n\t\t\t\t\t\t\tif(!id) { node.setAttribute('data-css-regions-fragment-source', cssRegionsHelpers.fragmentSourceIndex++); }\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tnode.setAttribute('data-css-regions-cloning', true);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// expand list values\n\t\t\t\t\t\tif(node.tagName=='OL') cssRegionsHelpers.expandListValues(node);\n\t\t\t\t\t\tif(typeof(k)!=\"undefined\" && node.tagName==\"LI\") cssRegionsHelpers.expandListValues(node.parentNode);\n\t\t\t\t\t\t\n\t\t\t\t\tcase 9: // Document node\n\t\t\t\t\tcase 11: // Document fragment node\n\t\t\t\t\t\tchild = node.firstChild;\n\t\t\t\t\t\twhile (child) {\n\t\t\t\t\t\t\tnext = child.nextSibling;\n\t\t\t\t\t\t\tvisit(child);\n\t\t\t\t\t\t\tchild = next;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tnodes.forEach(visit);\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// computes the \"value\" attribute of every LI element out there\n\t\t//\n\t\texpandListValues: function(OL) {\n\t\t\tif(OL.getAttribute(\"data-css-li-value-expanded\")) return;\n\t\t\tOL.setAttribute('data-css-li-value-expanded', true);\n\t\t\t\n\t\t\tif(OL.hasAttribute(\"reversed\")) {\n\t\t\t\t\n\t\t\t\tvar currentValue = OL.getAttribute(\"start\") ? parseInt(OL.getAttribute(\"start\")) : OL.childElementCount;\n\t\t\t\tvar increment = -1;\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\tvar currentValue = OL.getAttribute(\"start\") ? parseInt(OL.getAttribute(\"start\")) : 1;\n\t\t\t\tvar increment = +1;\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\tvar LI = OL.firstElementChild; var LIV = null;\n\t\t\twhile(LI) {\n\t\t\t\tif(LI.tagName===\"LI\") {\n\t\t\t\t\tif(LIV=LI.getAttributeNode(\"value\")) {\n\t\t\t\t\t\tcurrentValue = parseInt(LIV.nodeValue);\n\t\t\t\t\t\tLI.setAttribute('data-css-old-value', currentValue)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tLI.setAttribute(\"value\", currentValue);\n\t\t\t\t\t}\n\t\t\t\t\tcurrentValue = currentValue + increment;\n\t\t\t\t}\n\t\t\t\tLI = LI.nextElementSibling;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// reverts to automatic computation of the value of LI elements\n\t\t//\n\t\tunexpandListValues: function(OL) {\n\t\t\tif(!OL.hasAttribute('data-css-li-value-expanded')) return;\n\t\t\tOL.removeAttribute('data-css-li-value-expanded')\n\t\t\tvar LI = OL.firstElementChild; var LIV = null;\n\t\t\twhile(LI) {\n\t\t\t\tif(LI.tagName===\"LI\") {\n\t\t\t\t\tif(LIV=LI.getAttributeNode(\"data-css-old-value\")) {\n\t\t\t\t\t\tLI.removeAttributeNode(LIV);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tLI.removeAttribute('value');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tLI = LI.nextElementSibling;\n\t\t\t}\n\t\t},\n\t\t\n\t\t//\n\t\t// makes empty text nodes which cannot get \"display: none\" applied to them\n\t\t//\n\t\tlistOfTextNodesForIE: [],\n\t\thideTextNodesFromFragmentSource: function(nodes) {\n\t\t\t\n\t\t\tfunction visit(node,k) {\n\t\t\t\tvar child, next;\n\t\t\t\tswitch (node.nodeType) {\n\t\t\t\t\tcase 3: // Text node\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(!node.parentNode.getAttribute('data-css-regions-fragment-source')) {\n\t\t\t\t\t\t\t// we have to remove their content the hard way...\n\t\t\t\t\t\t\tnode.cssRegionsSavedNodeValue = node.nodeValue;\n\t\t\t\t\t\t\tnode.nodeValue = \"\";\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// HACK: OTHERWISE IE WILL GC THE TEXTNODE AND RETURNS YOU\n\t\t\t\t\t\t\t// A FRESH TEXTNODE THE NEXT TIME WHERE YOUR EXPANDO\n\t\t\t\t\t\t\t// IS NOWHERE TO BE SEEN!\n\t\t\t\t\t\t\tif(navigator.userAgent.indexOf('MSIE')>0 || navigator.userAgent.indexOf(\"Trident\")>0) {\n\t\t\t\t\t\t\t\tif(cssRegionsHelpers.listOfTextNodesForIE.indexOf(node)==-1) {\n\t\t\t\t\t\t\t\t\tcssRegionsHelpers.listOfTextNodesForIE.push(node);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\n\t\t\t\t\tcase 1: // Element node\n\t\t\t\t\t\tif(node.hasAttribute('data-css-regions-cloning')) {\n\t\t\t\t\t\t\tnode.removeAttribute('data-css-regions-cloning');\n\t\t\t\t\t\t\tnode.setAttribute('data-css-regions-cloned', true);\n\t\t\t\t\t\t\tif(node.currentStyle) node.currentStyle.display.toString(); // IEFIX FOR BAD STYLE RECALC\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(typeof(k)==\"undefined\") return;\n\t\t\t\t\t\t\n\t\t\t\t\tcase 9: // Document node\n\t\t\t\t\tcase 11: // Document fragment node                    \n\t\t\t\t\t\tchild = node.firstChild;\n\t\t\t\t\t\twhile (child) {\n\t\t\t\t\t\t\tnext = child.nextSibling;\n\t\t\t\t\t\t\tvisit(child);\n\t\t\t\t\t\t\tchild = next;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tnodes.forEach(visit);\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// makes emptied text nodes visible again\n\t\t//\n\t\tunhideTextNodesFromFragmentSource: function(nodes) {\n\t\t\t\n\t\t\tfunction visit(node) {\n\t\t\t\tvar child, next;\n\t\t\t\tswitch (node.nodeType) {\n\t\t\t\t\tcase 3: // Text node\n\t\t\t\t\t\t\n\t\t\t\t\t\t// we have to remove their content the hard way...\n\t\t\t\t\t\tif(\"cssRegionsSavedNodeValue\" in node) {\n\t\t\t\t\t\t\tnode.nodeValue = node.cssRegionsSavedNodeValue;\n\t\t\t\t\t\t\tdelete node.cssRegionsSavedNodeValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\n\t\t\t\t\tcase 1: // Element node\n\t\t\t\t\t\tif(typeof(k)==\"undefined\") return;\n\t\t\t\t\t\t\n\t\t\t\t\tcase 9: // Document node\n\t\t\t\t\tcase 11: // Document fragment node                    \n\t\t\t\t\t\tchild = node.firstChild;\n\t\t\t\t\t\twhile (child) {\n\t\t\t\t\t\t\tnext = child.nextSibling;\n\t\t\t\t\t\t\tvisit(child);\n\t\t\t\t\t\t\tchild = next;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tnodes.forEach(visit);\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// prepares the content elements to return to ther normal css life\n\t\t//\n\t\tunmarkNodesAsFragmentSource: function(nodes) {\n\t\t\t\n\t\t\tfunction visit(node,k) {\n\t\t\t\tvar child, next;\n\t\t\t\tswitch (node.nodeType) {\n\t\t\t\t\tcase 3: // Text node\n\t\t\t\t\t\t\n\t\t\t\t\t\t// we have to reinstall their content the hard way...\n\t\t\t\t\t\tif(\"cssRegionsSavedNodeValue\" in node) {\n\t\t\t\t\t\t\tnode.nodeValue = node.cssRegionsSavedNodeValue;\n\t\t\t\t\t\t\tdelete node.cssRegionsSavedNodeValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1: // Element node\n\t\t\t\t\t\tnode.removeAttribute('data-css-regions-cloned');\n\t\t\t\t\t\tnode.removeAttribute('data-css-regions-fragment-source');\n\t\t\t\t\t\tif(node.currentStyle) node.currentStyle.display.toString(); // IEFIX FOR BAD STYLE RECALC\n\t\t\t\t\t\tif(node.tagName==\"OL\") cssRegionsHelpers.unexpandListValues(node);\n\t\t\t\t\t\tif(typeof(k)!=\"undefined\" && node.tagName==\"LI\") cssRegionsHelpers.unexpandListValues(node.parentNode);\n\t\t\t\t\t\t\n\t\t\t\t\tcase 9: // Document node\n\t\t\t\t\tcase 11: // Document fragment node\n\t\t\t\t\t\tchild = node.firstChild;\n\t\t\t\t\t\twhile (child) {\n\t\t\t\t\t\t\tnext = child.nextSibling;\n\t\t\t\t\t\t\tvisit(child);\n\t\t\t\t\t\t\tchild = next;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tnodes.forEach(visit);\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// marks cloned content as fragment instead of as fragment source (basically)\n\t\t//\n\t\ttransformFragmentSourceToFragments: function(nodes) {\n\t\t\t\n\t\t\tfunction visit(node) {\n\t\t\t\tvar child, next;\n\t\t\t\tswitch (node.nodeType) {\n\t\t\t\t\tcase 1: // Element node\n\t\t\t\t\t\tvar id = node.getAttribute('data-css-regions-fragment-source');\n\t\t\t\t\t\tnode.removeAttribute('data-css-regions-fragment-source');\n\t\t\t\t\t\tnode.removeAttribute('data-css-regions-cloning');\n\t\t\t\t\t\tnode.removeAttribute('data-css-regions-cloned');\n\t\t\t\t\t\tnode.setAttribute('data-css-regions-fragment-of', id);\n\t\t\t\t\t\tif(node.id) node.id += \"--fragment\";\n\t\t\t\t\t\t\n\t\t\t\t\tcase 9: // Document node\n\t\t\t\t\tcase 11: // Document fragment node\n\t\t\t\t\t\tchild = node.firstChild;\n\t\t\t\t\t\twhile (child) {\n\t\t\t\t\t\t\tnext = child.nextSibling;\n\t\t\t\t\t\t\tvisit(child);\n\t\t\t\t\t\t\tchild = next;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tnodes.forEach(visit);\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// removes some invisible text nodes from the tree\n\t\t// (useful if you don't want to face browser bugs when dealing with them)\n\t\t//\n\t\tembedTrailingWhiteSpaceNodes: function(fragment) {\n\t\t\t\n\t\t\tvar onlyWhiteSpace = /^\\s*$/;\n\t\t\tfunction visit(node) {\n\t\t\t\tvar child, next;\n\t\t\t\tswitch (node.nodeType) {\n\t\t\t\t\tcase 3: // Text node\n\t\t\t\t\t\t\n\t\t\t\t\t\t// we only remove nodes at the edges\n\t\t\t\t\t\tif (!node.previousSibling) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// we only remove nodes if their parent doesn't preserve whitespace\n\t\t\t\t\t\t\tif (getComputedStyle(node.parentNode).whiteSpace.substring(0,3)!==\"pre\") {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// only remove pure whitespace nodes\n\t\t\t\t\t\t\t\tif (onlyWhiteSpace.test(node.nodeValue)) {\n\t\t\t\t\t\t\t\t\tnode.parentNode.setAttribute('data-whitespace-before',node.nodeValue);\n\t\t\t\t\t\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// we only remove nodes at the edges\n\t\t\t\t\t\tif (!node.nextSibling) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// we only remove nodes if their parent doesn't preserve whitespace\n\t\t\t\t\t\t\tif (getComputedStyle(node.parentNode).whiteSpace.substring(0,3)!==\"pre\") {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// only remove pure whitespace nodes\n\t\t\t\t\t\t\t\tif (onlyWhiteSpace.test(node.nodeValue)) {\n\t\t\t\t\t\t\t\t\tnode.parentNode.setAttribute('data-whitespace-after',node.nodeValue);\n\t\t\t\t\t\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 1: // Element node\n\t\t\t\t\tcase 9: // Document node\n\t\t\t\t\tcase 11: // Document fragment node\n\t\t\t\t\t\tchild = node.firstChild;\n\t\t\t\t\t\twhile (child) {\n\t\t\t\t\t\t\tnext = child.nextSibling;\n\t\t\t\t\t\t\tvisit(child);\n\t\t\t\t\t\t\tchild = next;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvisit(fragment);\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// recover the previously removed invisible text nodes\n\t\t//\n\t\tunembedTrailingWhiteSpaceNodes: function(fragment) {\n\t\t\t\n\t\t\tvar onlyWhiteSpace = /^\\s*$/;\n\t\t\tfunction visit(node) {\n\t\t\t\tvar child, next;\n\t\t\t\tswitch (node.nodeType) {\n\t\t\t\t\tcase 1: // Element node\n\t\t\t\t\t\tvar txt = \"\";\n\t\t\t\t\t\tif(txt = node.getAttribute('data-whitespace-before')) {\n\t\t\t\t\t\t\tif(node.getAttribute('data-starting-fragment')=='' && node.getAttribute('data-special-starting-fragment','')) {\n\t\t\t\t\t\t\t\tnode.insertBefore(document.createTextNode(txt),node.firstChild);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnode.removeAttribute('data-whitespace-before')\n\t\t\t\t\t\tif(txt = node.getAttribute('data-whitespace-after')) {\n\t\t\t\t\t\t\tif(node.getAttribute('data-continued-fragment')=='' && node.getAttribute('data-special-continued-fragment','')) {\n\t\t\t\t\t\t\t\tnode.insertAfter(document.createTextNode(txt),node.lastChild);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnode.removeAttribute('data-whitespace-after')\n\t\t\t\t\t\t\n\t\t\t\t\tcase 9: // Document node\n\t\t\t\t\tcase 11: // Document fragment node\n\t\t\t\t\t\tchild = node.firstChild;\n\t\t\t\t\t\twhile (child) {\n\t\t\t\t\t\t\tnext = child.nextSibling;\n\t\t\t\t\t\t\tvisit(child);\n\t\t\t\t\t\t\tchild = next;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvisit(fragment);\n\t\t\t\n\t\t},\n\t\t\n\t\t///\n\t\t/// walk the two trees the same way, and copy all the styles\n\t\t/// BEWARE: if the DOMs are different, funny things will happen\n\t\t/// NOTE: this function will also remove elements put in another flow\n\t\t///\n\t\tcopyStyle: function(root1, root2) {\n\t\t\t\n\t\t\tfunction visit(node1, node2, isRoot) {\n\t\t\t\tvar child1, next1, child2, next2;\n\t\t\t\tswitch (node1.nodeType) {\n\t\t\t\t\tcase 1: // Element node\n\t\t\t\t\t\t\n\t\t\t\t\t\t// firstly, setup a cache of all css properties on the element\n\t\t\t\t\t\tvar matchedRules = (node1.currentStyle && !window.opera) ? undefined : cssCascade.findAllMatchingRules(node1)\n\t\t\t\t\t\t\n\t\t\t\t\t\t// and compute the value of all css properties\n\t\t\t\t\t\tvar properties = cssCascade.allCSSProperties || cssCascade.getAllCSSProperties();\n\t\t\t\t\t\tfor(var p=properties.length; p--; ) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// if the property is computation-safe, use the computed value\n\t\t\t\t\t\t\tif(!(properties[p] in cssCascade.computationUnsafeProperties) && properties[p][0]!='-') {\n\t\t\t\t\t\t\t\tvar style = getComputedStyle(node1).getPropertyValue(properties[p]);\n\t\t\t\t\t\t\t\tvar defaultStyle = cssCascade.getDefaultStyleForTag(node1.tagName).getPropertyValue(properties[p]);\n\t\t\t\t\t\t\t\tif(style != defaultStyle) node2.style.setProperty(properties[p], style)\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// otherwise, get the element's specified value\n\t\t\t\t\t\t\tvar cssValue = cssCascade.getSpecifiedStyle(node1, properties[p], matchedRules);\n\t\t\t\t\t\t\tif(cssValue && cssValue.length) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// if we have a specified value, let's use it\n\t\t\t\t\t\t\t\tnode2.style.setProperty(properties[p], cssValue.toCSSString());\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t} else if(isRoot && node1.parentNode && properties[p][0] != '-') {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// NOTE: the root will be detached from its parent\n\t\t\t\t\t\t\t\t// Therefore, we have to inherit styles from it (oh no!)\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// TODO: create a list of inherited properties\n\t\t\t\t\t\t\t\tif(!(properties[p] in cssCascade.inheritingProperties)) continue;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// if the property is computation-safe, use the computed value\n\t\t\t\t\t\t\t\tif((properties[p]==\"font-size\") || (!(properties[p] in cssCascade.computationUnsafeProperties) && properties[p][0]!='-')) {\n\t\t\t\t\t\t\t\t\tvar style = getComputedStyle(node1).getPropertyValue(properties[p]);\n\t\t\t\t\t\t\t\t\tnode2.style.setProperty(properties[p], style);\n\t\t\t\t\t\t\t\t\t//var parentStyle = style; try { parentStyle = getComputedStyle(node1.parentNode).getPropertyValue(properties[p]) } catch(ex){}\n\t\t\t\t\t\t\t\t\t//var defaultStyle = cssCascade.getDefaultStyleForTag(node1.tagName).getPropertyValue(properties[p]);\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t//if(style === parentStyle) {\n\t\t\t\t\t\t\t\t\t//  node2.style.setProperty(properties[p], style)\n\t\t\t\t\t\t\t\t\t//}\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// otherwise, get the parent's specified value\n\t\t\t\t\t\t\t\tvar cssValue = cssCascade.getSpecifiedStyle(node1, properties[p], matchedRules);\n\t\t\t\t\t\t\t\tif(cssValue && cssValue.length) {\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// if we have a specified value, let's use it\n\t\t\t\t\t\t\t\t\tnode2.style.setProperty(properties[p], cssValue.toCSSString());\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// now, let's work on ::after and ::before\n\t\t\t\t\t\tvar importPseudo = function(node1,node2,pseudo) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//\n\t\t\t\t\t\t\t// we'll need to use getSpecifiedStyle here as the pseudo thing is slow\n\t\t\t\t\t\t\t//\n\t\t\t\t\t\t\tvar mayExist = !!cssCascade.findAllMatchingRulesWithPseudo(node1,pseudo.substr(1)).length;\n\t\t\t\t\t\t\tif(!mayExist) return;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar pseudoStyle = getComputedStyle(node1,pseudo);\n\t\t\t\t\t\t\tif(pseudoStyle.content!='none'){\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// let's create a stylesheet for the element\n\t\t\t\t\t\t\t\tvar stylesheet = document.createElement('style');\n\t\t\t\t\t\t\t\tstylesheet.setAttribute('data-no-css-polyfill',true);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// compute the value of all css properties\n\t\t\t\t\t\t\t\tvar node2style = \"\";\n\t\t\t\t\t\t\t\tvar properties = cssCascade.allCSSProperties || cssCascade.getAllCSSProperties();\n\t\t\t\t\t\t\t\tfor(var p=properties.length; p--; ) {\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// we always use the computed value, because we don't have better\n\t\t\t\t\t\t\t\t\tvar style = pseudoStyle.getPropertyValue(properties[p]);\n\t\t\t\t\t\t\t\t\tnode2style += properties[p]+\":\"+style+\";\";\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tstylesheet.textContent = (\n\t\t\t\t\t\t\t\t\t'[data-css-regions-fragment-of=\"' + node1.getAttribute('data-css-regions-fragment-source') + '\"]' \n\t\t\t\t\t\t\t\t\t+':not([data-css-regions-starting-fragment]):not([data-css-regions-special-starting-fragment])'\n\t\t\t\t\t\t\t\t\t+':'+pseudo+'{'\n\t\t\t\t\t\t\t\t\t+node2style\n\t\t\t\t\t\t\t\t\t+\"}\"\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tnode2.parentNode.insertBefore(stylesheet, node2);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\timportPseudo(node1,node2,\":before\");\n\t\t\t\t\t\timportPseudo(node1,node2,\":after\");\n\t\t\t\t\t\t\n\t\t\t\t\t\t// retarget events\n\t\t\t\t\t\tcssRegionsHelpers.retargetEvents(node1,node2);\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\tcase 9: // Document node\n\t\t\t\t\tcase 11: // Document fragment node\n\t\t\t\t\t\tchild1 = node1.firstChild;\n\t\t\t\t\t\tchild2 = node2.firstChild;\n\t\t\t\t\t\twhile (child1) {\n\t\t\t\t\t\t\tnext1 = child1.nextSibling;\n\t\t\t\t\t\t\tnext2 = child2.nextSibling;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// decide between process style or hide\n\t\t\t\t\t\t\tif(child1.cssRegionsLastFlowIntoName && child1.cssRegionsLastFlowIntoType===\"element\") {\n\t\t\t\t\t\t\t\tnode2.removeChild(child2);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvisit(child1, child2);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tchild1 = next1;\n\t\t\t\t\t\t\tchild2 = next2;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvisit(root1, root2, true);\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// make sure the most critical events still fire in the fragment source\n\t\t// even if the browser initially fire them on the fragments\n\t\t//\n\t\tretargetEvents: function retargetEvents(node1,node2) {\n\t\t\t\n\t\t\tvar retargetEvent = \"cssRegionsHelpers.retargetEvent(this,event)\";\n\t\t\tnode2.setAttribute(\"onclick\", retargetEvent);\n\t\t\tnode2.setAttribute(\"ondblclick\", retargetEvent);\n\t\t\tnode2.setAttribute(\"onmousedown\", retargetEvent);\n\t\t\tnode2.setAttribute(\"onmouseup\", retargetEvent);\n\t\t\tnode2.setAttribute(\"onmousein\", retargetEvent);\n\t\t\tnode2.setAttribute(\"onmouseout\", retargetEvent);\n\t\t\tnode2.setAttribute(\"onmouseenter\", retargetEvent);\n\t\t\tnode2.setAttribute(\"onmouseleave\", retargetEvent);\n\t\t\t\n\t\t},\n\t\t\n\t\t//\n\t\t// single hub for event retargeting operations.\n\t\t//\n\t\tretargetEvent: function retargeEvent(node2,e) {\n\t\t\t\n\t\t\t// get the node we should fire the event on\n\t\t\tvar node1 = (\n\t\t\t\t(node2.cssRegionsFragmentSource) ||\n\t\t\t\t(node2.cssRegionsFragmentSource=document.querySelector('[data-css-regions-fragment-source=\"' + node2.getAttribute('data-css-regions-fragment-of') + '\"]'))\n\t\t\t);\n\t\t\t\n\t\t\tif(node1) {\n\t\t\t\n\t\t\t\t// dispatch the event on the real node\n\t\t\t\tvar ne = domEvents.cloneEvent(e);\n\t\t\t\tnode1.dispatchEvent(ne);\n\t\t\t\t\n\t\t\t\t// prevent the event to fire on the region\n\t\t\t\te.stopImmediatePropagation ? e.stopImmediatePropagation() : e.stopPropagation();\n\t\t\t\t\n\t\t\t\t// make sure to cancel the event if required\n\t\t\t\tif(ne.isDefaultPrevented || ne.defaultPrevented) { e.preventDefault(); return false; }\n\t\t\t\n\t\t\t}\n\t\t\t\n\t\t}\n\t};\n\t\n\treturn cssRegionsHelpers;\n\t\n})(window, document);\nrequire.define('src/css-regions/lib/helpers.js');\n\n////////////////////////////////////////\n\n//\n// this module holds the front-facing features of the polyfill\n//\nmodule.exports = (function(window, document, cssRegions) { \"use strict\";\n\n\tvar domEvents = require('src/core/dom-events.js');\n\tvar cssSyntax = require('src/core/css-syntax.js');\n\tvar cssCascade = require('src/core/css-cascade.js');\n\tvar cssBreak = require('src/core/css-break.js');\n\tvar cssRegionsHelpers = require('src/css-regions/lib/helpers.js');\n\tvar ES = require('src/core/dom-experimental-event-streams.js');\n\n\t// \n\t// this class contains flow-relative data field\n\t// \n\tcssRegions.Flow = function NamedFlow(name) {\n\t\t\n\t\t// TODO: force immediate relayout if someone ask the overset properties\n\t\t// and the layout has been deemed wrong (still isn't a proof of correctness but okay)\n\t\t\n\t\t// define the flow name\n\t\tthis.name = name; Object.defineProperty(this, \"name\", {get: function() { return name; }});\n\t\t\n\t\t// define the overset status\n\t\tthis.overset = false;\n\t\t\n\t\t// define the first empty region\n\t\tthis.firstEmptyRegionIndex = -1;\n\t\t\n\t\t// elements poured into the flow\n\t\tthis.content = []; this.lastContent = [];\n\t\t\n\t\t// elements that consume this flow\n\t\tthis.regions = []; this.lastRegions = [];\n\t\t\n\t\t// event handlers\n\t\tthis.eventListeners = {\n\t\t\t\"regionfragmentchange\": [],\n\t\t\t\"regionoversetchange\": [],\n\t\t};\n\t\t\n\t\t// this function is used to work with dom event streams\n\t\tvar This=this; This.update = function(stream) {\n\t\t\tstream.schedule(This.update); This.relayout();\n\t\t};\n\t\t\n\t\t// register to style changes already\n\t\tThis.lastStylesheetAdded = 0;\n\t\tcssCascade.addEventListener('stylesheetadded', function() {\n\t\t\tif(This.lastStylesheetAdded - Date() > 100) {\n\t\t\t\tThis.lastStylesheetAdded = +Date();\n\t\t\t\tThis.relayout();\n\t\t\t} else {\n\t\t\t\tcssConsole.warn(\"Please don't add stylesheets as a response to region events. Operation cancelled.\")\n\t\t\t}\n\t\t});\n\t\t\n\t\t// a small counter to avoid enter retry loops\n\t\tThis.failedLayoutCount = 0;\n\t\t\n\t\t// some other fields\n\t\tThis.lastEventRAF = 0;\n\t\tThis.restartLayout = false;\n\t}\n\t\t\n\tcssRegions.Flow.prototype.removeFromContent = function(element) {\n\t\t\n\t\t// clean up stuff\n\t\tthis.removeEventListenersOf(element);\n\t\t\n\t\t// remove reference\n\t\tvar index = this.content.indexOf(element);\n\t\tif(index>=0) { this.content.splice(index,1); }\n\t\t\n\t};\n\n\tcssRegions.Flow.prototype.removeFromRegions = function(element) {\n\t\t\n\t\t// clean up stuff\n\t\tthis.removeEventListenersOf(element);\n\t\t\n\t\t// remove reference\n\t\tvar index = this.regions.indexOf(element);\n\t\tif(index>=0) { this.regions.splice(index,1); }\n\t\t\n\t};\n\n\tcssRegions.Flow.prototype.addToContent = function(element) {\n\t\t\n\t\t// handle trivial cases real quick\n\t\tvar content = this.content; \n\t\tif(content.length==0 || content[content.length-1].nextSibling === element) {\n\t\t\tcontent.push(element);\n\t\t\treturn;\n\t\t}\n\t\tif(content[0].previousSibling === element) {\n\t\t\tcontent.unshift(element);\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// walk the tree to find an element inside the content chain\n\t\tvar currentNodeIndex = -1;\n\t\tvar treeWalker = document.createTreeWalker(\n\t\t\tdocument.documentElement,\n\t\t\tNodeFilter.SHOW_ELEMENT,\n\t\t\tfunction(node) { \n\t\t\t\treturn (currentNodeIndex = content.indexOf(node)) >= 0 ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP; \n\t\t\t},\n\t\t\tfalse\n\t\t); \n\t\t\n\t\t// which by the way has to be after the considered element\n\t\ttreeWalker.currentNode = element;\n\t\t\n\t\t// if we find such node\n\t\tif(treeWalker.nextNode()) {\n\t\t\t\n\t\t\t// insert the element at his current location\n\t\t\tcontent.splice(currentNodeIndex,0,element);\n\t\t\t\n\t\t} else {\n\t\t\t\n\t\t\t// add the new element to the end of the array\n\t\t\tcontent.push(element);\n\t\t\t\n\t\t}\n\n\t};\n\n\tcssRegions.Flow.prototype.addToRegions = function(element) {\n\t\t\n\t\t// walk the tree to find an element inside the region chain\n\t\tvar regions = this.regions;\n\t\tvar treeWalker = document.createTreeWalker(\n\t\t\tdocument.documentElement,\n\t\t\tNodeFilter.SHOW_ELEMENT,\n\t\t\tfunction(node) { \n\t\t\t\treturn regions.indexOf(node) >= 0 ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT; \n\t\t\t},\n\t\t\tfalse\n\t\t);\n\t\t\n\t\t// which by the way has to be after the considered element\n\t\ttreeWalker.currentNode = element;\n\t\t\n\t\t// if we find such node\n\t\tif(treeWalker.nextNode()) {\n\t\t\t\n\t\t\t// insert the element at his current location\n\t\t\tregions.splice(this.regions.indexOf(treeWalker.currentNode),0,element);\n\t\t\t\n\t\t} else {\n\t\t\t\n\t\t\t// add the new element to the end of the array\n\t\t\tregions.push(element);\n\t\t}\n\t\t\n\t};\n\n\tcssRegions.Flow.prototype.generateContentFragment = function() {\n\t\tvar fragment = document.createDocumentFragment(); var This=this;\n\n\t\t// add copies of all due content\n\t\tfor(var i=0; i<this.content.length; i++) {\n\t\t\tvar element = this.content[i];\n\t\t\t\n\t\t\t// \n\t\t\t// STEP 1: IDENTIFY FRAGMENT SOURCES AS SUCH\n\t\t\t//\n\t\t\tcssRegionsHelpers.markNodesAsFragmentSource([element], element.cssRegionsLastFlowIntoType==\"content\");\n\t\t\t\n\t\t\t\n\t\t\t//\n\t\t\t// STEP 2: CLONE THE FRAGMENT SOURCES\n\t\t\t// \n\t\t\t\n\t\t\t// depending on the requested behavior\n\t\t\tif(element.cssRegionsLastFlowIntoType==\"element\") {\n\t\t\t\t\n\t\t\t\t\t// add the element\n\t\t\t\t\tvar el = element;\n\t\t\t\t\tvar elClone = el.cloneNode(true);\n\t\t\t\t\tvar elToInsert = elClone; if(elToInsert.tagName==\"LI\") {\n\t\t\t\t\t\telToInsert = document.createElement(el.parentNode.tagName);\n\t\t\t\t\t\telToInsert.style.margin=\"0\";\n\t\t\t\t\t\telToInsert.style.padding=\"0\";\n\t\t\t\t\t\telToInsert.appendChild(elClone);\n\t\t\t\t\t}\n\t\t\t\t\tfragment.appendChild(elToInsert);\n\t\t\t\t\t\n\t\t\t\t\t// clone the style\n\t\t\t\t\tcssRegionsHelpers.copyStyle(el, elClone);\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\t// add current children\n\t\t\t\tvar el = element.firstChild; while(el) {\n\t\t\t\t\t\n\t\t\t\t\t// add the element\n\t\t\t\t\tvar elClone = el.cloneNode(true);\n\t\t\t\t\tvar elToInsert = elClone; if(elToInsert.tagName==\"LI\") {\n\t\t\t\t\t\telToInsert = document.createElement(el.parentNode.tagName);\n\t\t\t\t\t\telToInsert.style.margin=\"0\";\n\t\t\t\t\t\telToInsert.style.padding=\"0\";\n\t\t\t\t\t\telToInsert.appendChild(elClone);\n\t\t\t\t\t}\n\t\t\t\t\tfragment.appendChild(elToInsert);\n\t\t\t\t\t\n\t\t\t\t\t// clone the style\n\t\t\t\t\tcssRegionsHelpers.copyStyle(el, elClone);\n\t\t\t\t\t\n\t\t\t\t\tel = el.nextSibling;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t\n\t\t//\n\t\t// STEP 3: HIDE TEXT NODES IN FRAGMENT SOURCES\n\t\t//\n\t\tcssRegionsHelpers.hideTextNodesFromFragmentSource(this.content);\n\t\t\n\t\t//\n\t\t// STEP 4: CONVERT CLONED FRAGMENT SOURCES INTO TRUE FRAGMENTS\n\t\t//\n\t\tcssRegionsHelpers.transformFragmentSourceToFragments(\n\t\t\tArray.prototype.slice.call(fragment.childNodes,0)\n\t\t)\n\t\t\n\t\t\n\t\t//\n\t\t// CLONED CONTENT IS READY!\n\t\t//\n\t\treturn fragment;\n\t}\n\n\tcssRegions.Flow.prototype.relayout = function() {\n\t\tvar This = this;\n\t\t\n\t\t// prevent previous relayouts from eventing\n\t\tcancelAnimationFrame(This.lastEventRAF);\n\t\t\n\t\t// batch relayout queries\n\t\tif(This.relayoutScheduled) { return; }\n\t\tif(This.relayoutInProgress) { This.restartLayout=true; return; }\n\t\tThis.relayoutScheduled = true;\n\t\trequestAnimationFrame(function() { This._relayout() });\n\t\t\n\t}\n\n\tcssRegions.Flow.prototype._relayout = function(data){\n\t\tvar This=this;\n\t\t\n\t\ttry {\n\t\t\t\n\t\t\t//\n\t\t\t// note: it is recommended to look at the beautiful \n\t\t\t// drawings I made before attempting to understand\n\t\t\t// this stuff. If you don't have them, ask me.\n\t\t\t//\n\t\t\tcssConsole.log(\"starting a new relayout for \"+This.name);\n\t\t\tThis.relayoutInProgress=true; This.relayoutScheduled=false;\n\t\t\tThis.lastRelayout = +new Date();\n\t\t\t//debugger;\n\t\t\t\n\t\t\t// NOTE: we recover the scroll position in case the browser mess it up\n\t\t\tvar docElmScrollTop = data && data.docElmScrollTop ? data.docElmScrollTop : document.documentElement.scrollTop;\n\t\t\tvar docBdyScrollTop = data && data.docBdyScrollTop ? data.docBdyScrollTop : document.body.scrollTop;\n\t\t\t\n\t\t\t\n\t\t\t//\n\t\t\t// STEP 1: REMOVE PREVIOUS EVENT LISTENERS\n\t\t\t//\n\t\t\t\n\t\t\t// remove the listeners from everything\n\t\t\tThis.removeEventListenersOf(This.lastRegions);\n\t\t\tThis.removeEventListenersOf(This.lastContent);\n\t\t\tcancelAnimationFrame(This.lastEventRAF);\n\t\t\t\n\t\t\t\n\t\t\t//\n\t\t\t// STEP 2: RESTORE CONTENT/REGIONS TO A CLEAN STATE\n\t\t\t//\n\t\t\t\n\t\t\t// detect elements being removed of the document\n\t\t\tThis.regions = This.regions.filter(function(e) { return document.documentElement.contains(e); })\n\t\t\tThis.content = This.content.filter(function(e) { return document.documentElement.contains(e); })\n\t\t\t\n\t\t\t// cleanup previous layout\n\t\t\tcssRegionsHelpers.unmarkNodesAsRegion(This.lastRegions); This.lastRegions = This.regions.slice(0);\n\t\t\tcssRegionsHelpers.unmarkNodesAsFragmentSource(This.lastContent); This.lastContent = This.content.slice(0);\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//\n\t\t\t// STEP 3: EMPTY ALL REGIONS\n\t\t\t// ADD WRAPPER FOR FLOW CONTENT\n\t\t\t// PREPARE FOR CONTENT CLONING\n\t\t\t//\n\t\t\t\n\t\t\t// empty all the regions\n\t\t\tcssRegionsHelpers.markNodesAsRegion(This.regions);\n\t\t\t\n\t\t\t// create a fresh list of the regions\n\t\t\tvar regionStack = This.regions.slice(0).reverse();\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//\n\t\t\t// STEP 4: CLONE THE CONTENT\n\t\t\t// ADD METADATA TO CLONED CONTENT\n\t\t\t// HIDE FLOW CONTENT AT INITIAL POSITION\n\t\t\t//\n\t\t\t\n\t\t\t// create a fresh list of the content\n\t\t\t// compute the style of all source elements\n\t\t\t// generate stylesheets for those rules\n\t\t\tvar contentFragment = This.generateContentFragment();\n\t\t\t\n\t\t\t\n\t\t\t\n\t\t\t//\n\t\t\t// STEP 5: POUR CONTENT INTO THE REGIONS\n\t\t\t//\n\t\t\t\n\t\t\t// layout this stuff\n\t\t\tcssRegions.layoutContent(regionStack, contentFragment, {\n\t\t\t\tonprogress: function(continueLayout) {\n\t\t\t\t\t\n\t\t\t\t\t// NOTE: we recover the scroll position in case the browser mess it up\n\t\t\t\t\tdocument.documentElement.scrollTop = docElmScrollTop;\n\t\t\t\t\tdocument.body.scrollTop = docBdyScrollTop;\n\t\t\t\t\t\n\t\t\t\t\t// NOTE: if the current layout goes nowhere, start a new one already\n\t\t\t\t\tif(This.restartLayout) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tThis.relayoutInProgress = false;\n\t\t\t\t\t\tThis.failedLayoutCount = 0;\n\t\t\t\t\t\tThis.restartLayout = false;\n\t\t\t\t\t\tThis._relayout({\n\t\t\t\t\t\t\tdocElmScrollTop: docElmScrollTop,\n\t\t\t\t\t\t\tdocBdyScrollTop: docBdyScrollTop\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\t\n\t\t\t\t\t\tsetImmediate(continueLayout);\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t},\n\t\t\t\tondone: function onLayoutDone(overset) {\n\t\t\t\t\n\t\t\t\t\tThis.overset = overset;\n\t\t\t\t\tThis.firstEmptyRegionIndex = This.regions.length-1; while(This.regions[This.firstEmptyRegionIndex]) {\n\t\t\t\t\t\n\t\t\t\t\t\t// tell whether the region is empty\n\t\t\t\t\t\tvar isEmpty = false;\n\t\t\t\t\t\tisEmpty = isEmpty || !This.regions[This.firstEmptyRegionIndex].cssRegionsWrapper;\n\t\t\t\t\t\tisEmpty = isEmpty || !This.regions[This.firstEmptyRegionIndex].cssRegionsWrapper.firstChild;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// if the region is not empty\n\t\t\t\t\t\tif(!isEmpty) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// the first empty region if the next one, if it exists\n\t\t\t\t\t\t\tif((++This.firstEmptyRegionIndex)==This.regions.length) {\n\t\t\t\t\t\t\t\tThis.firstEmptyRegionIndex = -1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t// else, let's try the previous region\n\t\t\t\t\t\t\tThis.firstEmptyRegionIndex--; \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t//\n\t\t\t\t\t// STEP 6: REGISTER TO UPDATE EVENTS\n\t\t\t\t\t//\n\t\t\t\t\t\n\t\t\t\t\t// make sure regions update are taken in consideration\n\t\t\t\t\tif(window.MutationObserver) {\n\t\t\t\t\t\tThis.addEventListenersTo(This.content);\n\t\t\t\t\t\tThis.addEventListenersTo(This.regions);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// the other browsers don't get this as acurately\n\t\t\t\t\t\t// but that shouldn't be that of an issue for 99% of the cases\n\t\t\t\t\t\tsetImmediate(function() {\n\t\t\t\t\t\t\tThis.addEventListenersTo(This.content);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t//\n\t\t\t\t\t// STEP 7: FIRE SOME EVENTS\n\t\t\t\t\t//\n\t\t\t\t\tif(This.regions.length > 0 && !This.restartLayout) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// before doing anything, let's check our stuff is consistent\n\t\t\t\t\t\tvar isBuggy = false;\n\t\t\t\t\t\tisBuggy = isBuggy || This.regions.some(function(e) { return !document.documentElement.contains(e); })\n\t\t\t\t\t\tisBuggy = isBuggy || This.content.some(function(e) { return !document.documentElement.contains(e); })\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(isBuggy) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// if we found any bug, we will need to restart a layout\n\t\t\t\t\t\t\tcssConsole.warn(\"Buggy css regions layout: the page changed; we need to restart.\");\n\t\t\t\t\t\t\tThis.restartLayout = true; \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// if it was okay, let's fire some event\n\t\t\t\t\t\t\tThis.lastEventRAF = requestAnimationFrame(function() {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// TODO: only fire when necessary but...\n\t\t\t\t\t\t\t\tThis.dispatchEvent('regionfragmentchange');\n\t\t\t\t\t\t\t\tThis.dispatchEvent('regionoversetchange');\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t// NOTE: we recover the scroll position in case the browser mess it up\n\t\t\t\t\tdocument.documentElement.scrollTop = docElmScrollTop;\n\t\t\t\t\tdocument.body.scrollTop = docBdyScrollTop;\n\t\t\t\t\t\n\t\t\t\t\t// mark layout has being done\n\t\t\t\t\tThis.relayoutInProgress = false;\n\t\t\t\t\tThis.failedLayoutCount = 0;\n\t\t\t\t\t\n\t\t\t\t\t// restart a layout if a request was queued during the current one\n\t\t\t\t\tif(This.restartLayout) {\n\t\t\t\t\t\tThis.restartLayout = false;\n\t\t\t\t\t\tThis.relayout();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t} catch(ex) {\n\t\t\t\n\t\t\t// sometimes IE fails for no valid reason \n\t\t\t// (other than the page is still loading)\n\t\t\tsetImmediate(function() { throw ex; });\n\t\t\t\n\t\t\t// but we cannot accept to fail, so we need to try again\n\t\t\t// until we finish a complete layout pass...\n\t\t\tThis.failedLayoutCount++;\n\t\t\tif(This.failedLayoutCount<7) {requestAnimationFrame(function() { This._relayout() });}\n\t\t\telse {This.failedLayoutCount=0; This.relayoutScheduled=false; This.relayoutInProgress=false; This.restartLayout=false; }\n\t\t\t\n\t\t}\n\t}\n\n\tcssRegions.Flow.prototype.relayoutIfSizeChanged = function() {\n\t\t\n\t\t// go through all regions\n\t\t// and see if any did change of size\n\t\tvar rs = this.regions;     \n\t\tfor(var i=rs.length; i--; ) {\n\t\t\tif(\n\t\t\t\trs[i].offsetHeight !== rs[i].cssRegionsLastOffsetHeight\n\t\t\t\t|| rs[i].offsetWidth !== rs[i].cssRegionsLastOffsetWidth\n\t\t\t) {\n\t\t\t\tthis.relayout(); return;\n\t\t\t}\n\t\t}\n\t\t\n\t}\n\n\tcssRegions.Flow.prototype.addEventListenersTo = function(nodes) {\n\t\tvar This=this; if(nodes instanceof Element) { nodes=[nodes] }\n\t\t\n\t\tnodes.forEach(function(element) {\n\t\t\tif(!element.cssRegionsEventStream) {\n\t\t\t\telement.cssRegionsEventStream = new ES.DOMUpdateEventStream({target: element});\n\t\t\t\telement.cssRegionsEventStream.schedule(This.update);\n\t\t\t}\n\t\t});\n\t\t\n\t}\n\n\tcssRegions.Flow.prototype.removeEventListenersOf = function(nodes) {\n\t\tvar This=this; if(nodes instanceof Element) { nodes=[nodes] }\n\t\t\n\t\tnodes.forEach(function(element) {\n\t\t\tif(element.cssRegionsEventStream) {\n\t\t\t\telement.cssRegionsEventStream.dispose();\n\t\t\t\tdelete element.cssRegionsEventStream;\n\t\t\t}\n\t\t});\n\t\t\n\t}\n\n\t// alias\n\tcssRegions.NamedFlow = cssRegions.Flow;\n\n\t// return a disconnected array of the content of a NamedFlow\n\tcssRegions.NamedFlow.prototype.getContent = function getContent() {\n\t\treturn this.content.slice(0)\n\t}\n\n\t// return a disconnected array of the regions of a NamedFlow\n\tcssRegions.NamedFlow.prototype.getRegions = function getRegions() {\n\t\treturn this.regions.slice(0)\n\t}\n\n\tcssRegions.NamedFlow.prototype.getRegionsByContent = function getRegionsByContent(node) {\n\t\tvar regions = [];\n\t\tvar fragments = document.querySelectorAll('[data-css-regions-fragment-of=\"'+node.getAttribute('data-css-regions-fragment-source')+'\"]');\n\t\tfor (var i=0; i<fragments.length; i++) {\n\t\t\t\n\t\t\tvar current=fragments[i]; do {\n\t\t\t\t\n\t\t\t\tif(current.getAttribute('data-css-region')) {\n\t\t\t\t\tregions.push(current); break;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} while(current=current.parentNode);\n\t\t\t\n\t\t}\n\t\t\n\t\treturn regions;\n\t}\n\n\tdomEvents.EventTarget.implementsIn(cssRegions.Flow);\n\n\t//\n\t// this class is a collection of named flows (not an array, sadly)\n\t//\n\tcssRegions.NamedFlowCollection = function NamedFlowCollection() {\n\t\t\n\t\tthis.length = 0;\n\t\t\n\t}\n\n\tcssRegions.NamedFlowCollection.prototype.namedItem = function(k) {\n\t\treturn cssRegions.flows[k] || (cssRegions.flows[k]=new cssRegions.Flow(k));\n\t}\n\n\n\t//\n\t// this helper creates the required methods on top of the DOM {ie: public exports}\n\t//\n\tcssRegions.enablePolyfillObjectModel = function() {\n\t\t\n\t\t//\n\t\t// DOCUMENT INTERFACE\n\t\t//\n\t\t\n\t\t//\n\t\t// returns a static list of active named flows\n\t\t//\n\t\tdocument.getNamedFlows = function() {\n\t\t\t\t\n\t\t\tvar c = new cssRegions.NamedFlowCollection(); var flows = cssRegions.flows;\n\t\t\tfor(var flowName in cssRegions.flows) {\n\t\t\t\t\n\t\t\t\tif(Object.prototype.hasOwnProperty.call(flows, flowName)) {\n\t\t\t\t\t\n\t\t\t\t\t// only active flows can be included\n\t\t\t\t\tif(flows[flowName].content.length!=0 || flows[flowName].regions.length!=0) {\n\t\t\t\t\t\tc[c.length++] = c[flowName] = flows[flowName];\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\treturn c;\n\t\t\t\n\t\t}\n\t\t\n\t\t//\n\t\t// returns a live object for any named flow\n\t\t//\n\t\tdocument.getNamedFlow = function(flowName) {\n\t\t\t\t\n\t\t\tvar flows = cssRegions.flows;\n\t\t\treturn (flows[flowName] || (flows[flowName]=new cssRegions.NamedFlow(flowName)));\n\t\t\t\n\t\t}\n\t\t\n\t\t//\n\t\t// ELEMENT INTERFACE\n\t\t//    \n\t\tObject.defineProperties(\n\t\t\tElement.prototype,\n\t\t\t{\n\t\t\t\t\"regionOverset\": {\n\t\t\t\t\tget: function() {\n\t\t\t\t\t\treturn this._regionOverset || 'fit';\n\t\t\t\t\t},\n\t\t\t\t\tset: function(value) {\n\t\t\t\t\t\tthis._regionOverset = value;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"getRegionFlowRanges\": {\n\t\t\t\t\tvalue: function getRegionFlowRanges() {\n\t\t\t\t\t\treturn null; // TODO: can we implement that? I think we can't (properly).\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"getComputedRegionStyle\": {\n\t\t\t\t\tvalue: function getComputedRegionStyle(element,pseudo) {\n\t\t\t\t\t\t// TODO: only works while we don't relayout\n\t\t\t\t\t\t// TODO: only works properly for elements actually in the region\n\t\t\t\t\t\tvar fragment = document.querySelector('[data-css-regions-fragment-of=\"'+element.getAttribute('data-css-regions-fragment-source')+'\"]');\n\t\t\t\t\t\tif(pseudo) {\n\t\t\t\t\t\t\treturn getComputedStyle(fragment||element, pseudo);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn getComputedStyle(fragment||element);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\n\t\t\n\t\t//\n\t\t// CSSStyleDeclaration interface\n\t\t//\n\t\tcssCascade.polyfillStyleInterface('flow-into');\n\t\tcssCascade.polyfillStyleInterface('flow-from');\n\t\tcssCascade.polyfillStyleInterface('region-fragment');\n\t\tcssCascade.polyfillStyleInterface('break-before');\n\t\tcssCascade.polyfillStyleInterface('break-after');\n\n\t}\n\n\t// load the polyfill immediately if not especially told otherwise\n\tif(!(\"cssRegionsManualTrigger\" in window)) { cssRegions.enablePolyfill(); }\n\t\n});\nrequire.define('src/css-regions/lib/objectmodel.js');\n\n////////////////////////////////////////\n\n//\n// this module holds the big-picture actions of the polyfill\n//\nmodule.exports = (function(window, document) { \"use strict\";\n\n\tvar domEvents = require('src/core/dom-events.js');\n\tvar cssSyntax = require('src/core/css-syntax.js');\n\tvar cssCascade = require('src/core/css-cascade.js');\n\tvar cssBreak = require('src/core/css-break.js');\n\t\n\trequire('src/css-regions/lib/range-extensions.js');\n\tvar cssRegionsHelpers = require('src/css-regions/lib/helpers.js');\n\tvar enableObjectModel = require('src/css-regions/lib/objectmodel.js');\n\t\n\tvar CSS_STYLE = \"cssregion,[data-css-region]>*,[data-css-regions-fragment-source]:not([data-css-regions-cloning]),[data-css-regions-fragment-source][data-css-regions-cloned]{display:none!important}[data-css-region]>cssregion:last-of-type{display:inline!important}[data-css-region]{content:normal!important}[data-css-special-continued-fragment]{counter-reset:none!important;counter-increment:none!important;margin-bottom:0!important;border-bottom-left-radius:0!important;border-bottom-right-radius:0!important}[data-css-continued-fragment]{counter-reset:none!important;counter-increment:none!important;margin-bottom:0!important;padding-bottom:0!important;border-bottom:none!important;border-bottom-left-radius:0!important;border-bottom-right-radius:0!important}[data-css-continued-fragment]::after{content:none!important;display:none!important}[data-css-special-starting-fragment]{text-indent:0!important;margin-top:0!important}[data-css-starting-fragment]{text-indent:0!important;margin-top:0!important;padding-top:0!important;border-top:none!important;border-top-left-radius:0!important;border-top-right-radius:0!important}[data-css-starting-fragment]::before{content:none!important;display:none!important}[data-css-continued-block-fragment][data-css-continued-fragment]:not(:empty)::after{content:''!important;display:inline-block!important;width:100%!important;height:0!important;font-size:0!important;line-height:0!important;margin:0!important;padding:0!important;border:0!important}\";\n\n\tvar cssRegions = {\n\t\t\n\t\t//\n\t\t// this function is at the heart of the region polyfill\n\t\t// it will iteratively fill a list of regions until no\n\t\t// content or no region is left\n\t\t//\n\t\t// the before-overflow size of a region is determined by\n\t\t// adding all content to it and comparing his offsetHeight\n\t\t// and his scrollHeight\n\t\t//\n\t\t// when this is done, we use dom ranges to detect the point\n\t\t// where the content exceed this box and we split the fragment\n\t\t// at that point.\n\t\t//\n\t\t// when splitting inside an element, the borders, paddings and\n\t\t// generated content must be tied to the right fragments which\n\t\t// require some code\n\t\t//\n\t\t// this functions returns whether some content was still remaining\n\t\t// when the flow when the last region was filled. please not this\n\t\t// can only happen if this last region has \"region-fragment\" set\n\t\t// to break, otherwhise all the content will automatically overflow\n\t\t// this last region.\n\t\t//\n\t\tlayoutContent: function(regions, remainingContent, callback, startTime) {\n\t\t\t\n\t\t\t//\n\t\t\t// this function will iteratively fill all the regions\n\t\t\t// when we reach the last region, we return the overset status\n\t\t\t//\n\t\t\t\n\t\t\t// validate args\n\t\t\tif(!regions) return callback.ondone(!!remainingContent.hasChildNodes());\n\t\t\tif(!regions.length) return callback.ondone(!!remainingContent.hasChildNodes());\n\t\t\tif(!startTime) startTime = Date.now();\n\t\t\t\n\t\t\t// get the next region\n\t\t\tvar region = regions.pop();\n\t\t\t  \n\t\t\t// NOTE: while we don't monitor that, and it can therefore become inaccurate\n\t\t\t// I'm going to follow the spec and refuse to mark as region inline/none elements]\n\t\t\twhile(true) {\n\t\t\t\tvar regionDisplay = getComputedStyle(region).display;\n\t\t\t\tif(regionDisplay == \"none\" || regionDisplay.indexOf(\"inline\") !== -1) {\n\t\t\t\t\tif(region = regions.pop()) { continue } else { return callback.ondone(!!remainingContent.hasChildNodes()) };\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// the polyfill actually use a <cssregion> wrapper\n\t\t\t// we need to link this wrapper and the actual region\n\t\t\tif(region.cssRegionsWrapper) {\n\t\t\t\tregion.cssRegionsWrapper.cssRegionHost = region;\n\t\t\t\tregion = region.cssRegionsWrapper;\n\t\t\t} else {\n\t\t\t\tregion.cssRegionHost = region;\n\t\t\t}\n\t\t\t\n\t\t\t// empty the region\n\t\t\tregion.innerHTML = '';\n\t\t\t\n\t\t\t// avoid doing the layout of empty regions\n\t\t\tif(!remainingContent.hasChildNodes()) {\n\t\t\t\t\n\t\t\t\tregion.cssRegionHost.cssRegionsLastOffsetHeight = region.cssRegionHost.offsetHeight;\n\t\t\t\tregion.cssRegionHost.cssRegionsLastOffsetWidth = region.cssRegionHost.offsetWidth;\n\t\t\t\t\n\t\t\t\tregion.cssRegionHost.regionOverset = 'empty';\n\t\t\t\t\n\t\t\t\tvar dummyCallback = { ondone:function(){}, onprogress:function(f){f()} };\n\t\t\t\tcssRegions.layoutContent(regions, remainingContent, dummyCallback, startTime);\n\t\t\t\t\n\t\t\t\treturn callback.ondone(false);\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// append the remaining content to the region\n\t\t\tregion.appendChild(remainingContent);\n\t\t\t\n\t\t\t// check if we have more regions to process\n\t\t\tif(regions.length !== 0) {\n\t\t\t\t\n\t\t\t\treturn this.layoutContentInNextRegionsWhenReady(region, regions, remainingContent, callback, startTime);\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\treturn this.layoutContentInLastRegionWhenReady(region, regions, remainingContent, callback, startTime);\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t\n\t\tlayoutContentInNextRegionsWhenReady: function(region, regions, remainingContent, callback, startTime) {\n\t\t\t\t\t\n\t\t\t// delays until all images are loaded\n\t\t\tvar imgs = region.getElementsByTagName('img');\n\t\t\tfor(var imgs_index=imgs.length; imgs_index--; ) {\n\t\t\t\tif(!imgs[imgs_index].complete && !imgs[imgs_index].hasAttribute('height')) {\n\t\t\t\t\treturn setTimeout(\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\tthis.layoutContentInNextRegionsWhenReady(region, regions, remainingContent, callback, startTime+32);\n\t\t\t\t\t\t}.bind(this), \n\t\t\t\t\t\t16\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// check if there was an overflow or some break-before/after instruction\n\t\t\tvar regionDidOverflow = region.cssRegionHost.scrollHeight != region.cssRegionHost.offsetHeight;\n\t\t\tvar shouldSegmentContent = regionDidOverflow;\n\t\t\tif(!shouldSegmentContent) {\n\t\t\t\tvar first = region.firstElementChild;\n\t\t\t\tvar last = region.lastElementChild;\n\t\t\t\tvar current = first;\n\t\t\t\twhile(current) {\n\t\t\t\t\t\n\t\t\t\t\tif(current != first) {\n\t\t\t\t\t\tif(/(region|all|always)/i.test(cssCascade.getSpecifiedStyle(current,'break-before',undefined,true).toCSSString())) {\n\t\t\t\t\t\t\tshouldSegmentContent = true; break;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(current != last) {\n\t\t\t\t\t\tif(/(region|all|always)/i.test(cssCascade.getSpecifiedStyle(current,'break-after',undefined,true).toCSSString())) {\n\t\t\t\t\t\t\tcurrent = current.nextElementSibling;\n\t\t\t\t\t\t\tshouldSegmentContent = true; break;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrent = current.nextElementSibling;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\tif(shouldSegmentContent) {\n\t\t\t\t\n\t\t\t\t// the remaining content is what was overflowing\n\t\t\t\tremainingContent = this.extractOverflowingContent(region);\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\t// there's nothing more to insert\n\t\t\t\tremainingContent = document.createDocumentFragment();\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// if any content didn't fit\n\t\t\tif(remainingContent.hasChildNodes()) {\n\t\t\t\tregion.cssRegionHost.regionOverset = 'overset';\n\t\t\t} else {\n\t\t\t\tregion.cssRegionHost.regionOverset = 'fit';\n\t\t\t}\n\t\t\t\n\t\t\t// update flags\n\t\t\tregion.cssRegionHost.cssRegionsLastOffsetHeight = region.cssRegionHost.offsetHeight;\n\t\t\tregion.cssRegionHost.cssRegionsLastOffsetWidth = region.cssRegionHost.offsetWidth;\n\t\t\t\n\t\t\t// layout the next regions\n\t\t\t// WE LET THE NEXT REGION DECIDE WHAT TO RETURN\n\t\t\tif(startTime+200 > Date.now()) {\n\t\t\t\t\n\t\t\t\treturn cssRegions.layoutContent(regions, remainingContent, callback, startTime);\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\treturn callback.onprogress(function() {\n\t\t\t\t\tcssRegions.layoutContent(regions, remainingContent, callback);\n\t\t\t\t});\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t\n\t\tlayoutContentInLastRegionWhenReady: function(region, regions, remainingContent, callback, startTime) {\n\t\t\t\n\t\t\t// delays until all images are loaded\n\t\t\tvar imgs = region.getElementsByTagName('img');\n\t\t\tfor(var imgs_index=imgs.length; imgs_index--; ) {\n\t\t\t\tif(!imgs[imgs_index].complete && !imgs[imgs_index].hasAttribute('height')) {\n\t\t\t\t\treturn setTimeout(\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\tthis.layoutContentInLastRegionWhenReady(region, regions, remainingContent, callback, startTime+32);\n\t\t\t\t\t\t}.bind(this), \n\t\t\t\t\t\t32\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// support region-fragment: break\n\t\t\tif(cssCascade.getSpecifiedStyle(region.cssRegionHost,\"region-fragment\",undefined,true).toCSSString().trim().toLowerCase()==\"break\") {\n\t\t\t\t\n\t\t\t\t// WE RETURN TRUE IF WE DID OVERFLOW\n\t\t\t\tvar didOverflow = (this.extractOverflowingContent(region).hasChildNodes());\n\t\t\t\t\n\t\t\t\t// update flags\n\t\t\t\tregion.cssRegionHost.cssRegionsLastOffsetHeight = region.cssRegionHost.offsetHeight;\n\t\t\t\tregion.cssRegionHost.cssRegionsLastOffsetWidth = region.cssRegionHost.offsetWidth;\n\t\t\t\t\n\t\t\t\treturn callback.ondone(didOverflow);\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\t\n\t\t\t\t// update flags\n\t\t\t\tregion.cssRegionHost.cssRegionsLastOffsetHeight = region.cssRegionHost.offsetHeight;\n\t\t\t\tregion.cssRegionHost.cssRegionsLastOffsetWidth = region.cssRegionHost.offsetWidth;\n\t\t\t\t\n\t\t\t\t// WE RETURN FALSE IF WE DIDN'T OVERFLOW\n\t\t\t\treturn callback.ondone(region.cssRegionHost.offsetHeight != region.cssRegionHost.scrollHeight);\n\t\t\t\t\n\t\t\t}\n\t\t},\n\n\t\t\n\t\t//\n\t\t// this function returns a document fragment containing the content\n\t\t// that didn't fit in a particular <cssregion> element.\n\t\t//\n\t\t// in the simplest cases, we can just use hit-targeting to get very\n\t\t// close the the natural breaking point. for mostly textual flows,\n\t\t// this works perfectly, for the others, we may need some tweaks.\n\t\t//\n\t\t// there's a code detecting whether this hit-target optimization\n\t\t// did possibly fail, in which case we return to a setup where we\n\t\t// start from scratch.\n\t\t//\n\t\textractOverflowingContent: function(region, dontOptimize) {\n\t\t\t\n\t\t\t// make sure empty nodes don't make our life more difficult\n\t\t\tcssRegionsHelpers.embedTrailingWhiteSpaceNodes(region);\n\t\t\t\n\t\t\t// get the region layout\n\t\t\tvar sizingH = region.cssRegionHost.offsetHeight; // avail size (max-height)\n\t\t\tvar sizingW = region.cssRegionHost.offsetWidth; // avail size (max-width)\n\t\t\tvar pos = region.cssRegionHost.getBoundingClientRect(); // avail size?\n\t\t\tpos = {top: pos.top, bottom: pos.bottom, left: pos.left, right: pos.right};\n\t\t\t\n\t\t\t// substract from the bottom any border/padding of the region\n\t\t\tvar lostHeight = parseInt(getComputedStyle(region.cssRegionHost).paddingBottom);\n\t\t\tlostHeight += parseInt(getComputedStyle(region.cssRegionHost).borderBottomWidth);\n\t\t\tpos.bottom -= lostHeight; sizingH -= lostHeight;\n\t\t\t\n\t\t\t//\n\t\t\t// note: let's use hit targeting to find a dom range\n\t\t\t// which is close to the location where we will need to\n\t\t\t// break the content into fragments\n\t\t\t// \n\t\t\t\n\t\t\t// get the caret range for the bottom-right of that location\n\t\t\ttry {\n\t\t\t\tvar r = dontOptimize ? document.createRange() : document.caretRangeFromPoint(\n\t\t\t\t\tpos.left + sizingW - 1,\n\t\t\t\t\tpos.top + sizingH - 1\n\t\t\t\t);\n\t\t\t} catch (ex) {\n\t\t\t\ttry {\n\t\t\t\t\tcssConsole.error(ex.message);\n\t\t\t\t\tcssConsole.dir(ex);\n\t\t\t\t} catch (ex) {}\n\t\t\t}\n\t\t\t\n\t\t\t// helper for logging info\n\t\t\t/*cssConsole.log(\"extracting overflow\")\n\t\t\tcssConsole.log(pos.bottom)*/\n\t\t\tvar debug = function() {\n\t\t\t\t/*cssConsole.dir({\n\t\t\t\t\tstartContainer: r.startContainer,\n\t\t\t\t\tstartOffset: r.startOffset,\n\t\t\t\t\tbrowserBCR: r.getBoundingClientRect(),\n\t\t\t\t\tcomputedBCR: rect\n\t\t\t\t});*/\n\t\t\t}\n\t\t\t\n\t\t\tvar fixNullRect = function() {\n\t\t\t\tif(rect.bottom==0 && rect.top==0 && rect.left==0 && rect.right==0) {\n\t\t\t\t\t\n\t\t\t\t\tvar scrollTop = -(document.documentElement.scrollTop || document.body.scrollTop);\n\t\t\t\t\tvar scrollLeft = -(document.documentElement.scrollLeft || document.body.scrollLeft);\n\t\t\t\t\t\n\t\t\t\t\trect = {\n\t\t\t\t\t\twidth: 0,\n\t\t\t\t\t\theigth: 0,\n\t\t\t\t\t\ttop: scrollTop,\n\t\t\t\t\t\tbottom: scrollTop,\n\t\t\t\t\t\tleft: scrollLeft,\n\t\t\t\t\t\tright: scrollLeft\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// if the caret is outside the region\n\t\t\tif(!r || (region !== r.endContainer && !Node.contains(region,r.endContainer))) {\n\t\t\t\t\n\t\t\t\t// if the caret is after the region wrapper but inside the host...\n\t\t\t\tif(r && r.endContainer === region.cssRegionHost && r.endOffset==r.endContainer.childNodes.length) {\n\t\t\t\t\t\n\t\t\t\t\t// move back at the end of the region, actually\n\t\t\t\t\tr.setStart(region, region.childNodes.length);\n\t\t\t\t\tr.setEnd(region, region.childNodes.length);\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\t\n\t\t\t\t\t// move back into the region\n\t\t\t\t\tr = r || document.createRange();\n\t\t\t\t\tr.setStart(region, 0);\n\t\t\t\t\tr.setEnd(region, 0);\n\t\t\t\t\tdontOptimize=true;\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// start finding the natural breaking point\n\t\t\tdo {\n\t\t\t\t\n\t\t\t\t// store the current selection rect for fast access\n\t\t\t\tvar rect = r.myGetExtensionRect(); fixNullRect();\n\t\t\t\tdebug();\n\t\t\t\t\n\t\t\t\t//\n\t\t\t\t// note: maybe the text is right-to-left\n\t\t\t\t// in this case, we can go further than the caret\n\t\t\t\t//\n\t\t\t\t\n\t\t\t\t// move the end point char by char until it's completely in the region\n\t\t\t\twhile(!(r.endContainer==region && r.endOffset==r.endContainer.childNodes.length) && rect.bottom<=pos.top+sizingH) {\n\t\t\t\t\t\n\t\t\t\t\tdebug();\n\t\t\t\t\t\n\t\t\t\t\t// look if we can optimize by moving fast forward\n\t\t\t\t\tvar nextSibling = r.endContainer.childNodes[r.endOffset];\n\t\t\t\t\tvar nextSiblingRect = !nextSibling || Node.getBoundingClientRect(nextSibling);\n\t\t\t\t\tif(nextSibling && nextSiblingRect.bottom<=pos.top+sizingH) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// if yes, move element by element\n\t\t\t\t\t\tr.setStartAfter(nextSibling)\n\t\t\t\t\t\tr.setEndAfter(nextSibling)\n\t\t\t\t\t\trect = nextSiblingRect\n\t\t\t\t\t\tfixNullRect()\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// otherwise, go char-by-char\n\t\t\t\t\t\tr.myMoveTowardRight(); rect = r.myGetExtensionRect(); fixNullRect();\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t//\n\t\t\t\t// note: maybe the text is one line too big\n\t\t\t\t// in this case, we have to backtrack a little\n\t\t\t\t//\n\t\t\t\t\n\t\t\t\t// move the end point char by char until it's completely in the region\n\t\t\t\twhile(!(r.endContainer==region && r.endOffset==0) && rect.bottom>pos.top+sizingH) {\n\t\t\t\t\tdebug(); r.myMoveOneCharLeft(); rect = r.myGetExtensionRect(); fixNullRect();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tdebug()\n\t\t\t\t\n\t\t\t\t//\n\t\t\t\t// note: if we optimized via hit-testing, this may be wrong\n\t\t\t\t// if next condition does not hold, we're fine. \n\t\t\t\t// otherwhise we must restart without optimization...\n\t\t\t\t//\n\t\t\t\t\n\t\t\t\t// if the selected content is possibly off-target\n\t\t\t\tvar optimizationFailled = false; if(!dontOptimize) {\n\t\t\t\t\t\n\t\t\t\t\tvar current = r.endContainer;\n\t\t\t\t\twhile(current = cssRegionsHelpers.getAllLevelPreviousSibling(current, region)) {\n\t\t\t\t\t\tif(Node.getBoundingClientRect(current).bottom > pos.top + sizingH) {\n\t\t\t\t\t\t\tr.setStart(region,0);\n\t\t\t\t\t\t\tr.setEnd(region,0);\n\t\t\t\t\t\t\toptimizationFailled=true;\n\t\t\t\t\t\t\tdontOptimize=true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} while(optimizationFailled) \n\t\t\t\n\t\t\t// \n\t\t\t// note: we should not break the content inside monolithic content\n\t\t\t// if we do, we need to change the selection to avoid that\n\t\t\t// \n\t\t\t\n\t\t\t// move the selection before the monolithic ancestors\n\t\t\tvar current = r.endContainer;\n\t\t\twhile(current !== region) {\n\t\t\t\tif(cssBreak.isMonolithic(current)) {\n\t\t\t\t\tr.setEndBefore(current);\n\t\t\t\t}\n\t\t\t\tcurrent = current.parentNode;\n\t\t\t}\n\t\t\t\n\t\t\t// if the selection is not in the region anymore, add the whole region\n\t\t\tif(!r || (region !== r.endContainer && !Node.contains(region,r.endContainer))) {\n\t\t\t\tcssConsole.dir(r.cloneRange()); debugger;\n\t\t\t\tr.setStart(region,region.childNodes.length);\n\t\t\t\tr.setEnd(region,region.childNodes.length);\n\t\t\t}\n\t\t\t\n\t\t\t// \n\t\t\t// note: we don't want to break inside a line.\n\t\t\t// backtrack to end of previous line...\n\t\t\t// \n\t\t\tvar first = r.startContainer.childNodes[r.startOffset], current = first; \n\t\t\tif(cssBreak.hasAnyInlineFlow(r.startContainer)) {\n\t\t\t\twhile((current) && (current = current.previousSibling)) {\n\t\t\t\t\t\n\t\t\t\t\tif(cssBreak.areInSameSingleLine(current,first)) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// optimization: first and current are on the same line\n\t\t\t\t\t\t// so if next and current are not the same line, it will still be\n\t\t\t\t\t\t// the same line the \"first\" element is in\n\t\t\t\t\t\tfirst = current;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(current instanceof Element) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// we don't want to break inside text lines\n\t\t\t\t\t\t\tr.setEndBefore(current);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// get last line via client rects\n\t\t\t\t\t\t\tvar lines = Node.getClientRects(current);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// if the text node did wrap into multiple lines\n\t\t\t\t\t\t\tif(lines.length>1) {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// move back from the end until we get into previous line\n\t\t\t\t\t\t\t\tvar previousLineBottom = lines[lines.length-2].bottom;\n\t\t\t\t\t\t\t\tr.setEnd(current, current.nodeValue.length);\n\t\t\t\t\t\t\t\twhile(rect.bottom>previousLineBottom) {\n\t\t\t\t\t\t\t\t\tr.myMoveOneCharLeft(); rect = r.myGetExtensionRect(); fixNullRect();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// make sure we didn't exit the text node by mistake\n\t\t\t\t\t\t\t\tif(r.endContainer!==current) {\n\t\t\t\t\t\t\t\t\t// if we did, there's something wrong about the text node\n\t\t\t\t\t\t\t\t\t// but we can consider the text node as an element instead\n\t\t\t\t\t\t\t\t\tr.setEndBefore(current); // debugger; \n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// we can consider the text node as an element\n\t\t\t\t\t\t\t\tr.setEndBefore(current);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// if the two elements are not on the same line, \n\t\t\t\t\t\t// then we just found a line break!\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// if the selection is not in the region anymore, add the whole region\n\t\t\tif(!r || (region !== r.endContainer && !Node.contains(region,r.endContainer))) {\n\t\t\t\tcssConsole.dir(r.cloneRange()); debugger;\n\t\t\t\tr.setStart(region,region.childNodes.length);\n\t\t\t\tr.setEnd(region,region.childNodes.length);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// \n\t\t\t// note: the css-break spec says that a region should not be emtpy\n\t\t\t// \n\t\t\t\n\t\t\t// if we end up with nothing being selected, add the first block anyway\n\t\t\tif(r.endContainer===region && r.endOffset===0 && r.endOffset!==region.childNodes.length) {\n\t\t\t\t\n\t\t\t\t// find the first allowed break point\n\t\t\t\tdo {\n\t\t\t\t\t\n\t\t\t\t\t//cssConsole.dir(r.cloneRange()); \n\t\t\t\t\t\n\t\t\t\t\t// move the position char-by-char\n\t\t\t\t\tr.myMoveTowardRight(); \n\t\t\t\t\t\n\t\t\t\t\t// but skip long islands of monolithic elements\n\t\t\t\t\t// since we know we cannot break inside them anyway\n\t\t\t\t\tvar current = r.endContainer;\n\t\t\t\t\twhile(current && current !== region) {\n\t\t\t\t\t\tif(cssBreak.isMonolithic(current)) {\n\t\t\t\t\t\t\tr.setStartAfter(current);\n\t\t\t\t\t\t\tr.setEndAfter(current);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrent = current.parentNode;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t// do that until we reach a possible break point, or the end of the element\n\t\t\t\twhile(!cssBreak.isPossibleBreakPoint(r,region) && !(r.endContainer===region && r.endOffset===region.childNodes.length))\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// if the selection is not in the region anymore, add the whole region\n\t\t\tif(!r || region !== r.endContainer && !Node.contains(region,r.endContainer)) {\n\t\t\t\tcssConsole.dir(r.cloneRange()); debugger;\n\t\t\t\tr.setStart(region,region.childNodes.length);\n\t\t\t\tr.setEnd(region,region.childNodes.length);\n\t\t\t}\n\t\t\t\t\n\t\t\t// now, let's try to find a break-before/break-after element before the splitting point\n\t\t\tvar current = r.endContainer; if(current.hasChildNodes()) { if(r.endOffset>0) { current=current.childNodes[r.endOffset-1] } };\n\t\t\tvar first = r.endContainer.firstChild;\n\t\t\tdo {\n\t\t\t\tif(current.style) {\n\t\t\t\t\t\n\t\t\t\t\tif(current != first) {\n\t\t\t\t\t\tif(/(region|all|always)/i.test(cssCascade.getSpecifiedStyle(current,'break-before',undefined,true).toCSSString())) {\n\t\t\t\t\t\t\tr.setStartBefore(current);\n\t\t\t\t\t\t\tr.setEndBefore(current);\n\t\t\t\t\t\t\tdontOptimize=true; // no algo involved in breaking, after all\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(current !== region) {\n\t\t\t\t\t\tif(/(region|all|always)/i.test(cssCascade.getSpecifiedStyle(current,'break-after',undefined,true).toCSSString())) {\n\t\t\t\t\t\t\tr.setStartAfter(current);\n\t\t\t\t\t\t\tr.setEndAfter(current);\n\t\t\t\t\t\t\tdontOptimize=true; // no algo involved in breaking, after all\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t} while(current = cssRegionsHelpers.getAllLevelPreviousSibling(current, region));\n\t\t\t\n\t\t\t// we're almost done! now, let's collect the ancestors to make some splitting postprocessing\n\t\t\tvar current = r.endContainer; var allAncestors=[];\n\t\t\tif(current.nodeType !== current.ELEMENT_NODE) current=current.parentNode;\n\t\t\twhile(current !== region) {\n\t\t\t\tallAncestors.push(current);\n\t\t\t\tcurrent = current.parentNode;\n\t\t\t}\n\t\t\t\n\t\t\t//\n\t\t\t// note: if we're about to split after the last child of\n\t\t\t// an element which has bottom-{padding/border/margin}, \n\t\t\t// we need to figure how how much of that p/b/m we can\n\t\t\t// actually keep in the first fragment\n\t\t\t// \n\t\t\t// TODO: avoid top & bottom p/b/m cuttings to use the \n\t\t\t// same variables names, it's ugly\n\t\t\t//\n\t\t\t\n\t\t\t// split bottom-{margin/border/padding} correctly\n\t\t\tif(r.endOffset == r.endContainer.childNodes.length && r.endContainer !== region) {\n\t\t\t\t\n\t\t\t\t// compute how much of the bottom border can actually fit\n\t\t\t\tvar box = r.endContainer.getBoundingClientRect();\n\t\t\t\tvar excessHeight = box.bottom - (pos.top + sizingH);\n\t\t\t\tvar endContainerStyle = getComputedStyle(r.endContainer);\n\t\t\t\tvar availBorderHeight = parseFloat(endContainerStyle.borderBottomWidth);\n\t\t\t\tvar availPaddingHeight = parseFloat(endContainerStyle.paddingBottom);\n\t\t\t\t\n\t\t\t\t// start by cutting into the border\n\t\t\t\tvar borderCut = excessHeight;\n\t\t\t\tif(excessHeight > availBorderHeight) {\n\t\t\t\t\tborderCut = availBorderHeight;\n\t\t\t\t\texcessHeight -= borderCut;\n\t\t\t\t\t\n\t\t\t\t\t// continue by cutting into the padding\n\t\t\t\t\tvar paddingCut = excessHeight;\n\t\t\t\t\tif(paddingCut > availPaddingHeight) {\n\t\t\t\t\t\tpaddingCut = availPaddingHeight;\n\t\t\t\t\t\texcessHeight -= paddingCut;\n\t\t\t\t\t} else {\n\t\t\t\t\t\texcessHeight = 0;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\texcessHeight = 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t// we don't cut borders with radiuses\n\t\t\t\t// TODO: accept to cut the content not affected by the radius\n\t\t\t\tif(typeof(borderCut)===\"number\" && borderCut!==0) {\n\t\t\t\t\t\n\t\t\t\t\t// check the presence of a radius:\n\t\t\t\t\tvar hasBottomRadius = (\n\t\t\t\t\t\tparseInt(endContainerStyle.borderBottomLeftRadius)>0\n\t\t\t\t\t\t|| parseInt(endContainerStyle.borderBottomRightRadius)>0\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\tif(hasBottomRadius) {\n\t\t\t\t\t\t// break before the whole border:\n\t\t\t\t\t\tborderCut = availBorderHeight;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// split top-{margin/border/padding} correctly\n\t\t\tif(r.endOffset == 0 && r.endContainer !== region) {\n\t\t\t\t\n\t\t\t\t// note: the only possibility here is that we \n\t\t\t\t// did split after a padding or a border.\n\t\t\t\t// \n\t\t\t\t// it can only happen if the border/padding is \n\t\t\t\t// too big to fit the region but is actually \n\t\t\t\t// the first break we could find!\n\t\t\t\t\n\t\t\t\t// compute how much of the top border can actually fit\n\t\t\t\tvar box = r.endContainer.getBoundingClientRect();\n\t\t\t\tvar availHeight = (pos.top + sizingH) - pos.top;\n\t\t\t\tvar endContainerStyle = getComputedStyle(r.endContainer);\n\t\t\t\tvar availBorderHeight = parseFloat(endContainerStyle.borderTopWidth);\n\t\t\t\tvar availPaddingHeight = parseFloat(endContainerStyle.paddingTop);\n\t\t\t\tvar excessHeight = availBorderHeight + availPaddingHeight - availHeight;\n\t\t\t\t\n\t\t\t\tif(excessHeight > 0) {\n\t\t\t\t\n\t\t\t\t\t// start by cutting into the padding\n\t\t\t\t\tvar topPaddingCut = excessHeight;\n\t\t\t\t\tif(excessHeight > availPaddingHeight) {\n\t\t\t\t\t\ttopPaddingCut = availPaddingHeight;\n\t\t\t\t\t\texcessHeight -= topPaddingCut;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// continue by cutting into the border\n\t\t\t\t\t\tvar topBorderCut = excessHeight;\n\t\t\t\t\t\tif(topBorderCut > availBorderHeight) {\n\t\t\t\t\t\t\ttopBorderCut = availBorderHeight;\n\t\t\t\t\t\t\texcessHeight -= topBorderCut;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\texcessHeight = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\texcessHeight = 0;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// remove bottom-{pbm} from all ancestors involved in the cut\n\t\t\tfor(var i=allAncestors.length-1; i>=0; i--) {\n\t\t\t\tallAncestors[i].setAttribute('data-css-continued-fragment',true);\n\t\t\t\tif(getComputedStyle(allAncestors[i]).display.indexOf('block')>=0) {\n\t\t\t\t\tallAncestors[i].setAttribute('data-css-continued-block-fragment',true);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(typeof(borderCut)===\"number\") {\n\t\t\t\tallAncestors[0].removeAttribute('data-css-continued-fragment');\n\t\t\t\tallAncestors[0].setAttribute('data-css-special-continued-fragment',true);\n\t\t\t\tallAncestors[0].style.borderBottomWidth = (availBorderHeight-borderCut)+'px';\n\t\t\t}\n\t\t\tif(typeof(paddingCut)===\"number\") {\n\t\t\t\tallAncestors[0].removeAttribute('data-css-continued-fragment');\n\t\t\t\tallAncestors[0].setAttribute('data-css-special-continued-fragment',true);\n\t\t\t\tallAncestors[0].style.paddingBottom = (availPaddingHeight-paddingCut)+'px';\n\t\t\t}\n\t\t\tif(typeof(topBorderCut)===\"number\") {\n\t\t\t\tallAncestors[0].removeAttribute('data-css-continued-fragment');\n\t\t\t\tallAncestors[0].setAttribute('data-css-continued-fragment',true);\n\t\t\t\tallAncestors[0].style.borderTopWidth = (availBorderHeight-topBorderCut)+'px';\n\t\t\t}\n\t\t\tif(typeof(topPaddingCut)===\"number\") {\n\t\t\t\tallAncestors[0].removeAttribute('data-css-continued-fragment');\n\t\t\t\tallAncestors[0].setAttribute('data-css-special-continued-fragment',true);\n\t\t\t\tallAncestors[0].style.paddingTop = (availPaddingHeight-topPaddingCut)+'px';\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t//\n\t\t\t// note: at this point we have a collapsed range \n\t\t\t// located at the split point\n\t\t\t//\n\t\t\t\n\t\t\t// select the overflowing content\n\t\t\tr.setEnd(region, region.childNodes.length);\n\t\t\t\n\t\t\t// extract it from the current region\n\t\t\tvar overflowingContent = r.extractContents();\n\t\t\t\n\t\t\t// remove trailing whitespace from the cut element\n\t\t\tvar tmp = allAncestors[0];\n\t\t\tif(tmp && (tmp=tmp.lastChild) && !tmp.tagName && tmp.nodeValue) {\n\t\t\t\tvar nodeValue = tmp.nodeValue.replace(/(\\s|\\r|\\n)*$/,'');\n\t\t\t\tif(nodeValue) {\n\t\t\t\t\t// if the last cut was just after a &shy; (soft hyphen), we need to append a dash\n\t\t\t\t\tif(/\\u00AD$/.test(nodeValue)) {\n\t\t\t\t\t\tnodeValue = nodeValue.replace(/\\u00AD$/, '-');\n\t\t\t\t\t} else if(overflowingContent && overflowingContent.textContent[0] == '\\u00AD') {\n\t\t\t\t\t\tnodeValue = nodeValue + '-';\n\t\t\t\t\t}\n\t\t\t\t\ttmp.nodeValue = nodeValue;\n\t\t\t\t} else {\n\t\t\t\t\ttmp.parentNode.removeChild(tmp);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t// \n\t\t\t// note: now we have to cancel out the artifacts of\n\t\t\t// the fragments cloning algorithm...\n\t\t\t//\n\t\t\t\n\t\t\t// do not forget to remove any top p/b/m on cut elements\n\t\t\tvar newFragments = overflowingContent.querySelectorAll(\"[data-css-continued-fragment]\");\n\t\t\tfor(var i=newFragments.length; i--;) { // TODO: optimize by using while loop and a simple matchesSelector.\n\t\t\t\tnewFragments[i].removeAttribute('data-css-continued-fragment')\n\t\t\t\tnewFragments[i].setAttribute('data-css-starting-fragment',true);\n\t\t\t}\n\t\t\t\n\t\t\t// deduct any already-used bottom p/b/m\n\t\t\tvar specialNewFragment = overflowingContent.querySelector('[data-css-special-continued-fragment]');\n\t\t\tif(specialNewFragment) {\n\t\t\t\tspecialNewFragment.removeAttribute('data-css-special-continued-fragment')\n\t\t\t\tspecialNewFragment.setAttribute('data-css-starting-fragment',true);\n\t\t\t\t\n\t\t\t\tif(typeof(borderCut)===\"number\") {\n\t\t\t\t\tspecialNewFragment.style.borderBottomWidth = (borderCut)+'px';\n\t\t\t\t}\n\t\t\t\tif(typeof(paddingCut)===\"number\") {\n\t\t\t\t\tspecialNewFragment.style.paddingBottom = (paddingCut);\n\t\t\t\t} else {\n\t\t\t\t\tspecialNewFragment.style.paddingBottom = '0px';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(typeof(topBorderCut)===\"number\") {\n\t\t\t\t\tspecialNewFragment.removeAttribute('data-css-starting-fragment')\n\t\t\t\t\tspecialNewFragment.setAttribute('data-css-special-starting-fragment',true);\n\t\t\t\t\tspecialNewFragment.style.borderTopWidth = (topBorderCut)+'px';\n\t\t\t\t}\n\t\t\t\tif(typeof(topPaddingCut)===\"number\") {\n\t\t\t\t\tspecialNewFragment.removeAttribute('data-css-starting-fragment')\n\t\t\t\t\tspecialNewFragment.setAttribute('data-css-special-starting-fragment',true);\n\t\t\t\t\tspecialNewFragment.style.paddingTop = (topPaddingCut)+'px';\n\t\t\t\t\tspecialNewFragment.style.paddingBottom = '0px';\n\t\t\t\t\tspecialNewFragment.style.borderBottomWidth = '0px';\n\t\t\t\t}\n\t\t\t\t\n\t\t\t} else if(typeof(borderCut)===\"number\") {\n\t\t\t\t\n\t\t\t\t// hum... there's an element missing here... {never happens anymore}\n\t\t\t\ttry { throw new Error() }\n\t\t\t\tcatch(ex) { setImmediate(function() { throw ex; }) }\n\t\t\t\t\n\t\t\t} else if(typeof(topPaddingCut)===\"number\") {\n\t\t\t\t\n\t\t\t\t// hum... there's an element missing here... {never happens anymore}\n\t\t\t\ttry { throw new Error() }\n\t\t\t\tcatch(ex) { setImmediate(function() { throw ex; }) }\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// make sure empty nodes are reintroduced\n\t\t\tcssRegionsHelpers.unembedTrailingWhiteSpaceNodes(region);\n\t\t\tcssRegionsHelpers.unembedTrailingWhiteSpaceNodes(overflowingContent);\n\t\t\t\n\t\t\t// we're ready to return our result!\n\t\t\treturn overflowingContent;\n\t\t\t\n\t\t},\n\t\t\t\n\t\tenablePolyfill: function enablePolyfill() {\n\t\t\t\n\t\t\t//\n\t\t\t// [0] insert necessary css\n\t\t\t//\n\t\t\tvar s = document.createElement('style');\n\t\t\ts.setAttribute(\"data-css-no-polyfill\", true);\n\t\t\ts.textContent = CSS_STYLE;\n\t\t\tvar head = document.head || document.getElementsByTagName('head')[0];\n\t\t\thead.appendChild(s);\n\t\t\t\n\t\t\t// \n\t\t\t// [1] when any update happens:\n\t\t\t// construct new content and region flow pairs\n\t\t\t// restart the region layout algorithm for the modified pairs\n\t\t\t// \n\t\t\tcssCascade.startMonitoringProperties(\n\t\t\t\t[\"flow-into\",\"flow-from\",\"region-fragment\"], \n\t\t\t\t{\n\t\t\t\t\tonupdate: function onupdate(element, rule) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t// let's just ignore fragments\n\t\t\t\t\t\tif(element.getAttributeNode('data-css-regions-fragment-of')) return;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// log some message in the console for debug\n\t\t\t\t\t\tcssConsole.dir({message:\"onupdate\",element:element,selector:rule.selector.toCSSString(),rule:rule});\n\t\t\t\t\t\tvar temp = null;\n\t\t\t\t\t\t\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// compute the value of region properties\n\t\t\t\t\t\t//\n\t\t\t\t\t\tvar flowInto = (\n\t\t\t\t\t\t\tcssCascade.getSpecifiedStyle(element, \"flow-into\")\n\t\t\t\t\t\t\t.filter(function(t) { return t instanceof cssSyntax.IdentifierToken })\n\t\t\t\t\t\t);\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar flowIntoName = flowInto[0] ? flowInto[0].toCSSString().toLowerCase() : \"\";\n\t\t\t\t\t\tif(flowIntoName==\"none\"||flowIntoName==\"initial\"||flowIntoName==\"inherit\"||flowIntoName==\"default\") {flowIntoName=\"\"}\n\t\t\t\t\t\tvar flowIntoType = flowInto[1] ? flowInto[1].toCSSString().toLowerCase() : \"\"; \n\t\t\t\t\t\tif(flowIntoType!=\"content\") {flowIntoType=\"element\"}\n\t\t\t\t\t\tvar flowInto = flowIntoName ? flowIntoName + \" \" + flowIntoType : \"\";\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar flowFrom = (\n\t\t\t\t\t\t\tcssCascade.getSpecifiedStyle(element, \"flow-from\")\n\t\t\t\t\t\t\t.filter(function(t) { return t instanceof cssSyntax.IdentifierToken })\n\t\t\t\t\t\t);\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar flowFromName = flowFrom[0] ? flowFrom[0].toCSSString().toLowerCase() : \"\"; \n\t\t\t\t\t\tif(flowFromName==\"none\"||flowFromName==\"initial\"||flowFromName==\"inherit\"||flowFromName==\"default\") {flowFromName=\"\"}\n\t\t\t\t\t\tvar flowFrom = flowFromName;\n\t\t\t\t\t\t\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// if the value of any property did change...\n\t\t\t\t\t\t//\n\t\t\t\t\t\tif(element.cssRegionsLastFlowInto != flowInto || element.cssRegionsLastFlowFrom != flowFrom) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// remove the element from previous regions\n\t\t\t\t\t\t\tvar regionOverset = element.regionOverset;\n\t\t\t\t\t\t\tvar lastFlowFrom = (cssRegions.flows[element.cssRegionsLastFlowFromName]);\n\t\t\t\t\t\t\tvar lastFlowInto = (cssRegions.flows[element.cssRegionsLastFlowIntoName]);\n\t\t\t\t\t\t\tlastFlowFrom && lastFlowFrom.removeFromRegions(element);\n\t\t\t\t\t\t\tlastFlowInto && lastFlowInto.removeFromContent(element);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// relayout those regions \n\t\t\t\t\t\t\t// (it's async so it will wait for us\n\t\t\t\t\t\t\t// to add the element back if needed)\n\t\t\t\t\t\t\tlastFlowFrom && regionOverset!='empty' && lastFlowFrom.relayout();\n\t\t\t\t\t\t\tlastFlowInto && lastFlowInto.relayout();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// save some property values for later\n\t\t\t\t\t\t\telement.cssRegionsLastFlowInto = flowInto;\n\t\t\t\t\t\t\telement.cssRegionsLastFlowFrom = flowFrom;\n\t\t\t\t\t\t\telement.cssRegionsLastFlowIntoName = flowIntoName;\n\t\t\t\t\t\t\telement.cssRegionsLastFlowFromName = flowFromName;\n\t\t\t\t\t\t\telement.cssRegionsLastFlowIntoType = flowIntoType;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// add the element to new regions\n\t\t\t\t\t\t\t// and relayout those regions, if deemed necessary\n\t\t\t\t\t\t\tif(flowFromName) {\n\t\t\t\t\t\t\t\tvar lastFlowFrom = (cssRegions.flows[flowFromName] = cssRegions.flows[flowFromName] || new cssRegions.Flow(flowFromName));\n\t\t\t\t\t\t\t\tlastFlowFrom && lastFlowFrom.addToRegions(element);\n\t\t\t\t\t\t\t\tlastFlowFrom && lastFlowFrom.relayout();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(flowIntoName) {\n\t\t\t\t\t\t\t\tvar lastFlowInto = (cssRegions.flows[flowIntoName] = cssRegions.flows[flowIntoName] || new cssRegions.Flow(flowIntoName));\n\t\t\t\t\t\t\t\tlastFlowInto && lastFlowInto.addToContent(element);\n\t\t\t\t\t\t\t\tlastFlowInto && lastFlowInto.relayout();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t\tcssCascade.startMonitoringProperties(\n\t\t\t\t[\"break-before\",\"break-after\"], \n\t\t\t\t{onupdate:function(element){\n\t\t\t\t\t\n\t\t\t\t\t// avoid fragments triggering update loops\n\t\t\t\t\tif(element.getAttribute('data-css-regions-fragment-of')){return;}\n\t\t\t\t\t\n\t\t\t\t\t// update parent regions\n\t\t\t\t\twhile(element) {\n\t\t\t\t\t\tif(element.cssRegionsLastFlowIntoName) {\n\t\t\t\t\t\t\tcssRegions.flows[element.cssRegionsLastFlowIntoName].relayout();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telement=element.parentNode;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}}\n\t\t\t);\n\t\t\t\n\t\t\t\n\t\t\t//\n\t\t\t// [2] perform the OM exports\n\t\t\t//\n\t\t\tcssRegions.enablePolyfillObjectModel();\n\t\t\t\n\t\t\t//\n\t\t\t// [3] make sure to update the region layout when all images loaded\n\t\t\t//\n\t\t\twindow.addEventListener(\"load\", \n\t\t\t\tfunction() { \n\t\t\t\t\tvar flows = document.getNamedFlows();\n\t\t\t\t\tfor(var i=0; i<flows.length; i++) {\n\t\t\t\t\t\tflows[i].relayout();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t\t// \n\t\t\t// [4] make sure we react to window resizes\n\t\t\t//\n\t\t\t//\n\t\t\tvar lastWindowResize = 0;\n\t\t\tvar relayoutModifiedFlows = function() {\n\t\t\t\t\n\t\t\t\t// specify the function did run\n\t\t\t\trelayoutModifiedFlows.timeout = 0;\n\t\t\t\t\n\t\t\t\t// rerun the layout\n\t\t\t\tvar flows = document.getNamedFlows();\n\t\t\t\tfor(var i=0; i<flows.length; i++) {\n\t\t\t\t\tif(flows[i].lastRelayout > lastWindowResize) continue;\n\t\t\t\t\tif(flows[i].relayoutInProgress) {\n\t\t\t\t\t\tflows[i].relayout();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tflows[i].relayoutIfSizeChanged();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\tvar hasOngoingLayouts = function() {\n\t\t\t\t\n\t\t\t\tvar flows = document.getNamedFlows();\n\t\t\t\tfor(var i=0; i<flows.length; i++) {\n\t\t\t\t\tif(flows[i].lastRelayout > lastWindowResize) continue;\n\t\t\t\t\tif(flows[i].relayoutInProgress) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn false;\n\t\t\t\t\n\t\t\t}\n\t\t\tvar restartOngoingLayouts = function() {\n\t\t\t\t\n\t\t\t\tvar flows = document.getNamedFlows();\n\t\t\t\tfor(var i=0; i<flows.length; i++) {\n\t\t\t\t\tif(flows[i].lastRelayout > lastWindowResize) continue;\n\t\t\t\t\tif(flows[i].relayoutInProgress) {\n\t\t\t\t\t\tflows[i].relayout();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t\twindow.addEventListener(\"resize\",\n\t\t\t\tfunction() {\n\t\t\t\t\t\n\t\t\t\t\t// update the last layout flag\n\t\t\t\t\tlastWindowResize = +new Date();\n\t\t\t\t\t\n\t\t\t\t\t// if we aren't planning a resfresh already\n\t\t\t\t\tif(!relayoutModifiedFlows.timeout) { \n\t\t\t\t\t\t\n\t\t\t\t\t\t// if we are already busy\n\t\t\t\t\t\tif(hasOngoingLayouts()) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// restart all layouts now\n\t\t\t\t\t\t\tsetTimeout(restartOngoingLayouts, 16);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// wait half a second before restarting them from now\n\t\t\t\t\t\t\trelayoutModifiedFlows.timeout = setTimeout(relayoutModifiedFlows, 500);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// debounce by running the resize code every 200ms\n\t\t\t\t\t\t\trelayoutModifiedFlows.timeout = setTimeout(relayoutModifiedFlows, 200);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t);\n\t\t\t\n\t\t},\n\t\t\n\t\t// this dictionary is supposed to contains all the currently existing flows\n\t\tflows: Object.create ? Object.create(null) : {}\n\t\t\n\t};\n\t\n\tenableObjectModel(window, document, cssRegions);\n\t\n\treturn cssRegions;\n})(window, document);\n\nrequire.define('src/css-regions/polyfill.js');\n\n////////////////////////////////////////\n\n//require('core:polyfill-dom-matchMedia');\n//require('core:polyfill-dom-classList');\n//require('css-grid:polyfill');\nrequire('src/css-regions/polyfill.js');\nrequire.define('src/requirements.js');\n\nwindow.cssPolyfills = { require: require };\n\n})();\n//# sourceMappingURL=css-regions-polyfill.js.map","import '../css/main.css'\nimport '../../node_modules/css-regions-polyfill/bin/css-regions-polyfill.js'\n","var bundleURL = null;\nfunction getBundleURLCached() {\n  if (!bundleURL) {\n    bundleURL = getBundleURL();\n  }\n\n  return bundleURL;\n}\n\nfunction getBundleURL() {\n  // Attempt to find the URL of the current script and use that as the base URL\n  try {\n    throw new Error;\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp):\\/\\/[^)\\n]+/g);\n    if (matches) {\n      return getBaseURL(matches[0]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\n","var bundle = require('./bundle-url');\n\nfunction updateLink(link) {\n  var newLink = link.cloneNode();\n  newLink.onload = function () {\n    link.remove();\n  };\n  newLink.href = link.href.split('?')[0] + '?' + Date.now();\n  link.parentNode.insertBefore(newLink, link.nextSibling);\n}\n\nvar cssTimeout = null;\nfunction reloadCSS() {\n  if (cssTimeout) {\n    return;\n  }\n\n  cssTimeout = setTimeout(function () {\n    var links = document.querySelectorAll('link[rel=\"stylesheet\"]');\n    for (var i = 0; i < links.length; i++) {\n      if (bundle.getBaseURL(links[i].href) === bundle.getBundleURL()) {\n        updateLink(links[i]);\n      }\n    }\n\n    cssTimeout = null;\n  }, 50);\n}\n\nmodule.exports = reloadCSS;\n"]}